--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,6 +1,6 @@
 
 pkgname=breezy
-pkgver=3.3.15
+pkgver=3.3.13
 pkgrel=1
 pkgdesc='A decentralized revision control system with support for Bazaar and Git file formats'
 arch=(x86_64)
@@ -44,17 +44,8 @@
 provides=(bzr)
 conflicts=(bzr)
 replaces=(bzr)
-source=(
-  "git+https://github.com/breezy-team/breezy.git#tag=brz-$pkgver"
-  "breezy-dulwich-0.22.0-compatibility.patch"
-)
-sha256sums=('c7d7f4bcf8ed219fabdfb999970183c93c9f48701e47515b6b9e38f7dee72676'
-            'd5f2ef12afc8694f0fc439d0ac96127512050039dfe2a72efb4d45c40aed1f34')
-
-prepare() {
-  cd $pkgname
-  patch -Np1 < ../$pkgname-dulwich-0.22.0-compatibility.patch
-}
+source=("git+https://github.com/breezy-team/breezy.git#tag=brz-$pkgver")
+sha256sums=('0de875800656de8034a40fda568c5ff21a7821d663c977e3e7667b41049d8555')
 
 build() {
   cd $pkgname
@@ -63,6 +54,10 @@
 
 check() {
   cd $pkgname
+  python -m installer --destdir=tmp_install dist/*.whl
+  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
+  export PYTHONPATH="$PWD/tmp_install/$site_packages"
+
   local excluded_tests=(
     --exclude="breezy.bzr.tests.test_read_bundle.TestReadMergeableBundleFromURL"
 
@@ -70,11 +65,8 @@
     --exclude="breezy.tests.test_gpg.TestVerify.test_verify_untrusted_but_accepted"
     --exclude="breezy.tests.test_gpg.TestVerify.test_verify_valid_but_untrusted"
   )
-  python -m venv --system-site-packages test-env
-  test-env/bin/python -m installer dist/*.whl
-  export PATH=$PWD/test-env/bin:$PATH
-  local python_version=$(python -c 'import sys; v = sys.version_info; print(f"{v.major}.{v.min}")')
-  PYTHONPATH=$PWD/test-env/lib/python$python_version/site-packages brz selftest \
+
+  "$PWD/tmp_install/usr/bin/brz" selftest \
     --parallel=fork \
     --verbose \
     "${excluded_tests[@]}" \
@@ -83,6 +75,6 @@
 
 package() {
   cd $pkgname
-  /usr/bin/python -m installer --destdir="$pkgdir" dist/*.whl
+  python -m installer --destdir="$pkgdir" dist/*.whl
   ln -vs /usr/bin/brz "$pkgdir/usr/bin/bzr" # backwards compatibility
 }


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,3 @@
-prepare() {
-cd $pkgname
-patch -Np1 < ../$pkgname-dulwich-0.22.0-compatibility.patch
-}
 build() {
 cd $pkgname
 python -m build --wheel --no-isolation
