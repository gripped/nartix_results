--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,17 +1,14 @@
 
 pkgname=ejabberd
 pkgver=24.12
-pkgrel=4
+pkgrel=1
 pkgdesc="Jabber server written in Erlang"
 arch=('x86_64')
 url="https://www.ejabberd.im/"
-license=("GPL-2.0-or-later")
-depends=('expat' 'openssl' 'zlib' 'erlang-core' 'pam' 'iproute2'
-	 'libyaml' 'sqlite' 'gd' 'elixir'
-	 'erlang-mnesia' 'erlang-os_mon' 'erlang-odbc' 'erlang-syntax_tools' 'erlang-xmerl')
-makedepends=('erlang-compiler' 'erlang-asn1' 'erlang-public_key' 'erlang-ssl' 'erlang-parsetools'
-	     'erlang-erl_interface' 'erlang-eunit' 'erlang-eldap'
-	     'git' 'rebar3' 'hevea' 'texlive-bin' 'texlive-basic' 'texlive-latexextra' 'elixir')
+license=("GPL")
+depends=('expat' 'openssl' 'zlib' 'erlang-nox' 'pam' 'iproute2'
+	 'libyaml' 'sqlite' 'gd' 'elixir')
+makedepends=('git' 'rebar' 'hevea' 'texlive-bin' 'texlive-basic' 'texlive-latexextra' 'elixir')
 optdepends=('gsfonts: for captcha'
 	    'imagemagick: for captcha')
 backup=('etc/ejabberd/ejabberd.yml'
@@ -19,7 +16,6 @@
 	'etc/logrotate.d/ejabberd')
 options=(emptydirs)
 source=("$pkgname-$pkgver.tar.gz::https://github.com/processone/ejabberd/archive/$pkgver.tar.gz"
-	"ejabberd.patch"
 	"erlang-idna::git+https://github.com/benoitc/erlang-idna"
 	"jiffy::git+https://github.com/davisp/jiffy"
 	"base64url::git+https://github.com/dvv/base64url"
@@ -51,7 +47,6 @@
 	"$pkgname.logrotate"
 	"sysuser.conf")
 sha256sums=('22b15ab9be8f0ac4b7a5a7a48cd59c282c87f17b038017b960c15cfd314689f2'
-            'a8e1be2d9daf8dd2dfedc11736a9677f3ed5c520c0f2ddf183689d2182b9151a'
             'SKIP'
             'SKIP'
             'SKIP'
@@ -85,10 +80,7 @@
 
 prepare() {
   cd "$srcdir/$pkgname-$pkgver"
-  patch -p1 <../ejabberd.patch
-
   return 0 # just put repos to src-pkg
-
   mkdir -p "$srcdir/$pkgname-$pkgver/deps"
   for i in \
     base64url cache_tab eimp ejabberd_po elixir epam eredis esip ezlib fast_tls fast_xml fast_yaml idna jiffy jose luerl mqtree p1_acme p1_mysql p1_oauth2 p1_pgsql p1_utils pkix rebar_elixir_plugin sqlite3 stringprep stun unicode_util_compat xmpp yconf \
@@ -107,20 +99,7 @@
     --sysconfdir=/etc \
     --sbindir=/usr/bin \
     --localstatedir=/var \
-    --enable-odbc \
-    --enable-mssql \
-    --enable-mysql \
-    --enable-pgsql \
-    --enable-sqlite \
-    --enable-pam \
-    --enable-zlib \
-    --enable-redis \
-    --enable-elixir \
-    --enable-stun \
-    --enable-sip \
-    --disable-debug \
-    --enable-lua \
-    --disable-tools
+    --enable-all
   make -j1
 }
 
@@ -138,7 +117,6 @@
     -e "s|INSTALLUSER=\"\"|INSTALLUSER=\"jabber\"|g" \
     "$pkgdir"/usr/bin/ejabberdctl
 
-  install -Dm0644 ejabberd.service "$pkgdir"/usr/lib/systemd/system/ejabberd.service
 
   install -d "$pkgdir/var/lib/$pkgname"
   install -D -m0644 "$srcdir/$pkgname.logrotate" "$pkgdir/etc/logrotate.d/$pkgname"


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,18 +1,5 @@
 elixir
-erlang-asn1
-erlang-compiler
-erlang-core
-erlang-eldap
-erlang-erl_interface
-erlang-eunit
-erlang-mnesia
-erlang-odbc
-erlang-os_mon
-erlang-parsetools
-erlang-public_key
-erlang-ssl
-erlang-syntax_tools
-erlang-xmerl
+erlang-nox
 expat
 gd
 git
@@ -21,7 +8,7 @@
 libyaml
 openssl
 pam
-rebar3
+rebar
 sqlite
 texlive-basic
 texlive-bin

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,6 +1,5 @@
 prepare() {
 cd "$srcdir/$pkgname-$pkgver"
-patch -p1 <../ejabberd.patch
 return 0 # just put repos to src-pkg
 mkdir -p "$srcdir/$pkgname-$pkgver/deps"
 for i in \
@@ -19,19 +18,6 @@
 --sysconfdir=/etc \
 --sbindir=/usr/bin \
 --localstatedir=/var \
---enable-odbc \
---enable-mssql \
---enable-mysql \
---enable-pgsql \
---enable-sqlite \
---enable-pam \
---enable-zlib \
---enable-redis \
---enable-elixir \
---enable-stun \
---enable-sip \
---disable-debug \
---enable-lua \
---disable-tools
+--enable-all
 make -j1
 }
