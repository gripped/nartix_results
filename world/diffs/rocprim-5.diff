--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,5 +1,5 @@
 pkgname=rocprim
-pkgver=6.4.3
+pkgver=6.4.1
 pkgrel=1
 pkgdesc='Header-only library providing HIP parallel primitives'
 arch=('any')
@@ -7,23 +7,20 @@
 _git='https://github.com/ROCm/rocPRIM'
 license=('MIT')
 depends=('rocm-core' 'hip-runtime-amd')
-makedepends=('cmake' 'rocm-cmake' 'rocm-toolchain')
+makedepends=('cmake' 'rocm-cmake')
 source=("$pkgname-$pkgver.tar.gz::$_git/archive/rocm-$pkgver.tar.gz")
-sha256sums=('b66feed30fe53aa8f2f8902604394c72f156b6517f8e5174d5b9d0b3dfcbb3c1')
+sha256sums=('ff84b839bbe07fd2c97771c1b864dac641bfa654a652e75b0e7fed5e3ec5bb7c')
 _dirname="$(basename "$_git")-$(basename "${source[0]}" ".tar.gz")"
 
 build() {
-  export CC=amdclang
-  export CXX=amdclang++
-  CXXFLAGS+=" -fcf-protection=none"
   local cmake_args=(
     -Wno-dev
     -S "$_dirname"
     -B build
+    -D CMAKE_CXX_COMPILER=/opt/rocm/bin/hipcc
+    -D CMAKE_CXX_FLAGS="${CXXFLAGS} -fcf-protection=none"
     -D CMAKE_INSTALL_PREFIX=/opt/rocm
     -D CMAKE_BUILD_TYPE=None
-    -D CMAKE_TOOLCHAIN_FILE="$srcdir/$_dirname"/toolchain-linux.cmake
-    -D AMDGPU_TARGETS=$(rocm-supported-gfx)
   )
   cmake "${cmake_args[@]}"
   cmake --build build


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -2,4 +2,3 @@
 hip-runtime-amd
 rocm-cmake
 rocm-core
-rocm-toolchain

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,15 +1,12 @@
 build() {
-export CC=amdclang
-export CXX=amdclang++
-CXXFLAGS+=" -fcf-protection=none"
 local cmake_args=(
 -Wno-dev
 -S "$_dirname"
 -B build
+-D CMAKE_CXX_COMPILER=/opt/rocm/bin/hipcc
+-D CMAKE_CXX_FLAGS="${CXXFLAGS} -fcf-protection=none"
 -D CMAKE_INSTALL_PREFIX=/opt/rocm
 -D CMAKE_BUILD_TYPE=None
--D CMAKE_TOOLCHAIN_FILE="$srcdir/$_dirname"/toolchain-linux.cmake
--D AMDGPU_TARGETS=$(rocm-supported-gfx)
 )
 cmake "${cmake_args[@]}"
 cmake --build build
