--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,18 +1,20 @@
 
 pkgname=libnice
 pkgver=0.1.22
-pkgrel=1
-pkgdesc="An implementation of the IETF's draft ICE (for p2p UDP data streams)"
-url="https://nice.freedesktop.org"
+pkgrel=2
+pkgdesc="Nice: GLib ICE library"
+url="https://libnice.freedesktop.org/"
 arch=(x86_64)
 license=('MPL-1.1 OR LGPL-2.1-only')
 depends=(
   glib2
+  glibc
   gnutls
   gupnp-igd
 )
 makedepends=(
   git
+  glib2-devel
   gobject-introspection
   graphviz
   gstreamer
@@ -21,23 +23,27 @@
 )
 optdepends=('gstreamer: "nice" GStreamer plugin')
 provides=(libnice.so)
-_commit=ae3eb16fd7d1237353bf64e899c612b8a63bca8a  # tags/0.1.22^0
-source=("git+https://gitlab.freedesktop.org/libnice/libnice.git#commit=$_commit")
-b2sums=('SKIP')
-
-pkgver() {
-  cd libnice
-  git describe --tags | sed 's/[^-]*-g/r&/;s/-/+/g'
-}
+source=(
+  "git+https://gitlab.freedesktop.org/libnice/libnice.git#tag=$pkgver"
+  0001-Update-for-gupnp-igd-1.6.patch
+)
+b2sums=('a4ac4db7d29ae1085bc88d9c1c1acd3427c81f99ac4e3f08ed63784073acc0131063898a18bcd396c2f9bdaf7ef01a5e43a34fb839795480c384990fa20c76ed'
+        'bdef1ab55744d926699f5595bbcf664d7a9f1b3a623d74271a714cffed3099ea1774cfc5ca32e09efd3c281dfed3c9152ba709e89c84acfeecf4d58bb0808267')
 
 prepare() {
   cd libnice
 
-  sed -i 's/gupnp-igd-1\.0/gupnp-igd-1.6/' meson.build
+  git apply -3 ../0001-Update-for-gupnp-igd-1.6.patch
+
+  git cherry-pick -n e4d838024b4b96fe4787afaa5d2d99dc9653104b
 }
 
 build() {
-  arch-meson libnice build -D gtk_doc=enabled
+  local meson_options=(
+    -D gtk_doc=enabled
+  )
+
+  artix-meson libnice build "${meson_options[@]}"
   meson compile -C build
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,5 +1,7 @@
 git
 glib2
+glib2-devel
+glibc
 gnutls
 gobject-introspection
 graphviz

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,8 +1,12 @@
 prepare() {
 cd libnice
-sed -i 's/gupnp-igd-1\.0/gupnp-igd-1.6/' meson.build
+git apply -3 ../0001-Update-for-gupnp-igd-1.6.patch
+git cherry-pick -n e4d838024b4b96fe4787afaa5d2d99dc9653104b
 }
 build() {
-arch-meson libnice build -D gtk_doc=enabled
+local meson_options=(
+-D gtk_doc=enabled
+)
+artix-meson libnice build "${meson_options[@]}"
 meson compile -C build
 }
