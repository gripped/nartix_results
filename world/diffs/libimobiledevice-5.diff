--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,52 +1,44 @@
 
 pkgname=libimobiledevice
 pkgver=1.3.0
-pkgrel=14
+pkgrel=13
 pkgdesc='Library to communicate with services on iOS devices using native protocols'
-arch=(x86_64)
+arch=('x86_64')
 url='https://libimobiledevice.org/'
-license=(LGPL-2.1-or-later)
-depends=(
-  glibc
-  libimobiledevice-glue
-  libplist
-  libusbmuxd
-  openssl
-)
-makedepends=(
-  cython
-  doxygen
-  git
-  python-setuptools
-)
+license=('LGPL-2.1-or-later')
+depends=('glibc' 'libplist' 'libusbmuxd' 'openssl')
+makedepends=('cython' 'python' 'python-setuptools')
 optdepends=('python: Python bindings')
-source=("git+https://github.com/libimobiledevice/libimobiledevice.git#tag=$pkgver")
-b2sums=(49d7d01a78a618860b774db835e4f0a7fb37743dc8f4b0b1a1fbefe71c3590d07de04616de2129c2a6090ac4211826004227c28dacff0e61e130e1c4c87c3072)
+source=("https://github.com/libimobiledevice/$pkgname/releases/download/$pkgver/$pkgname-$pkgver.tar.bz2"
+        'libimobiledevice-libplist-2.3.0.patch'
+        'libimobiledevice-cython3.patch'
+        'libimobiledevice-python3.patch')
+sha256sums=('53f2640c6365cd9f302a6248f531822dc94a6cced3f17128d4479a77bd75b0f6'
+            '57fb4616c68c240aad47df52168fa30e4bf43845bfbe53df23cc412003ae64fd'
+            'cb6e7feb779f8a414551ecc90423dee1e654fab3acc5fdd15c61d5cea410bff4'
+            '3b706669b52d51cd7dff6c12f244ef6421eaa68c9ac5001e5f38fae1876f8b16')
 
 prepare() {
-  cd $pkgname
+  cd $pkgname-$pkgver
 
-  git cherry-pick -n 1.3.0..6fc41f57fc607df9b07446ca45bdf754225c9bd9
+  patch -Np1 -i ../libimobiledevice-libplist-2.3.0.patch
 
-  git cherry-pick -n fb1dec7e2cbb2eae14536d8d68db25d3f9384ac1
-  git cherry-pick -n 59ec38cb6465f794cf8e2ab204711b9a10dd9eda
+  patch -Np1 -i ../libimobiledevice-cython3.patch
+
+  patch -Np1 -i ../libimobiledevice-python3.patch
 
   autoreconf -fi
 }
 
 build() (
-  cd $pkgname
-  ./configure \
-    --prefix=/usr \
-    --sysconfdir=/etc \
-    --localstatedir=/var
+  cd $pkgname-$pkgver
+  ./configure --prefix=/usr
   sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
   make
-  make docs
 )
 
 package() {
-  cd $pkgname
+  cd $pkgname-$pkgver
   make DESTDIR="$pkgdir" install
 
   install -dm755 "$pkgdir/usr/share/doc/$pkgname"


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,9 +1,7 @@
 cython
-doxygen
-git
 glibc
-libimobiledevice-glue
 libplist
 libusbmuxd
 openssl
+python
 python-setuptools

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,22 +1,18 @@
 prepare() {
-cd $pkgname
-git cherry-pick -n 1.3.0..6fc41f57fc607df9b07446ca45bdf754225c9bd9
-git cherry-pick -n fb1dec7e2cbb2eae14536d8d68db25d3f9384ac1
-git cherry-pick -n 59ec38cb6465f794cf8e2ab204711b9a10dd9eda
+cd $pkgname-$pkgver
+patch -Np1 -i ../libimobiledevice-libplist-2.3.0.patch
+patch -Np1 -i ../libimobiledevice-cython3.patch
+patch -Np1 -i ../libimobiledevice-python3.patch
 autoreconf -fi
 }
 build() (
-cd $pkgname
-./configure \
---prefix=/usr \
---sysconfdir=/etc \
---localstatedir=/var
+cd $pkgname-$pkgver
+./configure --prefix=/usr
 sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
 make
-make docs
 )
 package() {
-cd $pkgname
+cd $pkgname-$pkgver
 make DESTDIR="$pkgdir" install
 install -dm755 "$pkgdir/usr/share/doc/$pkgname"
 cp -r docs/html "$pkgdir/usr/share/doc/$pkgname/"
