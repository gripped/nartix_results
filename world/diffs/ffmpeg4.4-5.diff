--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,7 @@
 
 pkgname=ffmpeg4.4
 pkgver=4.4.4
-pkgrel=6
+pkgrel=5
 pkgdesc='Complete solution to record, convert and stream audio and video'
 arch=(x86_64)
 url=https://ffmpeg.org/
@@ -65,6 +65,8 @@
 makedepends=(
   amf-headers
   avisynthplus
+  clang
+  ffnvcodec-headers
   git
   ladspa
   nasm
@@ -98,12 +100,17 @@
 
 prepare() {
   cd ffmpeg
+  git cherry-pick -n 988f2e9eb063db7c1a678729f58aab6eba59a55b # fix nvenc on older gpus
   git cherry-pick -n 031f1561cd286596cdb374da32f8aa816ce3b135 # remove compressed_ten_bit_format
   patch -p1 -i ../binutils-2.41.patch # Fix build with binutils 2.41
+
+  git cherry-pick -n 03823ac0c6a38bd6ba972539e3203a592579792f
+  git cherry-pick -n d2b46c1ef768bc31ba9180f6d469d5b8be677500
 }
 
 build() {
   cd ffmpeg
+
   ./configure \
     --prefix=/usr \
     --incdir=/usr/include/ffmpeg4.4 \
@@ -115,6 +122,7 @@
     --disable-stripping \
     --enable-amf \
     --enable-avisynth \
+    --enable-cuda-llvm \
     --enable-lto \
     --enable-fontconfig \
     --enable-gmp \
@@ -158,6 +166,8 @@
     --enable-libxml2 \
     --enable-libxvid \
     --enable-libzimg \
+    --enable-nvdec \
+    --enable-nvenc \
     --enable-shared \
     --enable-version3
 
@@ -168,7 +178,9 @@
 
 package() {
   make DESTDIR="${pkgdir}" -C ffmpeg install
+
   cd "${pkgdir}"
+
   local f
   for f in usr/lib/ffmpeg4.4/*; do
     if [[ $f == *.so ]]; then
@@ -177,6 +189,7 @@
       mv "$f" usr/lib
     fi
   done
+
   rm -r usr/share
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -3,6 +3,8 @@
 aom
 avisynthplus
 bzip2
+clang
+ffnvcodec-headers
 fontconfig
 fribidi
 git

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,10 @@
 prepare() {
 cd ffmpeg
+git cherry-pick -n 988f2e9eb063db7c1a678729f58aab6eba59a55b # fix nvenc on older gpus
 git cherry-pick -n 031f1561cd286596cdb374da32f8aa816ce3b135 # remove compressed_ten_bit_format
 patch -p1 -i ../binutils-2.41.patch # Fix build with binutils 2.41
+git cherry-pick -n 03823ac0c6a38bd6ba972539e3203a592579792f
+git cherry-pick -n d2b46c1ef768bc31ba9180f6d469d5b8be677500
 }
 build() {
 cd ffmpeg
@@ -16,6 +19,7 @@
 --disable-stripping \
 --enable-amf \
 --enable-avisynth \
+--enable-cuda-llvm \
 --enable-lto \
 --enable-fontconfig \
 --enable-gmp \
@@ -59,6 +63,8 @@
 --enable-libxml2 \
 --enable-libxvid \
 --enable-libzimg \
+--enable-nvdec \
+--enable-nvenc \
 --enable-shared \
 --enable-version3
 make
