--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -2,7 +2,7 @@
 _gemname='simplecov-html'
 pkgname="ruby-${_gemname}"
 pkgver=0.13.1
-pkgrel=5
+pkgrel=3
 pkgdesc='Default HTML formatter for SimpleCov code coverage tool for ruby 2.4+'
 arch=('any')
 url="https://github.com/simplecov-ruby/${_gemname}"
@@ -36,23 +36,35 @@
 build() {
   cd "${_gemname}-${pkgver}"
 
+  gem build "${_gemname}.gemspec"
+}
+
+check() {
+  cd "${_gemname}-${pkgver}"
+
+  rake test
+}
+
+package() {
+  cd "${_gemname}-${pkgver}"
+
   local _gemdir="$(gem env gemdir)"
-
-  gem build "${_gemname}.gemspec"
 
   gem install \
     --local \
     --verbose \
     --ignore-dependencies \
-    --build-root "tmp_install" \
+    --no-user-install \
+    --install-dir "${pkgdir}/${_gemdir}" \
+    --bindir "${pkgdir}/usr/bin" \
     "${_gemname}-${pkgver}.gem"
 
   rm --force --recursive --verbose \
-    "tmp_install/${_gemdir}/cache/" \
-    "tmp_install/${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
-    "tmp_install/${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
+    "${pkgdir}/${_gemdir}/cache/" \
+    "${pkgdir}/${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
+    "${pkgdir}/${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
 
-  find "tmp_install/${_gemdir}/gems/" \
+  find "${pkgdir}/${_gemdir}/gems/" \
     -type f \
     \( \
       -iname "*.o" -o \
@@ -64,28 +76,14 @@
     \) \
     -delete
 
-  find "tmp_install/${_gemdir}/extensions/" \
+  find "${pkgdir}/${_gemdir}/extensions/" \
     -type f \
     \( \
       -iname "mkmf.log" -o \
       -iname "gem_make.out" \
     \) \
     -delete
+
+  install --verbose -D --mode=644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
+  install --verbose -D --mode=644 *.md --target-directory "${pkgdir}/usr/share/doc/${pkgname}"
 }
-
-check() {
-  cd "${_gemname}-${pkgver}"
-
-  local _gemdir="$(gem env gemdir)"
-
-  GEM_HOME="tmp_install/${_gemdir}" rake test
-}
-
-package() {
-  cd "${_gemname}-${pkgver}"
-
-  cp --archive --verbose tmp_install/* "${pkgdir}"
-
-  install --verbose -D --mode=0644 LICENSE --target-directory "${pkgdir}/usr/share/licenses/${pkgname}"
-  install --verbose -D --mode=0644 *.md --target-directory "${pkgdir}/usr/share/doc/${pkgname}"
-}


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -6,34 +6,5 @@
 }
 build() {
 cd "${_gemname}-${pkgver}"
-local _gemdir="$(gem env gemdir)"
 gem build "${_gemname}.gemspec"
-gem install \
---local \
---verbose \
---ignore-dependencies \
---build-root "tmp_install" \
-"${_gemname}-${pkgver}.gem"
-rm --force --recursive --verbose \
-"tmp_install/${_gemdir}/cache/" \
-"tmp_install/${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
-"tmp_install/${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
-find "tmp_install/${_gemdir}/gems/" \
--type f \
-\( \
--iname "*.o" -o \
--iname "*.c" -o \
--iname "*.so" -o \
--iname "*.time" -o \
--iname "gem.build_complete" -o \
--iname "Makefile" \
-\) \
--delete
-find "tmp_install/${_gemdir}/extensions/" \
--type f \
-\( \
--iname "mkmf.log" -o \
--iname "gem_make.out" \
-\) \
--delete
 }
