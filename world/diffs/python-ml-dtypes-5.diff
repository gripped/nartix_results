--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,45 +1,47 @@
 
 pkgname='python-ml-dtypes'
-pkgver=0.5.3
+pkgver=0.5.2
 pkgrel=1
 pkgdesc='A stand-alone implementation of several NumPy dtype extensions used in ML'
 arch=('x86_64')
 url='https://github.com/jax-ml/ml_dtypes'
 license=('Apache-2.0' 'MPL-2.0')
 depends=('gcc-libs' 'glibc' 'python-numpy')
-makedepends=('python-absl' 'python-build' 'python-installer' 'python-pytest' 'python-setuptools' 'python-wheel' 'git')
-source=("git+https://github.com/jax-ml/ml_dtypes#tag=v$pkgver"
-        "${pkgname}-eigen::git+https://gitlab.com/libeigen/eigen.git")
-sha256sums=('490512f1a05a60c7b2166898c2a66ee9be5768795723f9dde4267327b5876b1f'
-            'SKIP')
+makedepends=('python-absl' 'python-build' 'python-installer' 'python-pytest' 'python-setuptools' 'python-wheel')
+source=("ml-dtypes-$pkgver.tar.gz::https://github.com/jax-ml/ml_dtypes/archive/refs/tags/v$pkgver.tar.gz"
+        'ml-dtypes.diff'
+        "eigen-7bf2968.tar.gz::https://gitlab.com/libeigen/eigen/-/archive/7bf2968fed5f246c0589e1111004cb420fcd7c71/eigen-7bf2968.tar.gz")
+sha256sums=('72c2282950f83756fee018a90a87bc9317cfc86355154b234bbf0c3f4db72680'
+            '8c3cf615ce8eb66c1a3b0b1bad20381cc5ae9cc4aa656ab613e029349a7b1cc0'
+            'beca76e4663a75ef3ff00b0704009a7a60cec3783ce3cada0b828982da87130b')
 
 prepare() {
-  cd ml_dtypes
+  ln -fs \
+      "$srcdir"/eigen-7bf2968fed5f246c0589e1111004cb420fcd7c71/Eigen \
+      "$srcdir"/ml_dtypes-$pkgver/third_party/eigen/Eigen
 
-  git submodule init
-
-  git config submodule."eigen".url "${srcdir}/${pkgname}"-eigen
-
-  git -c protocol.file.allow=always submodule update --init --recursive
-
-  sed -i 's/setuptools~=.*\"/setuptools"/' pyproject.toml
+  cd ml_dtypes-$pkgver
+  patch -Np1 -i ../ml-dtypes.diff
 }
 
 build() {
-  cd ml_dtypes
+  cd ml_dtypes-$pkgver
   python -m build --wheel --no-isolation
   python setup.py build_ext -i
 }
 
 check() {
-  cd ml_dtypes
+  cd ml_dtypes-$pkgver
   PYTHONPATH=$(pwd) pytest
 }
 
 package() {
-  ls -lha ml_dtypes/dist
+  ls -lha ml_dtypes-$pkgver/dist
   python -m installer \
     --compile-bytecode 1 \
     --destdir "$pkgdir" \
-    ml_dtypes/dist/ml_dtypes*.whl
+    ml_dtypes-$pkgver/dist/ml_dtypes*.whl
+
+  local python_version=$(python -c 'import sys; print(".".join(map(str, sys.version_info[:2])))')
+  rm -rfv "$pkgdir"/usr/lib/python"$python_version"/site-packages/third_party
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,5 +1,4 @@
 gcc-libs
-git
 glibc
 python-absl
 python-build

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,12 +1,12 @@
 prepare() {
-cd ml_dtypes
-git submodule init
-git config submodule."eigen".url "${srcdir}/${pkgname}"-eigen
-git -c protocol.file.allow=always submodule update --init --recursive
-sed -i 's/setuptools~=.*\"/setuptools"/' pyproject.toml
+ln -fs \
+"$srcdir"/eigen-7bf2968fed5f246c0589e1111004cb420fcd7c71/Eigen \
+"$srcdir"/ml_dtypes-$pkgver/third_party/eigen/Eigen
+cd ml_dtypes-$pkgver
+patch -Np1 -i ../ml-dtypes.diff
 }
 build() {
-cd ml_dtypes
+cd ml_dtypes-$pkgver
 python -m build --wheel --no-isolation
 python setup.py build_ext -i
 }
