--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,37 +1,29 @@
 
 pkgname=python-snappy
-pkgver=0.6.1
-pkgrel=4
+pkgver=0.7.1
+pkgrel=1
 pkgdesc='Python bindings for the snappy compression library.'
-url='https://github.com/andrix/python-snappy'
-depends=(python snappy)
-makedepends=(python-setuptools)
+url='https://github.com/intake/python-snappy'
+depends=(python python-cramjam)
+makedepends=(git python-build python-installer python-setuptools python-wheel)
 checkdepends=(python-pytest)
-license=(BSD)
-arch=(x86_64)
-source=(https://files.pythonhosted.org/packages/source/p/python-snappy/python-snappy-$pkgver.tar.gz)
-sha256sums=('b6a107ab06206acc5359d4c5632bd9b22d448702a79b3169b0c62e0fb808bb2a')
-
-prepare() {
-  cd $pkgname-$pkgver
-  mkdir tests
-  mv test_*.py tests
-}
+license=('BSD-3-Clause')
+arch=(any)
+source=("git+https://github.com/intake/python-snappy#tag=$pkgver")
+sha256sums=('ee39c2cab15dde409732c3d262d628c32c4038cfed0664ae8f0f1dcec0cfe315')
 
 build() {
-  cd $pkgname-$pkgver
-  python setup.py build
+  cd $pkgname
+  python -m build --wheel --no-isolation
 }
 
 check() {
-  cd $pkgname-$pkgver
-  pyver=$(python -c "import sys; print('{}{}'.format(*sys.version_info[:2]))")
-  export PYTHONPATH="$PWD/build/lib.linux-$CARCH-cpython-$pyver"
-  PYTHONDONTWRITEBYTECODE=1 pytest tests --ignore=tests/test_snappy_cffi.py
+  cd $pkgname
+  PYTHONPATH="$PWD/src" pytest
 }
 
 package() {
-  cd $pkgname-$pkgver
-  python setup.py install --root="$pkgdir" --optimize=1 --skip-build
+  cd $pkgname
+  python -m installer --destdir="$pkgdir" dist/*.whl
   install -D -m644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,3 +1,7 @@
+git
 python
+python-build
+python-cramjam
+python-installer
 python-setuptools
-snappy
+python-wheel

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,9 +1,4 @@
-prepare() {
-cd $pkgname-$pkgver
-mkdir tests
-mv test_*.py tests
+build() {
+cd $pkgname
+python -m build --wheel --no-isolation
 }
-build() {
-cd $pkgname-$pkgver
-python setup.py build
-}
