--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,20 +1,34 @@
 
 pkgbase=rocm-llvm
 pkgname=(rocm-llvm rocm-device-libs comgr)
-pkgver=6.3.3
-pkgrel=2
+pkgver=6.4.0
+pkgrel=4
 arch=('x86_64')
 url='https://rocm.docs.amd.com/en/latest/reference/rocmcc.html'
 makedepends=('git' 'cmake' 'python' 'ninja' 'rocm-core' 'rocm-cmake' 'perl'
              'gcc-libs' 'zlib' 'zstd' 'libffi' 'libedit' 'ncurses' 'libxml2' 'patchelf')
-source=("$pkgbase::git+https://github.com/ROCm/llvm-project#tag=rocm-$pkgver")
-sha256sums=('c64fd724503b9c10381f350eea38fadb622ea86067839d45cd0efc0058621153')
+source=("$pkgbase::git+https://github.com/ROCm/llvm-project#tag=rocm-$pkgver"
+        rocm-llvm-6.4-llvm-gold-plugin-fix-ModuleName.patch
+        rocm-llvm-6.4-fix-array-assert.patch)
+sha256sums=('16f93fda1aa536eded0b903de5e2fa60d9fb9ec43d5a902e7c07d686c711cb30'
+            '0293c307131426a9c031f215045e2f0725677de0aac6dda1729456ac9a444415'
+            '6485a06e4f3b85df76110548f428217f86e785ec3dec7b0de0a7a2cf6384f0c0')
 options=(staticlibs !lto)
 
 prepare() {
   cd $pkgbase
 
   git cherry-pick -n a18cc4c7cb51f94182b6018c7c73acde1b8ebddb
+
+  git cherry-pick -n \
+      7e44305041d96b064c197216b931ae3917a34ac1 \
+      8f39502b85d34998752193e85f36c408d3c99248
+
+  patch -Np1 < ../rocm-llvm-6.4-llvm-gold-plugin-fix-ModuleName.patch
+
+  patch -Np1 < ../rocm-llvm-6.4-fix-array-assert.patch
+
+  git cherry-pick -n 155b7a12820ec45095988b6aa6e057afaf2bc892
 }
 
 build() {
@@ -33,8 +47,13 @@
         -D LLVM_ENABLE_PROJECTS='clang;lld;clang-tools-extra'
         -D CLANG_ENABLE_AMDCLANG=ON
         -D LLVM_ENABLE_RUNTIMES='compiler-rt;libunwind;libcxx;libcxxabi'
+        -D LIBCXX_ENABLE_SHARED=OFF
         -D LIBCXX_ENABLE_STATIC=ON
+        -D LIBCXX_INSTALL_LIBRARY=OFF
+        -D LIBCXX_INSTALL_HEADERS=OFF
+        -D LIBCXXABI_ENABLE_SHARED=OFF
         -D LIBCXXABI_ENABLE_STATIC=ON
+        -D LIBCXXABI_INSTALL_STATIC_LIBRARY=OFF
         -D LLVM_TARGETS_TO_BUILD='AMDGPU;NVPTX;X86'
         -D CLANG_DEFAULT_LINKER=lld
         -D CLANG_DEFAULT_RTLIB=compiler-rt
@@ -98,6 +117,12 @@
 
     ln -s /opt/rocm/lib/llvm "$pkgdir/opt/rocm/llvm"
 
+    mkdir -p "$pkgdir/opt/rocm/bin"
+    local _compiler
+    for _compiler in amdclang amdclang++ amdclang-cl amdclang-cpp amdlld; do
+        ln -s /opt/rocm/lib/llvm/bin/$_compiler "$pkgdir/opt/rocm/bin/$_compiler"
+    done
+
     install -d "$pkgdir/opt/rocm/lib/llvm/lib/bfd-plugins"
     ln -s /opt/rocm/lib/llvm/lib/LLVMgold.so "$pkgdir/opt/rocm/lib/llvm/lib/bfd-plugins/LLVMgold.so"
 


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,6 +1,12 @@
 prepare() {
 cd $pkgbase
 git cherry-pick -n a18cc4c7cb51f94182b6018c7c73acde1b8ebddb
+git cherry-pick -n \
+7e44305041d96b064c197216b931ae3917a34ac1 \
+8f39502b85d34998752193e85f36c408d3c99248
+patch -Np1 < ../rocm-llvm-6.4-llvm-gold-plugin-fix-ModuleName.patch
+patch -Np1 < ../rocm-llvm-6.4-fix-array-assert.patch
+git cherry-pick -n 155b7a12820ec45095988b6aa6e057afaf2bc892
 }
 build() {
 CFLAGS+=' -g1'
@@ -17,8 +23,13 @@
 -D LLVM_ENABLE_PROJECTS='clang;lld;clang-tools-extra'
 -D CLANG_ENABLE_AMDCLANG=ON
 -D LLVM_ENABLE_RUNTIMES='compiler-rt;libunwind;libcxx;libcxxabi'
+-D LIBCXX_ENABLE_SHARED=OFF
 -D LIBCXX_ENABLE_STATIC=ON
+-D LIBCXX_INSTALL_LIBRARY=OFF
+-D LIBCXX_INSTALL_HEADERS=OFF
+-D LIBCXXABI_ENABLE_SHARED=OFF
 -D LIBCXXABI_ENABLE_STATIC=ON
+-D LIBCXXABI_INSTALL_STATIC_LIBRARY=OFF
 -D LLVM_TARGETS_TO_BUILD='AMDGPU;NVPTX;X86'
 -D CLANG_DEFAULT_LINKER=lld
 -D CLANG_DEFAULT_RTLIB=compiler-rt
