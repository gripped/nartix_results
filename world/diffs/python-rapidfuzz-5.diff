--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,10 +1,10 @@
 
 pkgname=python-rapidfuzz
-pkgver=3.11.0
-pkgrel=1
+pkgver=3.6.2
+pkgrel=4
 pkgdesc='Rapid fuzzy string matching in Python using various string metrics'
 arch=('x86_64')
-url='https://github.com/rapidfuzz/RapidFuzz'
+url='https://github.com/maxbachmann/rapidfuzz'
 license=('MIT')
 depends=(
   'glibc'
@@ -16,19 +16,26 @@
   'python-build'
   'python-installer'
   'cython'
-  'python-scikit-build-core'
+  'python-scikit-build'
   'rapidfuzz-cpp'
 )
 checkdepends=('python-hypothesis' 'python-pandas' 'python-pytest')
 optdepends=('python-numpy')
+_commit='26917be34e943fd082f13f3106b84b4c27a7f56a'
 source=(
-  "$pkgname::git+$url#tag=v$pkgver"
+  "$pkgname::git+$url#commit=$_commit"
   'github.com-taskflow-taskflow::git+https://github.com/taskflow/taskflow'
+  fix_backend.patch
 )
-sha512sums=('931dbcce60c5bf0c54e946e111b4270b9dafb7224b8eae5f8e0d58ff97d47696092db55ee095b4758c201b8c658891793655b658b6d0749b309c7037beda4fa3'
-            'SKIP')
-b2sums=('593822ccbc878da8602edd8a062d8b67f11c27293f0c6465f7c8d2c899a68319833443ef4743ad7df840369976710fec597275674d128cb8e4a2bf2b59822b65'
-        'SKIP')
+b2sums=('SKIP'
+        'SKIP'
+        'e166301b612375d60087af4d0e8e3cb80d8b5a43f1164d67951f30fb19224be7373a4547d059f6445f5c00723fd3fe8e3a60bb7a44103dc5bb6c86984eb3561e')
+
+pkgver() {
+  cd "$pkgname"
+
+  git describe --tags | sed 's/^v//'
+}
 
 prepare() {
   cd "$pkgname"
@@ -36,6 +43,10 @@
   git submodule init extern/taskflow
   git config submodule.extern/taskflow.url "$srcdir/github.com-taskflow-taskflow"
   git -c protocol.file.allow=always submodule update
+
+  cd _custom_build
+  patch backend.py < ../../fix_backend.patch
+
 }
 
 build() {
@@ -48,12 +59,9 @@
 check() {
   cd "$pkgname"
 
-  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
-
-  python -m installer --destdir="$PWD/tmp_install" dist/*.whl
-
-  PYTHONPATH="$PWD/tmp_install$site_packages" pytest -v
-
+  python -m venv --system-site-packages test-env
+  test-env/bin/python -m installer dist/*.whl
+  test-env/bin/python -m pytest
 }
 
 package() {
@@ -63,5 +71,8 @@
 
   install -vDm644 -t "$pkgdir/usr/share/doc/$pkgname" README.md
 
-  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE
+  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
+  install -d "$pkgdir/usr/share/licenses/$pkgname"
+  ln -s "$site_packages/${pkgname#python-}-$pkgver.dist-info/LICENSE" \
+    "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -5,5 +5,5 @@
 python
 python-build
 python-installer
-python-scikit-build-core
+python-scikit-build
 rapidfuzz-cpp

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -3,6 +3,8 @@
 git submodule init extern/taskflow
 git config submodule.extern/taskflow.url "$srcdir/github.com-taskflow-taskflow"
 git -c protocol.file.allow=always submodule update
+cd _custom_build
+patch backend.py < ../../fix_backend.patch
 }
 build() {
 cd "$pkgname"
