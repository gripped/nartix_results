--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,124 +1,68 @@
 
-pkgbase=thrift
-pkgname=(
-  thrift
-  python-thrift
+
+pkgname=thrift
+pkgver=0.21.0
+pkgrel=1.1
+pkgdesc='Scalable cross-language services framework for IPC/RPC'
+arch=(x86_64)
+url='https://thrift.apache.org'
+license=(APACHE)
+depends=(gcc-libs openssl)
+makedepends=(qt5-base boost libevent emacs-nox)
+optdepends=(
+  'qt5-base: TQTcpServer (Qt5) support'
 )
-pkgver=0.22.0
-pkgrel=4
-pkgdesc="Scalable cross-language services framework for IPC/RPC"
-arch=(x86_64)
-url="https://thrift.apache.org"
-_url="https://github.com/apache/thrift"
-license=(Apache-2.0)
-makedepends=(
-  boost
-  cmake
-  emacs-nox
-  gcc-libs
-  git
-  glib2
-  glibc
-  libevent
-  openssl
-  python
-  python-build
-  python-installer
-  python-setuptools
-  python-wheel
-  qt5-base
-  zlib
-)
-checkdepends=(
-  python-tornado
-  python-twisted
-)
-source=(
-  "git+$_url.git#tag=v$pkgver?signed"
-  "$pkgbase-python-adapt-tests-to-python3.patch"
-  "$pkgbase-python-add-TType-UUID.patch"
-  "$pkgbase-python-disable-failing-tests.patch"
-)
-sha512sums=('844c1c50d024c29fd76a5f3b7cf5f903656d5d80c95d621c7c52bb48653ca6c1bd5a861c04689cfd624b5e1fea36018ef3044fea1476f9f3aefe577cdb380643'
-            'bd85749946b9bd2f171bd22a6265e427ed38f489dcee856b1abe46cbd5bf81f2674075b2924de63822c4bb244caf3379d37079cdbba1d4a4730aeffa7a2dfc45'
-            'ca2de7a67ee45e6bc0a928bf2700d0fe235a474e3d54a4123b90f0879ce7e6b738b305a9ec6fd5a27c53a5a9295159986d9a6a92634f526914f1f67f7f3e7a0c'
-            '1a1f021c000ea23c619703927ebc9833d7dceebb743101079f9c4fbab905cdbac451541e738ca7a009af9c223b25b8ce10f010139a201117ec3e77ab5d5902c8')
-validpgpkeys=('8CD87F186F06E958EFCA963D76BD340FC4B75865') # Jens Geyer <jensg@apache.org>
+source=(https://dlcdn.apache.org/thrift/$pkgver/thrift-$pkgver.tar.gz
+        fix_missing_target.patch::https://github.com/apache/thrift/commit/0f027530d7d46ae25f3ed6d6ee453ca18ca43eb6.patch)
+sha256sums=('9a24f3eba9a4ca493602226c16d8c228037db3b9291c6fc4019bfe3bd39fc67c'
+            '4edc5a71ab041bd958cffc95f04f2ff2eb107258d29f471b171af95c3516496a')
 
 prepare() {
-  cd $pkgbase
-  patch -Np1 < ../$pkgbase-python-adapt-tests-to-python3.patch
-  patch -Np1 < ../$pkgbase-python-add-TType-UUID.patch
-  patch -Np1 < ../$pkgbase-python-disable-failing-tests.patch
+  cd thrift-$pkgver
+
+  patch -p1 < ../fix_missing_target.patch
 }
 
 build() {
-  cd $pkgbase
-  cmake -S . -B build \
-    -D CMAKE_BUILD_TYPE=None \
-    -D CMAKE_INSTALL_PREFIX=/usr \
-    -W no-dev \
-    -D BUILD_SHARED_LIBS=ON \
-    -D BUILD_JAVA=OFF \
-    -D BUILD_JAVASCRIPT=OFF \
-    -D BUILD_KOTLIN=OFF \
-    -D BUILD_NODEJS=OFF \
-    -D BUILD_PYTHON=ON
-  cmake --build build
-  python -m build --wheel --no-isolation lib/py
+  cd thrift-$pkgver
+
+  ./bootstrap.sh
+  ./configure --prefix=/usr \
+	      --enable-plugin \
+	      --disable-tests \
+              --with-cpp \
+              --with-c_glib \
+              --with-qt5 \
+              --with-libevent \
+              --with-csharp \
+              --without-haskell \
+              --without-php \
+              --without-ruby \
+              --without-python \
+              --without-erlang \
+              --without-perl \
+              --without-java \
+              --without-c_sharp \
+              --without-d \
+              --without-php \
+              --without-go \
+              --without-lua \
+              --without-nodejs
+
+  make
+
   emacs -Q --batch -f batch-byte-compile contrib/thrift.el
 }
 
 check() {
-  cd $pkgbase
-  local skip_tests=(
-    testapplicationexception
-    testfdtransport
-    testthriftfdreadcheck
-  )
-  local skip_tests_pattern="${skip_tests[0]}$(printf '|%s' "${skip_tests[@]:1}")"
-  ctest --test-dir build --output-on-failure -E "$skip_tests_pattern"
+  cd thrift-$pkgver
 }
 
-package_thrift() {
-  depends=(
-    gcc-libs
-    glib2
-    glibc
-    libevent
-    openssl
-    zlib
-  )
-  optdepends=('qt5-base: TQTcpServer (Qt5) support')
-  provides=(
-    libthrift.so
-    libthrift_c_glib.so
-    libthriftnb.so
-    libthriftqt5.so
-    libthriftz.so
-  )
+package() {
+  cd thrift-$pkgver
+  make DESTDIR="$pkgdir" install
 
-  cd $pkgbase
-  DESTDIR="$pkgdir" cmake --install build
-  install -vDm644 -t "$pkgdir/usr/share/vim/vimfiles/syntax" contrib/thrift.vim
-  install -vDm644 -t "$pkgdir/usr/share/emacs/site-lisp" \
-    contrib/thrift.el \
-    contrib/thrift.elc
+  install -m0644 -D contrib/thrift.vim "$pkgdir"/usr/share/vim/vimfiles/syntax/thrift.vim
+  install -m0644 -D contrib/thrift.el "$pkgdir"/usr/share/emacs/site-lisp/thrift.el
+  install -m0644 -D contrib/thrift.elc "$pkgdir"/usr/share/emacs/site-lisp/thrift.elc
 }
-
-package_python-thrift() {
-  pkgdesc+=" (Python bindings)"
-  depends=(
-    gcc-libs
-    glibc
-    python
-  )
-  optdepends=(
-    'python-tornado: for tornado backend'
-    'python-twisted: for twisted backend'
-    'python-zope-interface: for twisted backend'
-  )
-
-  cd $pkgbase
-  python -m installer --destdir="$pkgdir" lib/py/dist/*.whl
-}


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,16 +1,6 @@
 boost
-cmake
 emacs-nox
 gcc-libs
-git
-glib2
-glibc
 libevent
 openssl
-python
-python-build
-python-installer
-python-setuptools
-python-wheel
 qt5-base
-zlib

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,22 +1,31 @@
 prepare() {
-cd $pkgbase
-patch -Np1 < ../$pkgbase-python-adapt-tests-to-python3.patch
-patch -Np1 < ../$pkgbase-python-add-TType-UUID.patch
-patch -Np1 < ../$pkgbase-python-disable-failing-tests.patch
+cd thrift-$pkgver
+patch -p1 < ../fix_missing_target.patch
 }
 build() {
-cd $pkgbase
-cmake -S . -B build \
--D CMAKE_BUILD_TYPE=None \
--D CMAKE_INSTALL_PREFIX=/usr \
--W no-dev \
--D BUILD_SHARED_LIBS=ON \
--D BUILD_JAVA=OFF \
--D BUILD_JAVASCRIPT=OFF \
--D BUILD_KOTLIN=OFF \
--D BUILD_NODEJS=OFF \
--D BUILD_PYTHON=ON
-cmake --build build
-python -m build --wheel --no-isolation lib/py
+cd thrift-$pkgver
+./bootstrap.sh
+./configure --prefix=/usr \
+--enable-plugin \
+--disable-tests \
+--with-cpp \
+--with-c_glib \
+--with-qt5 \
+--with-libevent \
+--with-csharp \
+--without-haskell \
+--without-php \
+--without-ruby \
+--without-python \
+--without-erlang \
+--without-perl \
+--without-java \
+--without-c_sharp \
+--without-d \
+--without-php \
+--without-go \
+--without-lua \
+--without-nodejs
+make
 emacs -Q --batch -f batch-byte-compile contrib/thrift.el
 }
