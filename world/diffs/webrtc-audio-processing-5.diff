--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,51 +1,48 @@
 
 pkgname=webrtc-audio-processing
-pkgver=2.0
-pkgrel=1
+pkgver=0.3.1
+pkgrel=5
 pkgdesc="AudioProcessing library based on Google's implementation of WebRTC"
 url="https://freedesktop.org/software/pulseaudio/webrtc-audio-processing/"
 arch=(x86_64)
-license=(BSD-3-Clause)
-depends=(
-  abseil-cpp
-  gcc-libs
-  glibc
-)
-makedepends=(
-  git
-  meson
-)
-provides=(
-  libwebrtc-audio-processing-2.so
-)
-source=("git+https://gitlab.freedesktop.org/pulseaudio/webrtc-audio-processing.git?signed#tag=v$pkgver")
-b2sums=('89d43217948cfccfa146337828c40d51d500bcc252757956c296a188ae7fc91bfe7b7d37ac0a817dbc8bbcfbf605adbb0e68dcb5889775a7f3c0ef70d14c7783')
-validpgpkeys=(
-  52DFA7B8BAC74687C8A88EF48165E3D1987E2132 # Arun Raghavan <arun@asymptotic.io>
-)
+license=(custom)
+depends=(gcc-libs)
+makedepends=(git)
+provides=(libwebrtc_audio_processing.so)
+_commit=e882a5442ac22c93648e12837248d651d18b9247  # tags/v0.3.1^0
+source=("git+https://gitlab.freedesktop.org/pulseaudio/webrtc-audio-processing.git#commit=$_commit")
+b2sums=('5ebffa25cd06b1ebefb84d05e7698b0f1cd1f25355480953742bd95b13bb6348e6f0fa2aa019ce5017783eec6919debf7a98a5425bfa6e403dc8c0a4c5773b98')
+
+pkgver() {
+  cd $pkgname
+  git describe --tags | sed 's/^v//;s/[^-]*-g/r&/;s/-/+/g'
+}
 
 prepare() {
-  cd webrtc-audio-processing
+  cd $pkgname
+  NOCONFIGURE=1 ./autogen.sh
 }
 
 build() {
-  local meson_options=(
-    -D cpp_std=c++17
-
-    -D neon=disabled
+  local configure_options=(
+    --prefix /usr
+    --disable-static
   )
 
-  arch-meson webrtc-audio-processing build "${meson_options[@]}"
-  meson compile -C build
+  cd $pkgname
+  ./configure "${configure_options[@]}"
+  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
+  make
 }
 
 check() {
-  meson test -C build --print-errorlogs
+  cd $pkgname
+  make check
 }
 
 package() {
-  meson install -C build --destdir "$pkgdir"
-  install -Dm644 webrtc-audio-processing/COPYING \
-    -t "$pkgdir/usr/share/licenses/$pkgname"
+  cd $pkgname
+  make DESTDIR="$pkgdir" install
+  install -Dt "$pkgdir/usr/share/licenses/$pkgname" -m644 COPYING
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,5 +1,2 @@
-abseil-cpp
 gcc-libs
 git
-glibc
-meson

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,11 +1,14 @@
 prepare() {
-cd webrtc-audio-processing
+cd $pkgname
+NOCONFIGURE=1 ./autogen.sh
 }
 build() {
-local meson_options=(
--D cpp_std=c++17
--D neon=disabled
+local configure_options=(
+--prefix /usr
+--disable-static
 )
-arch-meson webrtc-audio-processing build "${meson_options[@]}"
-meson compile -C build
+cd $pkgname
+./configure "${configure_options[@]}"
+sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
+make
 }
