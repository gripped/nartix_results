--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,8 +1,8 @@
 
 pkgname=python-zope-security
 _pkgname=zope.security
-pkgver=8.1
-pkgrel=2
+pkgver=8.0
+pkgrel=1
 pkgdesc="Zope Security Framework"
 arch=('x86_64')
 url="https://github.com/zopefoundation/zope.security"
@@ -18,6 +18,7 @@
   'python-zope-schema'
 )
 makedepends=(
+  'git'
   'python-build'
   'python-installer'
   'python-setuptools'
@@ -30,22 +31,28 @@
   'python-zope-testrunner'
 )
 optdepends=('python-zope-configuration: for ZCML support')
-source=("$url/archive/$pkgver/$pkgname-$pkgver.tar.gz")
-sha512sums=('4cccaf50c44a7c1345e3372c8b9f770e51e4920f12a06a9fc8243b887d53e65247329ce1cb8f0eed0d386e86f4bc7f6b9d5a2087c17247a4476d685766be6879')
+source=("git+https://github.com/zopefoundation/zope.security.git#tag=$pkgver")
+sha512sums=('3f3bfe6f62e026513a39aaf0299790518363bc9169360f61b26649feda551831573f7696fc1fdca990c005b5cfdfbae4b59aa1d7c48b8c8e5cdba3b2123d743c')
+
+prepare() {
+  cd $_pkgname
+  sed -i 's/setuptools == 78.1.1/setuptools/' pyproject.toml
+}
 
 build() {
-  cd $_pkgname-$pkgver
-  python -m build --wheel --no-isolation --skip-dependency-check
+  cd $_pkgname
+  python -m build --wheel --no-isolation
 }
 
 check() {
-  cd $_pkgname-$pkgver
-  python -m venv --system-site-packages test-env
-  test-env/bin/python -m installer dist/*.whl
-  test-env/bin/python -m zope.testrunner -vc --test-path src/
+  cd $_pkgname
+  local python_version=$(python -c 'import sys; print("".join(map(str, sys.version_info[:2])))')
+  PYTHONPATH="$PWD/build/lib.linux-$CARCH-cpython-$python_version" \
+    zope-testrunner --test-path=src
 }
 
 package() {
-  cd $_pkgname-$pkgver
+  cd $_pkgname
   python -m installer --destdir="$pkgdir" dist/*.whl
 }
+


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,3 +1,4 @@
+git
 glibc
 python
 python-build

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,4 +1,8 @@
+prepare() {
+cd $_pkgname
+sed -i 's/setuptools == 78.1.1/setuptools/' pyproject.toml
+}
 build() {
-cd $_pkgname-$pkgver
-python -m build --wheel --no-isolation --skip-dependency-check
+cd $_pkgname
+python -m build --wheel --no-isolation
 }
