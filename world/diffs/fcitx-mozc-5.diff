--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,32 +1,32 @@
 
 _bldtype=Release
-_mozc_commit=ca82d39
+_mozc_commit=d359f60
 
-_abseil_cpp_commit=0f3bb46
+_abseil_cpp_commit=2151058
 _breakpad_commit=216cea7
 _gtest_commit=703bd9c
 _gyp_commit=caa6002
 _japanese_usage_dictionary_commit=e5b3425
 _jsoncpp_commit=11086dd
-_protobuf_commit=fde7cf7
+_protobuf_commit=cc7b1b5
 
-_zipcode_rel=202104
+_zipcode_rel=202110
 
 _pkgbase=mozc
 pkgname=fcitx-mozc
 pkgdesc="Fcitx Module of A Japanese Input Method for Chromium OS, Windows, Mac and Linux (the Open Source Edition of Google Japanese Input)"
-pkgver=2.26.4360.102.gca82d39
-pkgrel=3
+pkgver=2.26.4666.102.gd359f60
+pkgrel=1
 arch=('x86_64')
 url="https://github.com/google/mozc"
 license=('custom')
 depends=('qt5-base' 'fcitx')
-makedepends=('pkg-config' 'python' 'curl' 'mesa' 'subversion' 'ninja' 'git' 'clang' 'python-six')
+makedepends=('pkg-config' 'python' 'curl' 'gtk2' 'mesa' 'subversion' 'ninja' 'git' 'clang' 'python-six')
 replaces=('mozc-fcitx')
 conflicts=('mozc' 'mozc-server' 'mozc-utils-gui' 'mozc-fcitx' 'fcitx5-mozc')
 source=(git+https://github.com/fcitx/mozc.git#commit=${_mozc_commit}
-        https://osdn.ip-connect.vn.ua/storage/g/p/po/ponsfoot-aur/mozc/jigyosyo-${_zipcode_rel}.zip
-        https://osdn.ip-connect.vn.ua/storage/g/p/po/ponsfoot-aur/mozc/x-ken-all-${_zipcode_rel}.zip
+        https://osdn.net/projects/ponsfoot-aur/storage/mozc/jigyosyo-${_zipcode_rel}.zip
+        https://osdn.net/projects/ponsfoot-aur/storage/mozc/x-ken-all-${_zipcode_rel}.zip
         git+https://chromium.googlesource.com/breakpad/breakpad#commit=${_breakpad_commit}
         git+https://github.com/google/googletest.git#commit=${_gtest_commit}
         git+https://chromium.googlesource.com/external/gyp#commit=${_gyp_commit}
@@ -34,24 +34,21 @@
         git+https://github.com/open-source-parsers/jsoncpp.git#commit=${_jsoncpp_commit}
         git+https://github.com/google/protobuf.git#commit=${_protobuf_commit}
         git+https://github.com/abseil/abseil-cpp.git#commit=${_abseil_cpp_commit}
+        0001-fix-collections-usage-for-python-3.10.patch
 	)
 sha512sums=('SKIP'
-            'cadb43138597371d13d21a2766ba38f0940a73bd961a1142f3713f700d1b8e75bdb6ccc0600ea57518ad5bf1931eed329cd11faeb87b191aa460e379ed1fed93'
-            'b473bda282e12c448ec10522306035b10b566d7ebfb051602e287a7890405db9189ce60189ed47cc130d15a196cd8c7440c6cbb2aaacc7e8cd62b90e50bcb1d9'
+            '606f45d48a9dad0e80a566cab0001910de3c6b2f634ec52c6ef6f44745b55ae8e181b3e3cdf90525a08be1f180eb35900672c90c6ab4f43679a178e863378bbc'
+            'dec6479b42ddc1355cd882d17824cd874d8f103ad7767bac3f490f04551059d65b2806fa9e3f39a50ced2ecfdd37b75c9ed4536d9ad3bcef9e8c5ae1ec10e302'
             'SKIP'
             'SKIP'
             'SKIP'
             'SKIP'
             'SKIP'
             'SKIP'
-            'SKIP')
+            'SKIP'
+            '166960611a0bd09f68c727b9362588e92498ab90b73717e846ef9c3ae231a780bb36666a79e813b61d529f29291ff264d39bb94fc36399a39d76312955b0811a')
 validpgpkeys=('2CC8A0609AD2A479C65B6D5C8E8B898CBF2412F9')  # Weng Xuetian
 
-pkgver(){
-  cd mozc
-  _bzr_ver=$(sed 's/ //g;$ a echo $MAJOR.$MINOR.$BUILD.102' src/data/version/mozc_version_template.bzl | source /dev/stdin)
-  printf "%s.g%s" "${_bzr_ver}" "${_mozc_commit}"
-}
 
 prepare() {
   cd "$srcdir/mozc"
@@ -63,7 +60,7 @@
   git config submodule.src/third_party/jsoncpp.url "$srcdir/jsoncpp"
   git config submodule.src/third_party/protobuf.url "$srcdir/protobuf"
   git config submodule.src/third_party/abseil-cpp.url "$srcdir/abseil-cpp"
-  git -c protocol.file.allow=always submodule update
+  git submodule update
 
   cd src
   echo "Generating zip code seed..."
@@ -74,12 +71,8 @@
 
   sed "/stdlib=libc++/d;/-lc++/d" -i gyp/common.gypi
 
-  cd third_party/gyp
-  git cherry-pick -n bc83cdacf5428ab6ddcc92fd0b0fc494cc9a4d4f
-
-  cd ../abseil-cpp
-  git checkout 5bf048b8425cc0a342e4647932de19e25ffd6ad7
-  git cherry-pick -n 36a4b073f1e7e02ed7d1ac140767e36f82f09b7c
+  cd "$srcdir/mozc/src/third_party/gyp"
+  patch -Np1 -i "$srcdir/0001-fix-collections-usage-for-python-3.10.patch"
 }
 
 build() {
@@ -91,7 +84,7 @@
 
   _targets="server/server.gyp:mozc_server gui/gui.gyp:mozc_tool unix/fcitx/fcitx.gyp:fcitx-mozc"
 
-  QTDIR=/usr GYP_DEFINES="document_dir=/usr/share/licenses/$pkgname use_libzinnia=1 enable_gtk_renderer=0" python build_mozc.py gyp
+  QTDIR=/usr GYP_DEFINES="document_dir=/usr/share/licenses/$pkgname use_libzinnia=1" python build_mozc.py gyp
   python build_mozc.py build -c $_bldtype $_targets
 
   head -n 29 server/mozc_server.cc > LICENSE


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -2,6 +2,7 @@
 curl
 fcitx
 git
+gtk2
 mesa
 ninja
 pkg-config

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -8,18 +8,15 @@
 git config submodule.src/third_party/jsoncpp.url "$srcdir/jsoncpp"
 git config submodule.src/third_party/protobuf.url "$srcdir/protobuf"
 git config submodule.src/third_party/abseil-cpp.url "$srcdir/abseil-cpp"
-git -c protocol.file.allow=always submodule update
+git submodule update
 cd src
 echo "Generating zip code seed..."
 PYTHONPATH="$PWD:$PYTHONPATH" python dictionary/gen_zip_code_seed.py --zip_code="${srcdir}/x-ken-all.csv" --jigyosyo="${srcdir}/JIGYOSYO.CSV" >> data/dictionary_oss/dictionary09.txt
 echo "Done."
 rm unix/fcitx5/fcitx5.gyp
 sed "/stdlib=libc++/d;/-lc++/d" -i gyp/common.gypi
-cd third_party/gyp
-git cherry-pick -n bc83cdacf5428ab6ddcc92fd0b0fc494cc9a4d4f
-cd ../abseil-cpp
-git checkout 5bf048b8425cc0a342e4647932de19e25ffd6ad7
-git cherry-pick -n 36a4b073f1e7e02ed7d1ac140767e36f82f09b7c
+cd "$srcdir/mozc/src/third_party/gyp"
+patch -Np1 -i "$srcdir/0001-fix-collections-usage-for-python-3.10.patch"
 }
 build() {
 CFLAGS="${CFLAGS} -fvisibility=hidden"
@@ -27,7 +24,7 @@
 export _bldtype
 cd mozc/src
 _targets="server/server.gyp:mozc_server gui/gui.gyp:mozc_tool unix/fcitx/fcitx.gyp:fcitx-mozc"
-QTDIR=/usr GYP_DEFINES="document_dir=/usr/share/licenses/$pkgname use_libzinnia=1 enable_gtk_renderer=0" python build_mozc.py gyp
+QTDIR=/usr GYP_DEFINES="document_dir=/usr/share/licenses/$pkgname use_libzinnia=1" python build_mozc.py gyp
 python build_mozc.py build -c $_bldtype $_targets
 head -n 29 server/mozc_server.cc > LICENSE
 }
