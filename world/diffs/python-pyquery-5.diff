--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,30 +1,39 @@
 
 pkgname=python-pyquery
-pkgver=2.0.1
-pkgrel=1
+pkgver=2.0.0
+pkgrel=6
 pkgdesc="A jquery-like library for python."
 arch=('any')
 url="https://github.com/gawel/pyquery/"
 license=('BSD')
 depends=('python-lxml' 'python-cssselect')
 optdepends=('python-webob: query wsgi app')
-makedepends=('git' 'python-build' 'python-installer' 'python-setuptools' 'python-wheel')
+makedepends=('python-build' 'python-installer' 'python-setuptools' 'python-wheel')
 checkdepends=('python-requests' 'python-webob' 'python-pytest' 'python-webtest')
-source=("git+https://github.com/gawel/pyquery.git#tag=$pkgver")
-sha512sums=('7c496fac61e2ae0d0755bd49f5e129cf8739fcd013e932c3363feaf5c22463452dc034bc1ed6d5beae4056405ae2613a5c4be5f7ede9eeeb3b401cc0e0361792')
+source=(
+  "https://github.com/gawel/pyquery/archive/$pkgver/$pkgname-$pkgver.tar.gz"
+  "pyquery-py312-test-fix.patch::https://github.com/gawel/pyquery/commit/60ea3abafdf3e9cddcc580b9f94197c6badab09b.patch"
+)
+sha512sums=('0c44ca00ee30922e72aff23764d4a6a8ab9f4df684de77703b69b87af4b461ee2338ef5fb134dce280926e2575b976a1b86d16b1234e13fc450811e4874a34e9'
+            '00bb7a1b9c38e8a4cba8d92f0daf7fcf5649653f24188abf3b4dac074d598a47442abc016c6f80af1d427d3e4ef545bf93b35c0aa165e72327c00b6465c8226c')
+
+prepare() {
+  cd pyquery-$pkgver
+  patch --forward --strip=1 --input=../pyquery-py312-test-fix.patch
+}
 
 build() {
-  cd pyquery
+  cd pyquery-$pkgver
   python -m build --wheel --skip-dependency-check --no-isolation
 }
 
 check() {
-  cd pyquery
+  cd pyquery-$pkgver
   pytest -k 'not test_selector_html'
 }
 
 package() {
-  cd pyquery
+  cd pyquery-$pkgver
   python -m installer --destdir="$pkgdir" dist/*.whl
 
   local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,4 +1,3 @@
-git
 python-build
 python-cssselect
 python-installer

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,4 +1,8 @@
+prepare() {
+cd pyquery-$pkgver
+patch --forward --strip=1 --input=../pyquery-py312-test-fix.patch
+}
 build() {
-cd pyquery
+cd pyquery-$pkgver
 python -m build --wheel --skip-dependency-check --no-isolation
 }
