--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -4,8 +4,8 @@
   openmpi
   openmpi-docs
 )
-pkgver=5.0.8
-pkgrel=1
+pkgver=5.0.7
+pkgrel=5
 pkgdesc='High performance message passing library (MPI)'
 arch=(x86_64)
 url='https://www.open-mpi.org'
@@ -22,17 +22,18 @@
   libfabric
   libnl
   openpmix
-  openucc
-  openucx
   prrte
   valgrind
   zlib
 )
 source=(
   https://www.open-mpi.org/software/ompi/v${pkgver%.*}/downloads/$pkgbase-$pkgver.tar.bz2
+  fix-oshmem-pointer-cast.patch
 )
-sha256sums=('53131e1a57e7270f645707f8b0b65ba56048f5b5ac3f68faabed3eb0d710e449')
-b2sums=('610df6519323c9d08feccdd3d5b9d8a36cbed8ade7e31ca340e31aa0e21f6fc3ab6534c16a1660d9af53594d6836ed54fdd910202f22175d8517dc5193e1cd9c')
+sha256sums=('119f2009936a403334d0df3c0d74d5595a32d99497f9b1d41e90019fee2fc2dd'
+            '5ee931a9260cf077abf3af901145f237c5382a0ec407921debb1d6c446420568')
+b2sums=('5e26ef366e9587c686e395d596f3f28f619dbf76981091f7f3cc9c76e8cc3e1f558eef0ff1538498eea25c04c661fc7e2402083efa81def675cbaece74b8c6f0'
+        'e45e2d66db1a69a5c0c38d76973f2ee475fa389a9a068f6918e61d43b494857b14c45c52867fb53911fe5c9eb58680ad347b75578888ba41b782edcf09e3a6a9')
 
 _pick() {
   local p="$1" f d; shift
@@ -49,6 +50,8 @@
   sed -i 's|WRAPPER__FCFLAGS|WRAPPER_FCFLAGS|g' configure
   sed -i 's|WRAPPER_EXTRA_FCFLAGS|WRAPPER_FCFLAGS|g' configure
   sed -i 's|"-I/usr/include",||' opal/tools/wrappers/opal_wrapper.c
+
+  patch -p1 -i ../fix-oshmem-pointer-cast.patch
 }
 
 build() {
@@ -65,8 +68,6 @@
     --with-pmix=external
     --with-prrte=external
     --with-valgrind
-    --with-ucc=/usr
-    --with-ucx=/usr
     --with-cuda=/opt/cuda
     --with-cuda-libdir=/usr/lib
     --with-rocm=/opt/rocm
@@ -96,7 +97,6 @@
     libfabric
     libnl
     openpmix libpmix.so
-    openucx
     prrte
     zlib
   )
@@ -105,7 +105,6 @@
     'hip-runtime-amd: ROCm support'
     'gcc-fortran: fortran support'
     'openssh: for execution on remote hosts via plm_ssh_agent'
-    'openucc: for UCC accelerated collectives'
   )
   provides=(
     libmpi.so


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -12,8 +12,6 @@
 libpmix.so
 nvidia-utils
 openpmix
-openucc
-openucx
 prrte
 valgrind
 zlib

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -3,6 +3,7 @@
 sed -i 's|WRAPPER__FCFLAGS|WRAPPER_FCFLAGS|g' configure
 sed -i 's|WRAPPER_EXTRA_FCFLAGS|WRAPPER_FCFLAGS|g' configure
 sed -i 's|"-I/usr/include",||' opal/tools/wrappers/opal_wrapper.c
+patch -p1 -i ../fix-oshmem-pointer-cast.patch
 }
 build() {
 local configure_options=(
@@ -18,8 +19,6 @@
 --with-pmix=external
 --with-prrte=external
 --with-valgrind
---with-ucc=/usr
---with-ucx=/usr
 --with-cuda=/opt/cuda
 --with-cuda-libdir=/usr/lib
 --with-rocm=/opt/rocm
