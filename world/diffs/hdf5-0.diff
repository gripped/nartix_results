--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -4,8 +4,8 @@
   hdf5
   hdf5-openmpi
 )
-pkgver=2.0.0
-pkgrel=3
+pkgver=1.14.6
+pkgrel=5
 pkgdesc="General purpose library and file format for storing scientific data"
 arch=(x86_64)
 url="https://www.hdfgroup.org/hdf5"
@@ -26,8 +26,17 @@
 )
 replaces=(hdf5-java)
 provides=(hdf5-java)
-source=("https://github.com/HDFGroup/hdf5/archive/hdf5_$pkgver/$pkgname-$pkgver.tar.gz")
-sha512sums=('609e129f78c6777a0e64694de8ec638326a616ff9cbd916f310dc6f78435ef67194c5ab59faedda09c85c045c15ebe2ec4ce04fa905d5f74801600e067c27fcc')
+source=(
+  "https://github.com/HDFGroup/hdf5/archive/hdf5_$pkgver/$pkgname-$pkgver.tar.gz"
+  "$pkgbase-make-reproducible.patch"
+)
+sha256sums=('09ee1c671a87401a5201c06106650f62badeea5a3b3941e9b1e2e1e08317357f'
+            '37eb26bd2fab59299401c5702b8f0ad23a57e6368a257c426f7ef5ed0ef5c9ca')
+
+prepare() {
+  cd ${pkgbase}-${pkgbase}_${pkgver/_/-}
+  patch -p1 < ../$pkgbase-make-reproducible.patch
+}
 
 build() {
   cd ${pkgbase}-${pkgbase}_${pkgver/_/-}
@@ -41,7 +50,7 @@
     -DHDF5_BUILD_HL_LIB=ON
     -DHDF5_BUILD_FORTRAN=ON
     -DHDF5_BUILD_JAVA=ON
-    -DHDF5_ENABLE_ZLIB_SUPPORT=ON
+    -DHDF5_ENABLE_Z_LIB_SUPPORT=ON
     -DHDF5_ENABLE_SZIP_SUPPORT=ON
     -DHDF5_ENABLE_SZIP_ENCODING=ON
     -DHDF5_INSTALL_CMAKE_DIR=lib/cmake/hdf5
@@ -52,43 +61,36 @@
     -DCMAKE_CXX_COMPILER=mpicxx \
     -DCMAKE_C_COMPILER=mpicc \
     -DCMAKE_Fortran_COMPILER=mpif90 \
-    -DHDF5_ENABLE_PARALLEL=ON \
-    -DHDF5_ALLOW_UNSUPPORTED=ON
+    -DHDF5_ENABLE_PARALLEL=ON
   cmake --build build
   cmake --build build-mpi
 }
 
 check() {
   cd ${pkgbase}-${pkgbase}_${pkgver/_/-}
+  ctest --test-dir build --output-on-failure --parallel \
+    -E 'H5_H5DUMP-f90_h5ex_t_stringC_F03'
+
   local skipped_tests=(
     H5SHELL-test_swmr
     H5TEST-dsets
     H5TEST-set_extent
-    MPI_TEST_FORT_async_test
-    MPI_TEST_FORT_parallel_test
     MPI_TEST_t_bigio
     MPI_TEST_t_cache
-    MPI_TEST_t_pmulti_dset
-    MPI_TEST_t_select_io_dset
-    H5_H5DUMP-f90_h5ex_t_vlen_F03
-    MPI_TEST_H5DIFF-h5diff
-    MPI_TEST_H5_f90_ph5_f90_filtered_writes_no_sel
-    MPI_TEST_PERFORM_h5perf
     MPI_TEST_t_2Gio
     MPI_TEST_t_filters_parallel
     MPI_TEST_t_shapesame
     MPI_TEST_testphdf5
   )
   skipped_tests_pattern="${skipped_tests[0]}$(printf '|%s' "${skipped_tests[@]:1}")"
-  ctest --test-dir build --output-on-failure --parallel -E "$skipped_tests_pattern"
-  ctest --test-dir build-mpi --output-on-failure --parallel -E "$skipped_tests_pattern"
+  ctest --test-dir build-mpi --output-on-failure -E "$skipped_tests_pattern"
 }
 
 package_hdf5() {
   cd ${pkgbase}-${pkgbase}_${pkgver/_/-}
   DESTDIR="$pkgdir" cmake --install build
-  rm -vr "$pkgdir/usr/share/LICENSE"
-  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE
+  rm -vr "$pkgdir/usr/share/COPYING"
+  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" COPYING
 }
 
 package_hdf5-openmpi() {
@@ -99,6 +101,6 @@
 
   cd ${pkgbase}-${pkgbase}_${pkgver/_/-}
   DESTDIR="$pkgdir" cmake --install build-mpi
-  rm -vr "$pkgdir/usr/share/LICENSE"
-  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE
+  rm -vr "$pkgdir/usr/share/COPYING"
+  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" COPYING
 }


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,3 +1,7 @@
+prepare() {
+cd ${pkgbase}-${pkgbase}_${pkgver/_/-}
+patch -p1 < ../$pkgbase-make-reproducible.patch
+}
 build() {
 cd ${pkgbase}-${pkgbase}_${pkgver/_/-}
 local common_cmake_args=(
@@ -10,7 +14,7 @@
 -DHDF5_BUILD_HL_LIB=ON
 -DHDF5_BUILD_FORTRAN=ON
 -DHDF5_BUILD_JAVA=ON
--DHDF5_ENABLE_ZLIB_SUPPORT=ON
+-DHDF5_ENABLE_Z_LIB_SUPPORT=ON
 -DHDF5_ENABLE_SZIP_SUPPORT=ON
 -DHDF5_ENABLE_SZIP_ENCODING=ON
 -DHDF5_INSTALL_CMAKE_DIR=lib/cmake/hdf5
@@ -21,8 +25,7 @@
 -DCMAKE_CXX_COMPILER=mpicxx \
 -DCMAKE_C_COMPILER=mpicc \
 -DCMAKE_Fortran_COMPILER=mpif90 \
--DHDF5_ENABLE_PARALLEL=ON \
--DHDF5_ALLOW_UNSUPPORTED=ON
+-DHDF5_ENABLE_PARALLEL=ON
 cmake --build build
 cmake --build build-mpi
 }
