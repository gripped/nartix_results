--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,27 +1,27 @@
 
 pkgname=magic-wormhole
-pkgver=0.18.0
+pkgver=0.17.0
 pkgrel=1
 pkgdesc="Securely transfer data between computers"
 arch=(any)
 url="https://github.com/magic-wormhole/magic-wormhole"
 license=(MIT)
 depends=(python-autobahn
+         python-cffi
          python-click
+         python-hkdf
          python-humanize
          python-idna
          python-iterable-io
          python-pynacl
          python-pyopenssl
-         python-qrcode
          python-service-identity
          python-spake2
          python-tqdm
          python-txtorcon
          python-zipstream-ng)
 makedepends=(python-{build,installer,wheel}
-             python-setuptools
-             python-versioneer)
+             python-setuptools)
 checkdepends=(python-magic-wormhole-mailbox-server
               python-magic-wormhole-transit-relay
               python-noiseprotocol
@@ -29,12 +29,7 @@
               python-pytest-mock)
 _archive="$pkgname-$pkgver"
 source=("$url/archive/$pkgver/$_archive.tar.gz")
-sha512sums=('731fc2207db5b3590bd00313d2bf22e68a8db1e0ea094bf47cb3fb48d35662f86c5920be081383fd6e82394f686907b1c8c08642ea6d90b1338f974c2a5ce24c')
-
-prepare() {
-	cd "${pkgname#python-}-$pkgver"
-	rm -f versioneer.py
-}
+sha512sums=('098688f42bb16f71c24f3e3aefa39166b3f4250955359cb9c90d125e2e261a95bf180296e00e9d656f43817dc6c9b2e54ce3d2c222fdad4198ac7e005814ecf7')
 
 build() {
 	cd "$_archive"
@@ -47,7 +42,7 @@
 	local deselected=(
 		src/wormhole/test/test_tor_manager.py
 	)
-	pytest ${deselected[@]/#/--deselect }
+	pytest ${deselected[@]/#/--deselect } ||:
 }
 
 package() {


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,18 +1,18 @@
 python-autobahn
 python-build
+python-cffi
 python-click
+python-hkdf
 python-humanize
 python-idna
 python-installer
 python-iterable-io
 python-pynacl
 python-pyopenssl
-python-qrcode
 python-service-identity
 python-setuptools
 python-spake2
 python-tqdm
 python-txtorcon
-python-versioneer
 python-wheel
 python-zipstream-ng

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,3 @@
-prepare() {
-cd "${pkgname#python-}-$pkgver"
-rm -f versioneer.py
-}
 build() {
 cd "$_archive"
 python -m build -wn
