--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -2,29 +2,38 @@
 pkgname=python-sphinxcontrib-autoprogram
 pkgver=0.1.8
 _commit=b6df97b08e1c28684911f7704422da074d4c4e27
-pkgrel=2
+pkgrel=3
 pkgdesc="Documenting CLI programs"
 url="https://github.com/sphinx-contrib/autoprogram"
-license=('BSD')
+license=('BSD-2-Clause')
 arch=('any')
-depends=('python-sphinx' 'python-six')
-makedepends=('git' 'python-setuptools')
+depends=('python-sphinx')
+makedepends=('git' 'python-setuptools' 'python-build' 'python-installer' 'python-wheel')
 source=("git+https://github.com/sphinx-contrib/autoprogram.git#commit=$_commit")
 sha512sums=('SKIP')
 
+prepare() {
+  cd autoprogram
+  git cherry-pick -n 63e934c2a807f5a6babca50bfb487654a194392e
+  git cherry-pick -n 79cfb42f5dc3a57ff9cac249f98fe3577cea4d8c
+}
+
 build() {
   cd autoprogram
-  python setup.py build
+  python -m build --wheel --no-isolation
 }
 
 check() {
   cd autoprogram
-  python setup.py test
+  python -m venv --system-site-packages local-env
+  local-env/bin/python -m installer dist/*.whl
+
+  PYTHONPATH="$PWD"/doc local-env/bin/python -m unittest sphinxcontrib.autoprogram.suite -v
 }
 
 package() {
   cd autoprogram
-  python setup.py install --root="$pkgdir" --optimize=1
+  python -m installer --destdir="$pkgdir" dist/*.whl
 
   install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
 }


############# Stripped diff below #################

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,6 +1,11 @@
 pkgname=python-sphinxcontrib-autoprogram
-depends=('python-sphinx' 'python-six')
+depends=('python-sphinx')
+prepare() {
+cd autoprogram
+git cherry-pick -n 63e934c2a807f5a6babca50bfb487654a194392e
+git cherry-pick -n 79cfb42f5dc3a57ff9cac249f98fe3577cea4d8c
+}
 build() {
 cd autoprogram
-python setup.py build
+python -m build --wheel --no-isolation
 }
