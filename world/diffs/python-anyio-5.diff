--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,13 +1,13 @@
 
 pkgname=python-anyio
-pkgver=4.9.0
+pkgver=4.8.0
 pkgrel=1
 pkgdesc='High level compatibility layer for multiple asynchronous event loop implementations'
 arch=(any)
 url='https://github.com/agronholm/anyio'
 license=(MIT)
 depends=(python python-idna python-sniffio)
-makedepends=(git python-build python-installer python-setuptools python-setuptools-scm python-wheel
+makedepends=(python-build python-installer python-setuptools python-setuptools-scm python-wheel
              python-uvloop python-trio)
 checkdepends=(python-pytest python-trustme python-hypothesis python-pytest-mock python-psutil
               python-truststore python-exceptiongroup)
@@ -17,31 +17,31 @@
   'python-uvloop: use uvloop for asyncio backend'
   'python-pytest: pytest plugin'
 )
-source=("git+https://github.com/agronholm/anyio.git#tag=$pkgver")
-sha256sums=('9a5a9a12ad2a3e1487a2031f390f184d8c8e71a8d1dd7dbb0ceef4bfade4bcd9')
+source=(https://github.com/agronholm/anyio/archive/$pkgver/anyio-$pkgver.tar.gz)
+sha256sums=('cd08cb8d7a0413ae8d7b641261f34a566db2299be425c81fe05100eea97d4c77')
 
 export SETUPTOOLS_SCM_PRETEND_VERSION=$pkgver
 
 prepare() {
-  cd anyio
-  git cherry-pick -n 71081fbeb0576c9cbcbc69bab0a66e6a3d06e5ac
+  cd anyio-$pkgver
   sed -i '/"error"/d' pyproject.toml
 }
 
 build() {
-  cd anyio
+  cd anyio-$pkgver
   python -m build --wheel --no-isolation
 }
 
 check() {
-  cd anyio
+  cd anyio-$pkgver
   pyver=$(python -c "import sys; print('{}.{}'.format(*sys.version_info[:2]))")
   python -m installer --destdir="$PWD/tmp_install" dist/*.whl
-  PYTHONPATH="$PWD/tmp_install/usr/lib/python$pyver/site-packages" pytest
+  PYTHONPATH="$PWD/tmp_install/usr/lib/python$pyver/site-packages" pytest \
+  --deselect 'tests/test_sockets.py'
 }
 
 package() {
-  cd anyio
+  cd anyio-$pkgver
   python -m installer --destdir="$pkgdir" dist/*.whl
   install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,4 +1,3 @@
-git
 python
 python-build
 python-idna

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,9 +1,8 @@
 prepare() {
-cd anyio
-git cherry-pick -n 71081fbeb0576c9cbcbc69bab0a66e6a3d06e5ac
+cd anyio-$pkgver
 sed -i '/"error"/d' pyproject.toml
 }
 build() {
-cd anyio
+cd anyio-$pkgver
 python -m build --wheel --no-isolation
 }
