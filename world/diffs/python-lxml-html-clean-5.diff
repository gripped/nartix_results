--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,34 +1,54 @@
 
-_pyname=lxml-html-clean
-pkgname=python-$_pyname
-pkgver=0.2.0
-pkgrel=2
+pkgname=python-lxml-html-clean
+pkgver=0.4.2
+pkgrel=1
 pkgdesc='HTML cleaner from lxml project'
 arch=(any)
-url="https://$_pyname.readthedocs.org/"
+url='https://lxml-html-clean.readthedocs.io/'
 license=(BSD-3-Clause)
-depends=(python
-         python-lxml)
-makedepends=(python-{build,installer,wheel}
-             python-setuptools)
+depends=(
+  python
+  python-lxml
+)
+makedepends=(
+  git
+  python-build
+  python-installer
+  python-setuptools
+  python-wheel
+)
 checkdepends=(python-pytest)
-_archive="${_pyname//-/_}-$pkgver"
-source=("https://files.pythonhosted.org/packages/source/${_pyname::1}/$_pyname/$_archive.tar.gz")
-sha256sums=('47c323f39d95d4cbf4956da62929c89a79313074467efaa4821013c97bf95628')
+source=("$pkgname::git+https://github.com/fedora-python/lxml_html_clean#tag=$pkgver")
+sha512sums=('d8cf542e0741346cdd08d6357148c4db6191b3a2c1a373b2345e185f6705966e7b399f7ad07aee8f5a13a042ddcbf35125837d87f69801a10c3a5f97b9fa2b98')
+b2sums=('3057edaaf73a1b4a1162165e71c9ca592905ca8470e1082b98988b04996d095925bfb3dc86f4612a1a09802335ecb64aebcb923c978471e87da4a4e722d615e5')
 
 build() {
-	cd "$_archive"
-	python -m build -wn
+  cd "$pkgname"
+
+  python -m build --wheel --no-isolation
 }
 
 check() {
-	cd "$_archive"
-	export PYTHONPATH=.
-	pytest
+  cd "$pkgname"
+
+  export PYTHONPATH=.
+
+  local deselected=(
+    tests/test_autolink.txt::test_autolink.txt
+    tests/test_clean.py::CleanerTest::test_host_whitelist_invalid
+    tests/test_clean.py::CleanerTest::test_host_whitelist_sneaky_userinfo
+    tests/test_clean.py::CleanerTest::test_host_whitelist_valid
+    tests/test_clean.txt::test_clean.txt
+    tests/test_clean_embed.txt::test_clean_embed.txt
+  )
+
+  pytest -v ${deselected[@]/#/--deselect }
 }
 
 package() {
-	cd "$_archive"
-	python -m installer -d "$pkgdir" dist/*.whl
-	install -Dm0644 -t "$pkgdir/usr/share/licenses/$pkgname/" LICENSE.txt
+  cd "$pkgname"
+
+  python -m installer --destdir="$pkgdir" dist/*.whl
+
+  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE.txt
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,6 +0,0 @@
-python
-python-build
-python-installer
-python-lxml
-python-setuptools
-python-wheel

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,4 +1,4 @@
 build() {
-cd "$_archive"
-python -m build -wn
+cd "$pkgname"
+python -m build --wheel --no-isolation
 }
