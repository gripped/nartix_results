--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,29 +1,18 @@
 
 _gemname='drb'
 pkgname="ruby-${_gemname}"
-pkgver=2.2.1
-pkgrel=1
+pkgver=2.1.0
+pkgrel=6
 pkgdesc='Distributed object system for Ruby'
 arch=('any')
 url="https://github.com/ruby/${_gemname}"
 license=('BSD' 'RUBY')
-depends=(
-  ruby
-  ruby-ruby2_keywords
-)
-makedepends=(
-  ruby-rdoc
-)
-checkdepends=(
-  ruby-bundler
-  ruby-rake
-  ruby-test-unit
-  ruby-test-unit-ruby-core
-)
+depends=('ruby' 'ruby-ruby2_keywords')
+checkdepends=('ruby-rake')
 options=('!emptydirs')
 source=("${url}/archive/v${pkgver}/${pkgname}-${pkgver}.tar.gz")
-sha512sums=('f896c068306908977a3554ba9adc88ec8e145a6ef60c2b32ab15402a1d20ff206ddbcce955b7e7f19bdbbd8613521819a56733bf0d2ee28e72242a7f5257cf38')
-b2sums=('a09b88835cb211b9599d4b714c3921c6bd4c35171e58cfcf5b7e68e8811b6a253ecdf9ebc697d1c5007fdd4e246effb73183c2440b4187fda060fcf314764ec0')
+sha512sums=('d769d3527c54cd6e9bca2dd07e3332cb0fcbc4d6fc0ad32b0ffb83e8c31e0f8423dcd34863ad126b970aab0e6245fa16dbf7949253c613e5a02cbf30f8a650da')
+b2sums=('cbc5266c435e163d1ae84852c044347133ae3a7fd032a65f832da8f1c45d546d94d42ca27e7d69ac8e791f5c3a00ad65008b4fab96c8485f58cf55646530378b')
 
 prepare() {
   cd "${_gemname}-${pkgver}"
@@ -35,42 +24,47 @@
   cd "${_gemname}-${pkgver}"
 
   local _gemdir="$(gem env gemdir)"
+  local _platform="$(gem env platform | cut -d':' -f2)"
+  local _extension_api_version="$(ruby -e 'puts Gem.extension_api_version')"
 
-  gem build --verbose "${_gemname}.gemspec"
+  install --verbose --directory --mode=0755 \
+    "tmp_install_default/gemspec/specifications/gems/${_gemname}-${pkgver}" \
+    "tmp_install/usr/lib/ruby/${_extension_api_version}/${_platform}" \
+    "tmp_install${_gemdir}/specifications/default"
+
+  gem build "${_gemname}.gemspec"
 
   gem install \
     --local \
     --verbose \
     --ignore-dependencies \
     --no-user-install \
-    --install-dir "tmp_install${_gemdir}" \
+    --install-dir "tmp_install/${_gemdir}" \
     --bindir "tmp_install/usr/bin" \
     "${_gemname}-${pkgver}.gem"
 
+  gem install \
+    --default \
+    --local \
+    --verbose \
+    --ignore-dependencies \
+    --no-user-install \
+    --install-dir "tmp_install_default/gemspec" \
+    --bindir "tmp_install_default/usr/bin" \
+    "${_gemname}-${pkgver}.gem"
+
+  mv --verbose "tmp_install_default/gemspec/specifications/default/${_gemname}-${pkgver}.gemspec" "tmp_install${_gemdir}/specifications/default/${_gemname}-${pkgver}.gemspec"
+  mv --verbose "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}.rb" "tmp_install/usr/lib/ruby/${_extension_api_version}/${_gemname}.rb"
+  mv --verbose "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}" "tmp_install/usr/lib/ruby/${_extension_api_version}/${_gemname}"
+
   rm --force --recursive --verbose \
     "tmp_install${_gemdir}/cache/" \
-    "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
+    "tmp_install${_gemdir}/build_info/" \
+    "tmp_install${_gemdir}/extensions/" \
+    "tmp_install${_gemdir}/gems/" \
+    "tmp_install${_gemdir}/plugins/" \
+    "tmp_install${_gemdir}/specifications/${_gemname}-${pkgver}.gemspec" \
     "tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
-
-  find "tmp_install${_gemdir}/gems/" \
-    -type f \
-    \( \
-      -iname "*.o" -o \
-      -iname "*.c" -o \
-      -iname "*.so" -o \
-      -iname "*.time" -o \
-      -iname "gem.build_complete" -o \
-      -iname "Makefile" \
-    \) \
-    -delete
-
-  find "tmp_install${_gemdir}/extensions/" \
-    -type f \
-    \( \
-      -iname "mkmf.log" -o \
-      -iname "gem_make.out" \
-    \) \
-    -delete
 }
 
 check() {
@@ -78,7 +72,7 @@
 
   local _gemdir="$(gem env gemdir)"
 
-  GEM_HOME="tmp_install${_gemdir}" rake test
+  GEM_HOME="tmp_install/${_gemdir}" rake test
 }
 
 package() {
@@ -86,7 +80,7 @@
 
   cp --archive --verbose tmp_install/* "${pkgdir}"
 
-  install --verbose -D --mode=0644 LICENSE* --target-directory "${pkgdir}/usr/share/licenses/${pkgname}"
+  install --verbose -D --mode=0644 LICENSE.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
   install --verbose -D --mode=0644 *.md --target-directory "${pkgdir}/usr/share/doc/${pkgname}"
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,3 +1,2 @@
 ruby
-ruby-rdoc
 ruby-ruby2_keywords

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -5,35 +5,39 @@
 build() {
 cd "${_gemname}-${pkgver}"
 local _gemdir="$(gem env gemdir)"
-gem build --verbose "${_gemname}.gemspec"
+local _platform="$(gem env platform | cut -d':' -f2)"
+local _extension_api_version="$(ruby -e 'puts Gem.extension_api_version')"
+install --verbose --directory --mode=0755 \
+"tmp_install_default/gemspec/specifications/gems/${_gemname}-${pkgver}" \
+"tmp_install/usr/lib/ruby/${_extension_api_version}/${_platform}" \
+"tmp_install${_gemdir}/specifications/default"
+gem build "${_gemname}.gemspec"
 gem install \
 --local \
 --verbose \
 --ignore-dependencies \
 --no-user-install \
---install-dir "tmp_install${_gemdir}" \
+--install-dir "tmp_install/${_gemdir}" \
 --bindir "tmp_install/usr/bin" \
 "${_gemname}-${pkgver}.gem"
+gem install \
+--default \
+--local \
+--verbose \
+--ignore-dependencies \
+--no-user-install \
+--install-dir "tmp_install_default/gemspec" \
+--bindir "tmp_install_default/usr/bin" \
+"${_gemname}-${pkgver}.gem"
+mv --verbose "tmp_install_default/gemspec/specifications/default/${_gemname}-${pkgver}.gemspec" "tmp_install${_gemdir}/specifications/default/${_gemname}-${pkgver}.gemspec"
+mv --verbose "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}.rb" "tmp_install/usr/lib/ruby/${_extension_api_version}/${_gemname}.rb"
+mv --verbose "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}" "tmp_install/usr/lib/ruby/${_extension_api_version}/${_gemname}"
 rm --force --recursive --verbose \
 "tmp_install${_gemdir}/cache/" \
-"tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
+"tmp_install${_gemdir}/build_info/" \
+"tmp_install${_gemdir}/extensions/" \
+"tmp_install${_gemdir}/gems/" \
+"tmp_install${_gemdir}/plugins/" \
+"tmp_install${_gemdir}/specifications/${_gemname}-${pkgver}.gemspec" \
 "tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
-find "tmp_install${_gemdir}/gems/" \
--type f \
-\( \
--iname "*.o" -o \
--iname "*.c" -o \
--iname "*.so" -o \
--iname "*.time" -o \
--iname "gem.build_complete" -o \
--iname "Makefile" \
-\) \
--delete
-find "tmp_install${_gemdir}/extensions/" \
--type f \
-\( \
--iname "mkmf.log" -o \
--iname "gem_make.out" \
-\) \
--delete
 }
