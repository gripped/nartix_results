--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,27 +1,38 @@
 
 pkgname=libtiff
 pkgver=4.6.0
-pkgrel=4
+pkgrel=2
 pkgdesc='Library for manipulation of TIFF images'
 url='http://www.simplesystems.org/libtiff/'
 arch=('x86_64')
 license=('custom')
 depends=('gcc-libs' 'glibc' 'jbigkit' 'libjpeg-turbo' 'libjpeg.so' 'zlib' 'xz' 'zstd')
-makedepends=('freeglut' 'git' 'glu' 'mesa')
+makedepends=('freeglut' 'glu' 'mesa')
 optdepends=('freeglut: for using tiffgt')
 provides=('libtiff.so' 'libtiffxx.so')
-source=("git+https://gitlab.com/libtiff/libtiff.git?signed#tag=v${pkgver}")
-sha256sums=('039e243f1f37459833b9c3475e62d245f9593e61e8f4be5843f2d7af711c45f9')
-b2sums=('e3c31b9afefecdcafb52d174840c2eee8cb4dd43ff1a81eef52a09e0753cfb247775baa7a42b865e518f2cdaa04828e4acbb43a0ead373b1251b2d0c03f8d0a6')
+source=("https://download.osgeo.org/libtiff/tiff-${pkgver}.tar.gz"{,.sig}
+        "https://gitlab.com/libtiff/libtiff/-/commit/5320c9d89c054fa805d037d84c57da874470b01a.patch")
+sha256sums=('88b3979e6d5c7e32b50d7ec72fb15af724f6ab2cbf7e10880c360a77e4b5d99a'
+            'SKIP'
+            '7988575f4caa27e406aee172354ec5c9ff7271813988a753c2643a9ca0825ca8')
+b2sums=('aa3d51ffb7d800424a05e6a12e2eaad41adfe7d676650d2857bcc073a25627be88372410a27126e9c067692060c26bd2dec80a42a2188197f6f3ff9d8507fc8f'
+        'SKIP'
+        'f0ecae3d1b75133823aa9361caeb3123ddda72d21748552daf2bcf9c771ace743b888956d6320593e85f9b2f0fc558f21bceabf81312ed5f5845859e3f7c9199')
 validpgpkeys=(
   'EBDFDB21B020EE8FD151A88DE301047DE1198975' # Bob Friesenhahn <bfriesen@simple.dallas.tx.us>
   'B1FA7D81EEB8E66399178B9733EBBFC47B3DD87D' # Even Rouault <even.rouault@spatialys.com>
 )
 
 prepare() {
-  cd libtiff
-  git cherry-pick -n 5320c9d89c054fa805d037d84c57da874470b01a
-  autoreconf -fiv
+  cd tiff-${pkgver//rc*/}
+  local src
+  for src in "${source[@]}"; do
+    src="${src%%::*}"
+    src="${src##*/}"
+    [[ $src = *.patch ]] || continue
+    echo "Applying patch $src..."
+    patch -Np1 < "../$src"
+  done
 }
 
 build() {
@@ -33,19 +44,19 @@
     --with-docdir=/usr/share/doc/${pkgname}
   )
 
-  cd libtiff
+  cd tiff-${pkgver//rc*/}
   ./configure "${configure_options[@]}"
   sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
   make
 }
 
 check() {
-  cd libtiff
+  cd tiff-${pkgver//rc*/}
   make check
 }
 
 package() {
-  cd libtiff
+  cd tiff-${pkgver//rc*/}
   make DESTDIR="${pkgdir}" install
   install -Dm 644 LICENSE.md -t "${pkgdir}/usr/share/licenses/${pkgname}/"
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,6 +1,5 @@
 freeglut
 gcc-libs
-git
 glibc
 glu
 jbigkit

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,13 @@
 prepare() {
-cd libtiff
-git cherry-pick -n 5320c9d89c054fa805d037d84c57da874470b01a
-autoreconf -fiv
+cd tiff-${pkgver//rc*/}
+local src
+for src in "${source[@]}"; do
+src="${src%%::*}"
+src="${src##*/}"
+[[ $src = *.patch ]] || continue
+echo "Applying patch $src..."
+patch -Np1 < "../$src"
+done
 }
 build() {
 local configure_options=(
@@ -11,7 +17,7 @@
 --mandir=/usr/share/man
 --with-docdir=/usr/share/doc/${pkgname}
 )
-cd libtiff
+cd tiff-${pkgver//rc*/}
 ./configure "${configure_options[@]}"
 sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
 make
