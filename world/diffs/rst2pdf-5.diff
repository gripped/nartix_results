--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,7 @@
 
 pkgname=rst2pdf
-pkgver=0.103.1
-pkgrel=3
+pkgver=0.102
+pkgrel=2
 pkgdesc="Use a text editor. Make a PDF"
 arch=(any)
 url="https://github.com/rst2pdf/rst2pdf"
@@ -19,7 +19,6 @@
   python-yaml
 )
 makedepends=(
-  git
   python-build
   python-installer
   python-setuptools-scm
@@ -30,9 +29,8 @@
   plantuml
   python-aafigure
   python-matplotlib
+  python-pytest
   python-pymupdf
-  python-pytest
-  python-pytest-xdist
   python-sphinx
   python-svglib
 )
@@ -44,45 +42,33 @@
   'python-sphinx: for sphinx support'
   'python-svglib: for SVG support'
 )
-source=(
-  "git+$url.git#tag=$pkgver"
-  $pkgname-0.103.1-vendor-docutils-roman-api.patch
-)
-sha512sums=('9366787ccff062018509abd6d9477ac5120085d2c6004d265975a502def5be90e1c76130d14603d4d95987078bc24487e97b530504aa0bcb9443d9d3674d2a5f'
-            '1670680d3b0e58f6b060a8044ee9440f695c21e306a16e030fde7dd4047b48f2fb6c70da61152eafc05f07f7abee2bd8af15ca9d5efb05d20dd4f59085090396')
-b2sums=('b4e144bc9354778fb8130f47382681b8bd2ac9d68e7843f463f75c26b272bf89ffe97078bbdad03122fb054ccd9c33b5fb9f15d23a2162be9f283e44a6b78b78'
-        '02274861109c5fcc07a8837cfb5c6133a920cf3fc89223165ba0127ce71c074529990d7054b1a49898f39a81d82828fe853e94c5598e4b7719904988a719de47')
-
-prepare() {
-  patch -Np1 -d $pkgname -i ../$pkgname-0.103.1-vendor-docutils-roman-api.patch
-}
+source=($pkgname-$pkgver.tar.gz::$url/archive/refs/tags/$pkgver.tar.gz)
+sha512sums=('39b6e280741ee58a36e34328a11edf26644b470cefc270b0fc6a50cdf20fb15bb068aa52c5e8da2a58e06085ecbaf730c00b58db4bcc42c2682cf0efb6f5c7be')
+b2sums=('1765d2b469218a3909c809aa96d89bf82bbf972d3a1c99a3b56de9ba61e3e51c140e62418683ba7584fd13d176713615414d8aed713e033fb8a5e3b24cd3f731')
 
 build() {
-  cd $pkgname
+  cd $pkgname-$pkgver
+  export SETUPTOOLS_SCM_PRETEND_VERSION=$pkgver
   python -m build --wheel --no-isolation
 }
 
 check() {
   local pytest_options=(
     -vv
-    --numprocesses=auto
-    --deselect=tests/input/test_raw_html.rst::test_raw_html
-    --deselect=tests/input/sphinx-issue284/conf.py::sphinx-issue284
-    --deselect=tests/input/test_issue_244.rst::test_issue_244
-    --deselect=tests/input/test_jpg_scaling.rst::test_jpg_scaling
-    --deselect=tests/input/test_malformed_rst.rst::test_malformed_rst
+    --deselect tests/input/test_raw_html.rst::test_raw_html
   )
+  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
 
-  cd $pkgname
-  python -m venv --system-site-packages test-env
-  test-env/bin/python -m installer dist/*.whl
-  export PYTHONPATH="$(test-env/bin/python -c "import site; print(site.getsitepackages()[0])")"
-  export PATH="$PATH:$PWD/test-env/bin"
-  test-env/bin/python -Pm pytest "${pytest_options[@]}"
+  cd $pkgname-$pkgver
+  python -m installer --destdir="test_dir" dist/*.whl
+
+  export PYTHONPATH="$PWD/test_dir/$site_packages:$PYTHONPATH"
+  export PATH="$PWD/test_dir/usr/bin:$PATH"
+  pytest "${pytest_options[@]}"
 }
 
 package() {
-  cd $pkgname
+  cd $pkgname-$pkgver
   python -m installer --destdir="$pkgdir" dist/*.whl
   install -vDm 644 {CHANGES,MAINTAINERS,README}.rst -t "$pkgdir/usr/share/doc/$pkgname/"
   install -vDm 644 LICENSE.txt -t "$pkgdir/usr/share/licenses/$pkgname/"


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,4 +1,3 @@
-git
 python
 python-build
 python-docutils

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,5 @@
-prepare() {
-patch -Np1 -d $pkgname -i ../$pkgname-0.103.1-vendor-docutils-roman-api.patch
-}
 build() {
-cd $pkgname
+cd $pkgname-$pkgver
+export SETUPTOOLS_SCM_PRETEND_VERSION=$pkgver
 python -m build --wheel --no-isolation
 }
