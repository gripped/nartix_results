--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,37 +1,80 @@
 
 _gemname=network_interface
 pkgname=ruby-${_gemname}
-pkgver=0.0.2
-pkgrel=10
+pkgver=0.0.4
+pkgrel=2
 pkgdesc='Library to get network interface information'
 url='https://github.com/rapid7/network_interface'
 arch=('x86_64')
 license=('MIT')
-depends=('ruby')
-makedepends=('ruby-rdoc')
+depends=(
+  ruby
+)
+makedepends=(
+  git
+  ruby-rdoc
+)
 options=('!emptydirs')
-source=(${pkgname}-${pkgver}.tar.gz::https://github.com/rapid7/network_interface/archive/v${pkgver}.tar.gz)
-sha512sums=('38174c4a1985ae82dc2459c21a7483a3cdbf6a0380814dc0b799a2bc250a3263fc8830d4127301041e7fc637dd6de45cd62214dd1a4d390b3acdb71cbae96d02')
+source=("git+${url}#tag=v${pkgver}")
+sha512sums=('6c70f861c3ea2c47f6e4da8a79f1d8d8f84211b496f345f8a066c3b868cb1104e96bdf046a234da82438cafd4798431e45f2e155a02e47c9125f6d63b42e54a1')
+b2sums=('d14ebaaa5794e28ece6938f973cd0ef5ce65e96d183d4f2b1c83aa1444b819d2055cf0247254afc1a77e70390a6b69b5971aaa87a71b413a64650824fa1a9ff3')
 
 prepare() {
-  cd ${_gemname}-${pkgver}
-  sed 's|git ls-files|find|' -i ${_gemname}.gemspec
+  cd "${_gemname}"
+
+  sed --in-place --regexp-extended \
+    --expression 's|~>|>=|g' \
+    "${_gemname}.gemspec"
 }
 
 build() {
-  cd ${_gemname}-${pkgver}
-  gem build ${_gemname}.gemspec
+  cd "${_gemname}"
+
+  local _gemdir="$(gem env gemdir)"
+
+  gem build --verbose "${_gemname}.gemspec"
+
+  gem install \
+    --local \
+    --verbose \
+    --ignore-dependencies \
+    --no-user-install \
+    --install-dir "tmp_install${_gemdir}" \
+    --bindir "tmp_install/usr/bin" \
+    "${_gemname}-${pkgver}.gem"
+
+  rm --force --recursive --verbose \
+    "tmp_install${_gemdir}/cache/" \
+    "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
+    "tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
+
+  find "tmp_install${_gemdir}/gems/" \
+    -type f \
+    \( \
+      -iname "*.o" -o \
+      -iname "*.c" -o \
+      -iname "*.so" -o \
+      -iname "*.time" -o \
+      -iname "gem.build_complete" -o \
+      -iname "Makefile" \
+    \) \
+    -delete
+
+  find "tmp_install${_gemdir}/extensions/" \
+    -type f \
+    \( \
+      -iname "mkmf.log" -o \
+      -iname "gem_make.out" \
+    \) \
+    -delete
 }
 
 package() {
-  cd ${_gemname}-${pkgver}
-  local _gemdir="$(gem env gemdir)"
-  gem install --ignore-dependencies --no-user-install -i "${pkgdir}/${_gemdir}" -n "${pkgdir}/usr/bin" ${_gemname}-${pkgver}.gem
-  install -Dm 644 README.md -t "${pkgdir}/usr/share/doc/${pkgname}"
-  install -Dm 644 LICENSE -t "${pkgdir}/usr/share/licenses/${pkgname}"
-  find "${pkgdir}" \( -name gem_make.out -o -name mkmf.log \) -delete
-  rm "${pkgdir}/${_gemdir}/cache/${_gemname}-${pkgver}.gem" \
-    "${pkgdir}/${_gemdir}/gems/${_gemname}-${pkgver}/ext/network_interface_ext/Makefile"
-  rm -rf "${pkgdir}/${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
+  cd "${_gemname}"
+
+  cp --archive --verbose tmp_install/* "${pkgdir}"
+
+  install --verbose -D --mode=0644 LICENSE* --target-directory "${pkgdir}/usr/share/licenses/${pkgname}"
+  install --verbose -D --mode=0644 *.md --target-directory "${pkgdir}/usr/share/doc/${pkgname}"
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,2 +1,3 @@
+git
 ruby
 ruby-rdoc

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,8 +1,41 @@
 prepare() {
-cd ${_gemname}-${pkgver}
-sed 's|git ls-files|find|' -i ${_gemname}.gemspec
+cd "${_gemname}"
+sed --in-place --regexp-extended \
+--expression 's|~>|>=|g' \
+"${_gemname}.gemspec"
 }
 build() {
-cd ${_gemname}-${pkgver}
-gem build ${_gemname}.gemspec
+cd "${_gemname}"
+local _gemdir="$(gem env gemdir)"
+gem build --verbose "${_gemname}.gemspec"
+gem install \
+--local \
+--verbose \
+--ignore-dependencies \
+--no-user-install \
+--install-dir "tmp_install${_gemdir}" \
+--bindir "tmp_install/usr/bin" \
+"${_gemname}-${pkgver}.gem"
+rm --force --recursive --verbose \
+"tmp_install${_gemdir}/cache/" \
+"tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
+"tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
+find "tmp_install${_gemdir}/gems/" \
+-type f \
+\( \
+-iname "*.o" -o \
+-iname "*.c" -o \
+-iname "*.so" -o \
+-iname "*.time" -o \
+-iname "gem.build_complete" -o \
+-iname "Makefile" \
+\) \
+-delete
+find "tmp_install${_gemdir}/extensions/" \
+-type f \
+\( \
+-iname "mkmf.log" -o \
+-iname "gem_make.out" \
+\) \
+-delete
 }
