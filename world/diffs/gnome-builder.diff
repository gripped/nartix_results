--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,15 +1,19 @@
 
-pkgname=gnome-builder
+pkgbase=gnome-builder
+pkgname=(
+  gnome-builder
+  gnome-builder-clang
+  gnome-builder-flatpak
+)
 pkgver=45.0
-pkgrel=3
+pkgrel=5
 pkgdesc="An IDE for writing GNOME-based software"
 url="https://wiki.gnome.org/Apps/Builder"
 arch=(x86_64)
-license=(GPL3)
+license=(GPL-3.0-or-later)
 depends=(
   autoconf-archive
   cairo
-  clang
   cmark
   ctags
   d-spy
@@ -18,8 +22,6 @@
   devhelp
   editorconfig-core-c
   enchant
-  flatpak
-  flatpak-builder
   gdk-pixbuf2
   gjs
   glib2
@@ -53,6 +55,8 @@
 )
 makedepends=(
   appstream-glib
+  clang
+  flatpak
   git
   gobject-introspection
   llvm
@@ -67,12 +71,12 @@
 b2sums=('SKIP')
 
 pkgver() {
-  cd $pkgname
+  cd $pkgbase
   git describe --tags | sed 's/[^-]*-g/r&/;s/-/+/g'
 }
 
 prepare() {
-  cd $pkgname
+  cd $pkgbase
   git cherry-pick -n 7aaaecefc2ea8a37eaeae8b4d726d119d4eb8fa3 # Fix build
 }
 
@@ -81,7 +85,7 @@
     -D help=true
   )
 
-  arch-meson $pkgname build "${meson_options[@]}"
+  artix-meson $pkgbase build "${meson_options[@]}"
   meson compile -C build
 }
 
@@ -98,14 +102,49 @@
   dbus-run-session meson test -C build --print-errorlogs
 )
 
-package() {
+package_gnome-builder() {
   depends+=(libgit2.so)
   optdepends=(
     'bash-language-server: Shell code assistance'
+    'gnome-builder-clang: Clang integration'
+    'gnome-builder-flatpak: Flatpak integration'
     'python-lsp-server: Python code assistance'
   )
   groups=(gnome-extra)
 
   meson install -C build --destdir "$pkgdir"
+
+  mkdir -p {clang,flatpak}/usr/lib
+  mv {"$pkgdir",clang}/usr/lib/gnome-builder-clang
+  mv {"$pkgdir",flatpak}/usr/lib/gnome-builder-flatpak
 }
 
+package_gnome-builder-clang() {
+  pkgdesc+=" (clang module)"
+  depends=(
+    clang
+    gcc-libs
+    glib2
+    gtk4
+    gtksourceview5
+    jsonrpc-glib
+    libdex
+    libpeas-2
+  )
+  groups=(gnome-extra)
+
+  mv clang/* "$pkgdir"
+}
+
+package_gnome-builder-flatpak() {
+  pkgdesc+=" (flatpak module)"
+  depends=(
+    flatpak
+    gcc-libs
+    glib2
+  )
+  groups=(gnome-extra)
+
+  mv flatpak/* "$pkgdir"
+}
+


############# Stripped diff below #################

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,8 +1,12 @@
-pkgname=gnome-builder
+pkgbase=gnome-builder
+pkgname=(
+gnome-builder
+gnome-builder-clang
+gnome-builder-flatpak
+)
 depends=(
 autoconf-archive
 cairo
-clang
 cmark
 ctags
 d-spy
@@ -11,8 +15,6 @@
 devhelp
 editorconfig-core-c
 enchant
-flatpak
-flatpak-builder
 gdk-pixbuf2
 gjs
 glib2
@@ -45,14 +47,14 @@
 webkitgtk-6.0
 )
 prepare() {
-cd $pkgname
+cd $pkgbase
 git cherry-pick -n 7aaaecefc2ea8a37eaeae8b4d726d119d4eb8fa3 # Fix build
 }
 build() {
 local meson_options=(
 -D help=true
 )
-arch-meson $pkgname build "${meson_options[@]}"
+artix-meson $pkgbase build "${meson_options[@]}"
 meson compile -C build
 }
 check() (
@@ -64,8 +66,36 @@
 trap "kill $_w; wait" EXIT
 dbus-run-session meson test -C build --print-errorlogs
 )
-package() {
+package_gnome-builder() {
 depends+=(libgit2.so)
 groups=(gnome-extra)
 meson install -C build --destdir "$pkgdir"
+mkdir -p {clang,flatpak}/usr/lib
+mv {"$pkgdir",clang}/usr/lib/gnome-builder-clang
+mv {"$pkgdir",flatpak}/usr/lib/gnome-builder-flatpak
 }
+package_gnome-builder-clang() {
+pkgdesc+=" (clang module)"
+depends=(
+clang
+gcc-libs
+glib2
+gtk4
+gtksourceview5
+jsonrpc-glib
+libdex
+libpeas-2
+)
+groups=(gnome-extra)
+mv clang/* "$pkgdir"
+}
+package_gnome-builder-flatpak() {
+pkgdesc+=" (flatpak module)"
+depends=(
+flatpak
+gcc-libs
+glib2
+)
+groups=(gnome-extra)
+mv flatpak/* "$pkgdir"
+}
