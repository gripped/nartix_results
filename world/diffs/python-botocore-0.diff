--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,50 +1,51 @@
 
 pkgname=python-botocore
-pkgver=1.38.3
+pkgver=1.37.1
 pkgrel=1
 pkgdesc='A low-level interface to a growing number of Amazon Web Services'
 arch=('any')
 url="https://github.com/boto/botocore"
-license=('Apache-2.0')
-depends=(
-  'python'
-  'python-certifi'
-  'python-dateutil'
-  'python-jmespath'
-  'python-urllib3'
+license=('Apache')
+depends=('python' 'python-certifi' 'python-dateutil' 'python-jmespath' 'python-urllib3')
+makedepends=('python-build' 'python-installer' 'python-setuptools' 'python-wheel' 'python-awscrt')
+checkdepends=('python-pytest' 'python-pytest-xdist' 'python-jsonschema' 'procps-ng')
+optdepends=(
+  'python-awscrt'
 )
-makedepends=(
-  'python-awscrt'
-  'python-build'
-  'python-installer'
-  'python-setuptools'
-  'python-wheel'
-)
-checkdepends=(
-  'procps-ng'
-  'python-jsonschema'
-  'python-pytest'
-  'python-pytest-xdist'
-)
-optdepends=('python-awscrt: use AWS Common Runtime')
-source=("$url/archive/$pkgver/$pkgname-$pkgver.tar.gz")
-sha256sums=('5875cab5369bb23b996d00747589df7967717734205dd18649e051ea9f3527b7')
+source=($pkgname-$pkgver.tar.gz::$url/archive/$pkgver.tar.gz
+        tests-keep-env.diff)
+sha256sums=('00723ea258596b593257d672cbbb851691bb9cf3559b01bd41f038920548bc36'
+            '15c588d3f4cfcc0ef26fc4ff367eb6dc12dc2f303e299cbe397288089ee52a11')
+
+prepare() {
+  cd botocore-$pkgver
+  patch -Np1 -i ../tests-keep-env.diff
+}
 
 build() {
-  cd ${pkgname#python-}-$pkgver
+  cd botocore-$pkgver
   python -m build --wheel --no-isolation
 }
 
 check() {
-  cd ${pkgname#python-}-$pkgver
-  python -m venv --system-site-packages test-env
-  test-env/bin/python -m installer dist/*.whl
+  cd botocore-$pkgver
+
   export AWS_SECRET_ACCESS_KEY=fake_key
   export AWS_ACCESS_KEY_ID=fake_id
-  test-env/bin/python -m pytest tests -n auto --ignore=tests/integration
+
+  export PYTHONPATH="$PWD"
+
+  export PYTEST_XDIST_AUTO_NUM_WORKERS=$(echo "$MAKEFLAGS" | grep -oP '\-j\s*\K[0-9]+')
+  pytest_args=()
+  if [ -n "$PYTEST_XDIST_AUTO_NUM_WORKERS" ]; then
+    pytest_args+=(-n auto)
+  fi
+
+  pytest tests "${pytest_args[@]}" --ignore=tests/integration
 }
 
 package() {
-  cd ${pkgname#python-}-$pkgver
+  cd botocore-$pkgver
   python -m installer --destdir="$pkgdir" dist/*.whl
+  install -Dm644 LICENSE.txt "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
 }


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,4 +1,8 @@
+prepare() {
+cd botocore-$pkgver
+patch -Np1 -i ../tests-keep-env.diff
+}
 build() {
-cd ${pkgname#python-}-$pkgver
+cd botocore-$pkgver
 python -m build --wheel --no-isolation
 }
