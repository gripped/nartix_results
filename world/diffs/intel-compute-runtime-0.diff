--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,8 @@
 
 pkgname=intel-compute-runtime
-pkgver=24.17.29377.6
+pkgver=24.13.29138.7
 pkgrel=1
+_cl_headers_ver=2023.12.14
 pkgdesc="Intel(R) Graphics Compute Runtime for oneAPI Level Zero and OpenCL(TM) Driver"
 arch=(x86_64)
 url="https://01.org/compute-runtime"
@@ -13,21 +14,22 @@
 provides=(opencl-driver level-zero-driver)
 options=(!lto)
 source=(https://github.com/intel/compute-runtime/archive/${pkgver}/${pkgname}-${pkgver}.tar.gz
+        https://github.com/KhronosGroup/OpenCL-Headers/archive/v${_cl_headers_ver}/opencl-headers-${_cl_headers_ver}.tar.gz
         010-intel-compute-runtime-disable-werror.patch)
-sha256sums=('3b694bf881c28dc867e52b368c8272e7aba357835bf88576ebb91c2ba9c0f256'
-            '899809db77723b05787f10e3bb53aad99e981cc53aa275cec94e09ed7e16e04b')
+sha256sums=('96b2331ee98e800e6b6666f9ab0803a9d16430f8781f3cac1b3f2b81235dfd95'
+            '407d5e109a70ec1b6cd3380ce357c21e3d3651a91caae6d0d8e1719c69a1791d'
+            '0a03571882300426c14fa03161ea3ca211831bc3c9676995ac74293fd953af16')
 
 prepare() {
   patch -d compute-runtime-${pkgver} -Np1 -i "${srcdir}/010-intel-compute-runtime-disable-werror.patch"
 }
 
 build() {
+  export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
+  export CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
+
   CXXFLAGS+=' -DSANITIZER_BUILD=1'
   CFLAGS+=' -DSANITIZER_BUILD=1'
-
-  export CFLAGS="${CFLAGS/-Wp,-D_FORTIFY_SOURCE=?/}"
-  export CXXFLAGS="${CXXFLAGS/-Wp,-D_FORTIFY_SOURCE=?/}"
-
   cmake -B build -S compute-runtime-${pkgver} \
     -G 'Unix Makefiles' \
     -DCMAKE_BUILD_TYPE=Release \
@@ -40,7 +42,7 @@
     -DSUPPORT_DG1=ON \
     -DSUPPORT_DG2=ON \
     -DKHRONOS_GL_HEADERS_DIR=/usr/include \
-    -DKHRONOS_HEADERS_DIR=/usr/include \
+    -DKHRONOS_HEADERS_DIR="${srcdir}/OpenCL-Headers-${_cl_headers_ver}" \
     -DSKIP_UNIT_TESTS=1 \
     -Wno-dev
   cmake --build build


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -2,10 +2,10 @@
 patch -d compute-runtime-${pkgver} -Np1 -i "${srcdir}/010-intel-compute-runtime-disable-werror.patch"
 }
 build() {
+export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
+export CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
 CXXFLAGS+=' -DSANITIZER_BUILD=1'
 CFLAGS+=' -DSANITIZER_BUILD=1'
-export CFLAGS="${CFLAGS/-Wp,-D_FORTIFY_SOURCE=?/}"
-export CXXFLAGS="${CXXFLAGS/-Wp,-D_FORTIFY_SOURCE=?/}"
 cmake -B build -S compute-runtime-${pkgver} \
 -G 'Unix Makefiles' \
 -DCMAKE_BUILD_TYPE=Release \
@@ -18,7 +18,7 @@
 -DSUPPORT_DG1=ON \
 -DSUPPORT_DG2=ON \
 -DKHRONOS_GL_HEADERS_DIR=/usr/include \
--DKHRONOS_HEADERS_DIR=/usr/include \
+-DKHRONOS_HEADERS_DIR="${srcdir}/OpenCL-Headers-${_cl_headers_ver}" \
 -DSKIP_UNIT_TESTS=1 \
 -Wno-dev
 cmake --build build
