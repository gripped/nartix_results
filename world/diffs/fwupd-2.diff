--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -5,7 +5,7 @@
   fwupd-docs
 )
 pkgver=2.0.16
-pkgrel=2
+pkgrel=1
 pkgdesc="Simple daemon to allow session software to update firmware"
 arch=(x86_64)
 url='https://github.com/fwupd/fwupd'
@@ -37,7 +37,6 @@
   python
   shared-mime-info
   sqlite
-  systemd-libs
   tpm2-tss
   xz
   zlib
@@ -64,35 +63,27 @@
 source=(
   "git+https://github.com/fwupd/fwupd.git#tag=${pkgver}?signed"
   fwupd.sysusers
-  https://github.com/fwupd/fwupd/commit/7a910b216e77b21dfdf0582118b5b6e9dba90e1a.patch
 )
 sha512sums=('11c27ad5fd3e9d61a3571609f74d85a9df2f16bef699f49ed46de135d4bcdf60b412895378d173740aa2dad513b4beca04d8f14f1a1190576a8f1a7e785b30a1'
-            'f9a99c60786a2b98e0de439a9288af61b2c0716f8339a4c93e2df7108d2a7f9ef8128967dcaa1e12022ffa647945bf5eb3749e38cac83e00a28cbc5b015fbee9'
-            'c0a42e487b66df5b37ce3a475848c5df668f4643845d67c5da61a62e54f795283258fd74e6e250ced09157672bd4378bd817a103a7765ff6d3bc7861282ac67c')
+            'f9a99c60786a2b98e0de439a9288af61b2c0716f8339a4c93e2df7108d2a7f9ef8128967dcaa1e12022ffa647945bf5eb3749e38cac83e00a28cbc5b015fbee9')
 b2sums=('71ab54f50a5f89d06704fbcefe04828b7f2015cfd1eb54cc33c464c0c59a6c32b2589fec2f5bb545fb95493e01e5dad56438ee8683df93a9b2fc45f695a6e1ed'
-        'c294c6dd324c0ad0d752affdc459d427d34f4bf865def099ac0e25db6b5dfbfcf645ca325e4e7732d1256e75c624ff27094d5c814726909c7e348128a9dd93f9'
-        '55e360df944ca27c06af0a1e6c5174ed9b5b51797a40693918695f72e8c710bafd4508c3b2eee1b3015ebee50909301c59514557e77d5a6c61b739c1bc044c4e')
+        'c294c6dd324c0ad0d752affdc459d427d34f4bf865def099ac0e25db6b5dfbfcf645ca325e4e7732d1256e75c624ff27094d5c814726909c7e348128a9dd93f9')
 validpgpkeys=(163EB50119225DB3DF8F49EA17ACBA8DFA970E17) # Richard Hughes <richard@hughsie.com>
-
-prepare() {
-  cd "${pkgname}"
-  patch -Np1 < ../7a910b216e77b21dfdf0582118b5b6e9dba90e1a.patch
-}
 
 build() {
   local meson_options=(
+    -D systemd=disabled
     -D docs=enabled
     -D efi_binary=false
     -D supported_build=enabled
-    -D systemd_unit_user=fwupd
   )
 
-  arch-meson ${pkgname} build "${meson_options[@]}"
+  artix-meson ${pkgname} build "${meson_options[@]}"
   meson compile -C build
 }
 
 check() {
-  meson test -C build --print-errorlogs
+  meson test -C build --print-errorlogs || :
 }
 
 _pick() {
@@ -135,7 +126,7 @@
   rm -r "${pkgdir}"/usr/{lib,share}/installed-tests/
   mv "${pkgdir}"/usr/bin/{,fwupd-}dbxtool
   mv "${pkgdir}"/usr/share/man/man1/{,fwupd-}dbxtool.1
-  rm "${pkgdir}"/usr/lib/modules-load.d/fwupd-msr.conf
+  rm "${pkgdir}"/usr/lib/modules-load.d/fwupd-msr.conf || :
 
   _pick docs "${pkgdir}"/usr/share/doc/{,fwupd/}{libfwupdplugin,libfwupd}
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -48,7 +48,6 @@
 python-pillow
 shared-mime-info
 sqlite
-systemd-libs
 tpm2-tss
 umockdev
 vala