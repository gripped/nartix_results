--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,54 +1,43 @@
 
 pkgname=python-pyftpdlib
-_pkgname=${pkgname#python-}
-pkgver=1.5.10
-pkgrel=1
-pkgdesc="Extremely fast and scalable Python FTP server library"
-arch=(any)
-url="https://github.com/giampaolo/pyftpdlib"
-license=(MIT)
-depends=(python)
-makedepends=(
-  python-build
-  python-installer
-  python-setuptools
-  python-wheel
-)
-checkdepends=(
-  python-psutil
-  python-pyopenssl
-  python-pytest
-)
-optdepends=(
-  'python-pyopenssl: FTPS support'
-  'python-psutil: to keep track of FTP server memory usage'
-)
-source=("$pkgname-$pkgver.tar.gz::$url/archive/release-$pkgver/release-$pkgver.tar.gz")
-sha256sums=('993a48b652c0a2ab9af898fd3acbe422e8558ba91d1451eec20db2584a0178de')
-
-_archive="$_pkgname-release-$pkgver"
+pkgver=1.5.9
+pkgrel=2
+pkgdesc='Very fast asynchronous FTP server library'
+arch=('any')
+url='https://github.com/giampaolo/pyftpdlib/'
+license=('MIT')
+depends=('python')
+optdepends=('python-pyopenssl: FTPS support'
+            'python-psutil: to keep track of FTP server memory usage')
+makedepends=('python-build' 'python-installer' 'python-setuptools'
+             'python-wheel')
+checkdepends=('python-pytest' 'python-pyopenssl' 'python-psutil')
+source=("https://pypi.io/packages/source/p/pyftpdlib/pyftpdlib-$pkgver.tar.gz"
+        "regenerate-SSL-certificates-which-was-too-old-and-broke.patch")
+sha512sums=('3efa07f5522cee89d2bf60c93b1315dfb149da622f34e043aca0ac1c4336c0a0885d7238123068401afa6988da9cbde6adfac78f08918d3a14e84c17ebb8b32f'
+            '00687c9bf2ca1ad1efb0d4222b566510fb8c99241837f99ced5a5e6ee21891bf1a055bad3ff5fa4a291e4d1bb12f698aefa09a8aba4ed4b00aa427e072d804a8')
 
 prepare() {
-  cd "$_archive"
-
-  sed -i "s/packages=\['pyftpdlib', 'pyftpdlib.test'\]/packages=['pyftpdlib']/" setup.py
+  cd pyftpdlib-$pkgver
+  patch -Np1 -i ${srcdir}/regenerate-SSL-certificates-which-was-too-old-and-broke.patch
 }
 
 build() {
-  cd "$_archive"
-
-  python -m build --wheel --no-isolation --skip-dependency-check
+  cd pyftpdlib-$pkgver
+  python -m build --wheel --skip-dependency-check --no-isolation
 }
 
 check() {
-  cd "$_archive"
-
+  cd pyftpdlib-$pkgver
   pytest
 }
 
 package() {
-  cd "$_archive"
+  cd pyftpdlib-$pkgver
+  python -m installer --destdir="$pkgdir" dist/*.whl
 
-  python -m installer --destdir="$pkgdir" dist/*.whl
-  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE
+  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
+  install -d "$pkgdir"/usr/share/licenses/$pkgname
+  ln -s "$site_packages"/pyftpdlib-$pkgver.dist-info/LICENSE \
+    "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
 }


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,8 +1,8 @@
 prepare() {
-cd "$_archive"
-sed -i "s/packages=\['pyftpdlib', 'pyftpdlib.test'\]/packages=['pyftpdlib']/" setup.py
+cd pyftpdlib-$pkgver
+patch -Np1 -i ${srcdir}/regenerate-SSL-certificates-which-was-too-old-and-broke.patch
 }
 build() {
-cd "$_archive"
-python -m build --wheel --no-isolation --skip-dependency-check
+cd pyftpdlib-$pkgver
+python -m build --wheel --skip-dependency-check --no-isolation
 }
