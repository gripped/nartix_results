--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,27 +1,18 @@
 
 _gemname='csv'
 pkgname="ruby-${_gemname}"
-pkgver=3.3.2
-pkgrel=1
+pkgver=3.2.5
+pkgrel=5
 pkgdesc='CSV Reading and Writing '
 arch=('any')
 url="https://github.com/ruby/${_gemname}"
 license=('BSD' 'RUBY')
-depends=(
-  ruby
-)
-makedepends=(
-  ruby-rdoc
-)
-checkdepends=(
-  ruby-bundler
-  ruby-rake
-  ruby-test-unit
-)
+depends=('ruby')
+checkdepends=('ruby-rake')
 options=('!emptydirs')
 source=("${url}/archive/v${pkgver}/${pkgname}-${pkgver}.tar.gz")
-sha512sums=('58c0b217d13ac15afe2e438c5988301250034888876fe1a1e9027496538b85733a7d103310d216706c371012f09f3661a360b5c32375afb421ebd63ba456fd67')
-b2sums=('8885a28a355228ae4bc2c53e434498a17ac2f30a2cc074a4ef250f91225be6b19ad68c93cceee14ca9dc16625b66ff95506f4eed7eb3d3c9e09f041489e7f002')
+sha512sums=('2f41b7a51754843dd90213931e0bd2a29e7d1c03046a526d884c5677263fcb07110f507d7b91f2976693588799df1d261ce3d7f50d473206ce218def4a461250')
+b2sums=('d464e1d36568b30328a3b2b14a363e19f3364f9a18afc16caba3cdff86c9d5bb2565706eef4f5dc573eacb918330477892aab6d544136fe8d1eed4ed558a3860')
 
 prepare() {
   cd "${_gemname}-${pkgver}"
@@ -33,42 +24,47 @@
   cd "${_gemname}-${pkgver}"
 
   local _gemdir="$(gem env gemdir)"
+  local _platform="$(gem env platform | cut -d':' -f2)"
+  local _extension_api_version="$(ruby -e 'puts Gem.extension_api_version')"
 
-  gem build --verbose "${_gemname}.gemspec"
+  install --verbose --directory --mode=0755 \
+    "tmp_install_default/gemspec/specifications/gems/${_gemname}-${pkgver}" \
+    "tmp_install/usr/lib/ruby/${_extension_api_version}/${_platform}" \
+    "tmp_install${_gemdir}/specifications/default"
+
+  gem build "${_gemname}.gemspec"
 
   gem install \
     --local \
     --verbose \
     --ignore-dependencies \
     --no-user-install \
-    --install-dir "tmp_install${_gemdir}" \
+    --install-dir "tmp_install/${_gemdir}" \
     --bindir "tmp_install/usr/bin" \
     "${_gemname}-${pkgver}.gem"
 
+  gem install \
+    --default \
+    --local \
+    --verbose \
+    --ignore-dependencies \
+    --no-user-install \
+    --install-dir "tmp_install_default/gemspec" \
+    --bindir "tmp_install_default/usr/bin" \
+    "${_gemname}-${pkgver}.gem"
+
+  mv --verbose "tmp_install_default/gemspec/specifications/default/${_gemname}-${pkgver}.gemspec" "tmp_install${_gemdir}/specifications/default/${_gemname}-${pkgver}.gemspec"
+  mv --verbose "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}.rb" "tmp_install/usr/lib/ruby/${_extension_api_version}/${_gemname}.rb"
+  mv --verbose "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}" "tmp_install/usr/lib/ruby/${_extension_api_version}/${_gemname}"
+
   rm --force --recursive --verbose \
     "tmp_install${_gemdir}/cache/" \
-    "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
+    "tmp_install${_gemdir}/build_info/" \
+    "tmp_install${_gemdir}/extensions/" \
+    "tmp_install${_gemdir}/gems/" \
+    "tmp_install${_gemdir}/plugins/" \
+    "tmp_install${_gemdir}/specifications/${_gemname}-${pkgver}.gemspec" \
     "tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
-
-  find "tmp_install${_gemdir}/gems/" \
-    -type f \
-    \( \
-      -iname "*.o" -o \
-      -iname "*.c" -o \
-      -iname "*.so" -o \
-      -iname "*.time" -o \
-      -iname "gem.build_complete" -o \
-      -iname "Makefile" \
-    \) \
-    -delete
-
-  find "tmp_install${_gemdir}/extensions/" \
-    -type f \
-    \( \
-      -iname "mkmf.log" -o \
-      -iname "gem_make.out" \
-    \) \
-    -delete
 }
 
 check() {
@@ -76,7 +72,7 @@
 
   local _gemdir="$(gem env gemdir)"
 
-  GEM_HOME="tmp_install${_gemdir}" rake test
+  GEM_HOME="tmp_install/${_gemdir}" rake test
 }
 
 package() {
@@ -84,7 +80,7 @@
 
   cp --archive --verbose tmp_install/* "${pkgdir}"
 
-  install --verbose -D --mode=0644 LICENSE* --target-directory "${pkgdir}/usr/share/licenses/${pkgname}"
+  install --verbose -D --mode=0644 LICENSE.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
   install --verbose -D --mode=0644 *.md --target-directory "${pkgdir}/usr/share/doc/${pkgname}"
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,2 +1 @@
 ruby
-ruby-rdoc

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -5,35 +5,39 @@
 build() {
 cd "${_gemname}-${pkgver}"
 local _gemdir="$(gem env gemdir)"
-gem build --verbose "${_gemname}.gemspec"
+local _platform="$(gem env platform | cut -d':' -f2)"
+local _extension_api_version="$(ruby -e 'puts Gem.extension_api_version')"
+install --verbose --directory --mode=0755 \
+"tmp_install_default/gemspec/specifications/gems/${_gemname}-${pkgver}" \
+"tmp_install/usr/lib/ruby/${_extension_api_version}/${_platform}" \
+"tmp_install${_gemdir}/specifications/default"
+gem build "${_gemname}.gemspec"
 gem install \
 --local \
 --verbose \
 --ignore-dependencies \
 --no-user-install \
---install-dir "tmp_install${_gemdir}" \
+--install-dir "tmp_install/${_gemdir}" \
 --bindir "tmp_install/usr/bin" \
 "${_gemname}-${pkgver}.gem"
+gem install \
+--default \
+--local \
+--verbose \
+--ignore-dependencies \
+--no-user-install \
+--install-dir "tmp_install_default/gemspec" \
+--bindir "tmp_install_default/usr/bin" \
+"${_gemname}-${pkgver}.gem"
+mv --verbose "tmp_install_default/gemspec/specifications/default/${_gemname}-${pkgver}.gemspec" "tmp_install${_gemdir}/specifications/default/${_gemname}-${pkgver}.gemspec"
+mv --verbose "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}.rb" "tmp_install/usr/lib/ruby/${_extension_api_version}/${_gemname}.rb"
+mv --verbose "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}" "tmp_install/usr/lib/ruby/${_extension_api_version}/${_gemname}"
 rm --force --recursive --verbose \
 "tmp_install${_gemdir}/cache/" \
-"tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
+"tmp_install${_gemdir}/build_info/" \
+"tmp_install${_gemdir}/extensions/" \
+"tmp_install${_gemdir}/gems/" \
+"tmp_install${_gemdir}/plugins/" \
+"tmp_install${_gemdir}/specifications/${_gemname}-${pkgver}.gemspec" \
 "tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
-find "tmp_install${_gemdir}/gems/" \
--type f \
-\( \
--iname "*.o" -o \
--iname "*.c" -o \
--iname "*.so" -o \
--iname "*.time" -o \
--iname "gem.build_complete" -o \
--iname "Makefile" \
-\) \
--delete
-find "tmp_install${_gemdir}/extensions/" \
--type f \
-\( \
--iname "mkmf.log" -o \
--iname "gem_make.out" \
-\) \
--delete
 }
