--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -4,7 +4,7 @@
   mutter
   mutter-docs
 )
-pkgver=46.2
+pkgver=46.1
 pkgrel=1
 pkgdesc="Window manager and compositor for GNOME"
 url="https://gitlab.gnome.org/GNOME/mutter"
@@ -63,7 +63,6 @@
   pixman
   python
   startup-notification
-  systemd-libs
   wayland
   xorg-xwayland
 )
@@ -72,15 +71,23 @@
   gi-docgen
   git
   gobject-introspection
+  gtk3
   meson
-  python-packaging
   sysprof
   wayland-protocols
+  xorg-server
+  xorg-server-xvfb
+)
+checkdepends=(
+  gnome-session
+  python-dbusmock
+  wireplumber
+  zenity
 )
 source=(
   "git+$url.git#tag=${pkgver/[a-z]/.&}"
 )
-b2sums=('4b474f4bbb5ed15db053cba509c3f4b0d112a74359597dc1ab9af118b0e1360a20ccc6af89af3b248895e5dd95193c039cd3396b0fd2c71a0deadc3ff4e15920')
+b2sums=('4acd4a192455890b12b2fc9b6553ed65bd2176307cd6c6683fc2ab476b7fa88f4b5e507a1209b3e900c68d94768f3cf749b4f5d87d25300b33a112182c8a62a7')
 
 prepare() {
   cd mutter
@@ -88,20 +95,34 @@
 
 build() {
   local meson_options=(
+    -D systemd=false
     -D docs=true
     -D egl_device=true
     -D installed_tests=false
     -D libdisplay_info=enabled
-    -D tests=false
     -D wayland_eglstream=true
   )
 
   CFLAGS="${CFLAGS/-O2/-O3} -fno-semantic-interposition"
   LDFLAGS+=" -Wl,-Bsymbolic-functions"
 
-  arch-meson mutter build "${meson_options[@]}"
+  artix-meson mutter build "${meson_options[@]}"
   meson compile -C build
 }
+
+check() (
+  export XDG_RUNTIME_DIR="$PWD/rdir" GSETTINGS_SCHEMA_DIR="$PWD/build/data"
+  mkdir -p -m 700 "$XDG_RUNTIME_DIR"
+  glib-compile-schemas "$GSETTINGS_SCHEMA_DIR"
+
+  export NO_AT_BRIDGE=1 GTK_A11Y=none
+  export MUTTER_DEBUG_DUMMY_MODE_SPECS="800x600@10.0"
+
+  xvfb-run -s '-nolisten local +iglx -noreset' \
+    mutter/src/tests/meta-dbus-runner.py --launch=pipewire --launch=wireplumber \
+    meson test -C build --no-suite 'mutter/kvm' --no-rebuild \
+    --print-errorlogs --timeout-multiplier 10 --setup plain ||:
+)
 
 _pick() {
   local p="$1" f d; shift


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -17,6 +17,7 @@
 gobject-introspection
 graphene
 gsettings-desktop-schemas
+gtk3
 gtk4
 harfbuzz
 iio-sensor-proxy
@@ -55,10 +56,10 @@
 pipewire
 pixman
 python
-python-packaging
 startup-notification
 sysprof
-systemd-libs
 wayland
 wayland-protocols
+xorg-server
+xorg-server-xvfb
 xorg-xwayland