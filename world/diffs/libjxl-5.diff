--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -2,35 +2,32 @@
 pkgbase=libjxl
 pkgname=('libjxl' 'libjxl-doc')
 pkgver=0.11.1
-pkgrel=4
+pkgrel=3
 pkgdesc='JPEG XL image format reference implementation'
 arch=('x86_64')
 url='https://jpeg.org/jpegxl/'
 license=('BSD-3-Clause')
-makedepends=(
-    'asciidoc'
-    'brotli'
-    'cmake'
-    'doxygen'
-    'gdk-pixbuf2'
-    'giflib'
-    'git'
-    'gperftools'
-    'graphviz'
-    'gtest'
-    'highway'
-    'java-environment'
-    'libjpeg-turbo'
-    'libpng'
-    'python'
-    'xdg-utils')
+makedepends=('git' 'cmake' 'brotli' 'gdk-pixbuf2' 'giflib'
+             'gperftools' 'highway' 'libjpeg-turbo' 'libpng'
+             'gtest' 'java-environment' 'python' 'asciidoc' 'doxygen'
+             'graphviz' 'xdg-utils')
 source=("git+https://github.com/libjxl/libjxl.git#tag=v${pkgver}"
+        'git+https://github.com/google/brotli.git'
         'git+https://github.com/mm2/Little-CMS.git'
+        'git+https://github.com/google/googletest.git'
         'git+https://github.com/webmproject/sjpeg.git'
         'git+https://skia.googlesource.com/skcms.git'
+        'git+https://github.com/google/highway.git'
+        'git+https://github.com/glennrp/libpng.git'
+        'git+https://github.com/madler/zlib.git'
         'libjxl-testdata'::'git+https://github.com/libjxl/testdata.git'
         'git+https://github.com/libjpeg-turbo/libjpeg-turbo.git')
 sha256sums=('6420adcb5ccd23547eed91feb38ac9d7bdaac77def7183776e00699880148e3e'
+            'SKIP'
+            'SKIP'
+            'SKIP'
+            'SKIP'
+            'SKIP'
             'SKIP'
             'SKIP'
             'SKIP'
@@ -39,19 +36,11 @@
 
 prepare() {
     git -C libjxl submodule init
-
     local _submodule
-
-    for _submodule in libjpeg-turbo sjpeg skcms
+    for _submodule in brotli googletest sjpeg skcms highway libpng zlib libjpeg-turbo
     do
         git -C libjxl config --local "submodule.third_party/${_submodule}.url" "${srcdir}/${_submodule}"
     done
-
-    for _submodule in brotli googletest highway libpng zlib
-    do
-        git -C libjxl config --local "submodule.third_party/${_submodule}.update" none
-    done
-
     git -C libjxl config --local submodule.third_party/lcms.url "${srcdir}/Little-CMS"
     git -C libjxl config --local submodule.third_party/testdata.url "${srcdir}/libjxl-testdata"
     git -C libjxl -c protocol.file.allow='always' submodule update
@@ -64,9 +53,6 @@
         -G 'Unix Makefiles' \
         -DCMAKE_BUILD_TYPE:STRING='None' \
         -DCMAKE_INSTALL_PREFIX:PATH='/usr' \
-        -DCMAKE_POLICY_VERSION_MINIMUM:STRING='3.5.0' \
-        -DJPEGXL_BUNDLE_LIBPNG:BOOL='NO' \
-        -DJPEGXL_ENABLE_AVX512:BOOL='true' \
         -DJPEGXL_ENABLE_BENCHMARK:BOOL='false' \
         -DJPEGXL_ENABLE_EXAMPLES:BOOL='false' \
         -DJPEGXL_ENABLE_FUZZERS:BOOL='false' \
@@ -77,6 +63,7 @@
         -DJPEGXL_FORCE_SYSTEM_BROTLI:BOOL='true' \
         -DJPEGXL_FORCE_SYSTEM_GTEST:BOOL='true' \
         -DJPEGXL_FORCE_SYSTEM_HWY:BOOL='true' \
+        -DJPEGXL_BUNDLE_LIBPNG:BOOL='NO' \
         -DJPEGXL_INSTALL_JARDIR='/usr/share/java' \
         -Wno-dev
     cmake --build build
@@ -88,22 +75,10 @@
 }
 
 package_libjxl() {
-    depends=(
-        'brotli'
-        'gcc-libs'
-        'giflib'
-        'glibc'
-        'gperftools'
-        'highway'
-        'libjpeg-turbo'
-        'libpng')
-    optdepends=(
-        'gdk-pixbuf2: for gdk-pixbuf loader'
-        'java-runtime: for JNI bindings')
-    provides=(
-        'libjxl.so'
-        'libjxl_cms.so'
-        'libjxl_threads.so')
+    depends=('brotli' 'giflib' 'gperftools' 'highway' 'libjpeg-turbo' 'libpng')
+    optdepends=('gdk-pixbuf2: for gdk-pixbuf loader'
+                'java-runtime: for JNI bindings')
+    provides=('libjxl.so' 'libjxl_cms.so' 'libjxl_threads.so')
 
     DESTDIR="$pkgdir" cmake --install build
     install -D -m644 libjxl/{LICENSE,PATENTS} -t "${pkgdir}/usr/share/licenses/${pkgname}"


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -2,11 +2,9 @@
 brotli
 cmake
 doxygen
-gcc-libs
 gdk-pixbuf2
 giflib
 git
-glibc
 gperftools
 graphviz
 gtest

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,13 +1,9 @@
 prepare() {
 git -C libjxl submodule init
 local _submodule
-for _submodule in libjpeg-turbo sjpeg skcms
+for _submodule in brotli googletest sjpeg skcms highway libpng zlib libjpeg-turbo
 do
 git -C libjxl config --local "submodule.third_party/${_submodule}.url" "${srcdir}/${_submodule}"
-done
-for _submodule in brotli googletest highway libpng zlib
-do
-git -C libjxl config --local "submodule.third_party/${_submodule}.update" none
 done
 git -C libjxl config --local submodule.third_party/lcms.url "${srcdir}/Little-CMS"
 git -C libjxl config --local submodule.third_party/testdata.url "${srcdir}/libjxl-testdata"
@@ -20,9 +16,6 @@
 -G 'Unix Makefiles' \
 -DCMAKE_BUILD_TYPE:STRING='None' \
 -DCMAKE_INSTALL_PREFIX:PATH='/usr' \
--DCMAKE_POLICY_VERSION_MINIMUM:STRING='3.5.0' \
--DJPEGXL_BUNDLE_LIBPNG:BOOL='NO' \
--DJPEGXL_ENABLE_AVX512:BOOL='true' \
 -DJPEGXL_ENABLE_BENCHMARK:BOOL='false' \
 -DJPEGXL_ENABLE_EXAMPLES:BOOL='false' \
 -DJPEGXL_ENABLE_FUZZERS:BOOL='false' \
@@ -33,6 +26,7 @@
 -DJPEGXL_FORCE_SYSTEM_BROTLI:BOOL='true' \
 -DJPEGXL_FORCE_SYSTEM_GTEST:BOOL='true' \
 -DJPEGXL_FORCE_SYSTEM_HWY:BOOL='true' \
+-DJPEGXL_BUNDLE_LIBPNG:BOOL='NO' \
 -DJPEGXL_INSTALL_JARDIR='/usr/share/java' \
 -Wno-dev
 cmake --build build
