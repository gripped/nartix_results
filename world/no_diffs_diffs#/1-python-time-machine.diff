--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,7 @@
 
 pkgname=python-time-machine
-pkgver=2.17.0
-pkgrel=1
+pkgver=2.16.0
+pkgrel=2
 pkgdesc='Travel through time in your tests'
 arch=('x86_64')
 url='https://github.com/adamchainz/time-machine'
@@ -20,14 +20,10 @@
 checkdepends=(
   'python-pytest'
   'python-pytest-randomly'
-  'python-tokenize-rt'
 )
-optdepends=(
-  'python-pytest: for pytest plugin'
-  'python-tokenize-rt: for the migration tool'
-)
+optdepends=('python-pytest: for pytest plugin')
 source=("$pkgname::git+$url#tag=$pkgver")
-b2sums=('1b8b9810558e5cc310134ba05fece8d1ae51aa16aef0e4901b8d4ddf8b5f261a990d23a414f0b56b743f8f91fe2ec91c14f84e4d10ac8497956a6f352ea70cd7')
+b2sums=('800fd97077b62497eac4378d732ff32dfde9b16261237ded7cb55452b4d11acd44ade247a56749e8cd05165ada0c464130f14a18319172d5b8d33d5c52c8cad5')
 
 build() {
   cd "$pkgname"
@@ -38,18 +34,21 @@
 check() {
   cd "$pkgname"
 
-  python -m venv --system-site-packages test-env
-  test-env/bin/python -m installer dist/*.whl
-  test-env/bin/python -m pytest -v
+  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
+
+  python -m installer --destdir="$(pwd)/tmp_install" dist/*.whl
+
+  PYTHONPATH="$(pwd)/tmp_install$site_packages" \
+    pytest -v
 }
 
 package() {
-  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
-  install -d "$pkgdir/usr/share/licenses/$pkgname"
-  ln -s "$site_packages/time_machine-$pkgver.dist-info/licenses/LICENSE" \
-    "$pkgdir/usr/share/licenses/$pkgname"
-
   cd "$pkgname"
 
   python -m installer --destdir="$pkgdir" dist/*.whl
+
+  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
+  install -d "$pkgdir/usr/share/licenses/$pkgname"
+  ln -s "$site_packages/time_machine-$pkgver.dist-info/LICENSE" \
+    "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
 }
