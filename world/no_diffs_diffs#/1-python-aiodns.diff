--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,23 +1,27 @@
 
 pkgname=python-aiodns
 _name=${pkgname#python-}
-pkgver=3.2.0
-pkgrel=3
+pkgver=3.4.0
+pkgrel=1
 pkgdesc='Simple DNS resolver for asyncio'
-arch=('any')
+arch=(any)
 url=https://github.com/saghul/aiodns
-license=('MIT')
-depends=('python-pycares')
+license=(MIT)
+depends=(python-pycares)
 makedepends=(
-  'git'
-  'python-build'
-  'python-installer'
-  'python-setuptools'
-  'python-wheel'
+  git
+  python-build
+  python-installer
+  python-setuptools
+  python-wheel
 )
-checkdepends=('python-pytest' 'python-uvloop')
+checkdepends=(
+  python-pytest
+  python-pytest-asyncio
+  python-uvloop
+)
 source=("git+$url.git#tag=v$pkgver")
-b2sums=('12331eaf680527878fdf143bb57099affb3bb70e64c264f3214ef9f4a2156f7a51eb60f898e42c3bcd753f9d2fe8e95165299dbc31ad3b745e33a11742a1fe40')
+b2sums=('1afbaf4405f2548977d6f4e430e2c97694e0590420e06316b07d1e6c4604d0608fbb78e45167196f5ae94c0afac619bb0a3e92b23d23ea581175f5eb59f38608')
 
 build() {
   cd "$_name"
@@ -26,15 +30,15 @@
 
 check() {
   cd "$_name"
-  pytest -k 'not test_gethostbyaddr' tests.py
+  PYTHONPATH=aiodns:$PYTHONPATH pytest --override-ini="addopts=" -v -k 'not test_gethostbyaddr'
 }
 
 package() {
+  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
+  install -d "$pkgdir"/usr/share/licenses/$pkgname
+  ln -s "$site_packages"/"$_name"-$pkgver.dist-info/licenses/LICENSE \
+    "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
+
   cd "$_name"
   python -m installer --destdir="$pkgdir" dist/*.whl
-
-  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
-  install -d "$pkgdir"/usr/share/licenses/$pkgname
-  ln -s "$site_packages"/"$_name"-$pkgver.dist-info/LICENSE \
-    "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
 }
