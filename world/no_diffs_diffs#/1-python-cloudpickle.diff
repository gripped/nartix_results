--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,8 +1,8 @@
 
 _pkg=cloudpickle
 pkgname=python-${_pkg}
-pkgver=3.1.0
-pkgrel=1
+pkgver=2.2.1
+pkgrel=3
 pkgdesc="Extended pickling support for Python objects"
 arch=(any)
 url="https://github.com/cloudpipe/cloudpickle"
@@ -11,7 +11,7 @@
 makedepends=(
     python-build
     python-installer
-    python-flit
+    python-setuptools
     python-wheel
 )
 checkdepends=(
@@ -22,7 +22,7 @@
 )
 options=(!emptydirs)
 source=(https://files.pythonhosted.org/packages/source/${_pkg::1}/${_pkg}/${_pkg}-${pkgver}.tar.gz)
-sha256sums=('81a929b6e3c7335c863c771d673d105f02efdb89dfaba0c90495d1c64796601b')
+sha256sums=('d89684b8de9e34a2a43b3460fbca07d09d6e25ce858df4d5a44240403b6178f5')
 
 build() {
   cd ${_pkg}-${pkgver}
@@ -31,7 +31,19 @@
 
 check() {
   cd ${_pkg}-${pkgver}
-  PYTHONPATH=. pytest .
+  cd tests/cloudpickle_testpkg
+  python setup.py build
+  cd ../../
+  PYTHONPATH="${PWD}"/tests/cloudpickle_testpkg/build/lib/ \
+  pytest -vl --color=yes -m 'not avoid_ci' \
+    --deselect tests/cloudpickle_test.py::CloudPickleTest::test_builtin_classmethod \
+    --deselect tests/cloudpickle_test.py::CloudPickleTest::test_dynamic_pytest_module \
+    --deselect tests/cloudpickle_test.py::Protocol2CloudPickleTest::test_builtin_classmethod \
+    --deselect tests/cloudpickle_test.py::Protocol2CloudPickleTest::test_dynamic_pytest_module \
+    --deselect tests/cloudpickle_file_test.py::CloudPickleFileTests::test_pickling_special_file_handles \
+    --deselect tests/cloudpickle_test.py::CloudPickleTest::test_pickling_file_handles \
+    --deselect tests/cloudpickle_test.py::Protocol2CloudPickleTest::test_pickling_file_handles
+
 }
 
 package() {


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,5 +1,5 @@
 python
 python-build
-python-flit
 python-installer
+python-setuptools
 python-wheel