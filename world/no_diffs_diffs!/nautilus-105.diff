--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -5,7 +5,7 @@
   libnautilus-extension
   libnautilus-extension-docs
 )
-pkgver=48.4.1
+pkgver=49.0
 pkgrel=1
 pkgdesc="Default file manager for GNOME"
 url="https://apps.gnome.org/Nautilus/"
@@ -26,6 +26,7 @@
   gtk4
   gvfs
   hicolor-icon-theme
+  icu
   libadwaita
   libcloudproviders
   libgexiv2
@@ -46,11 +47,14 @@
   gobject-introspection
   meson
 )
-checkdepends=(python-gobject)
+checkdepends=(
+  python-gobject
+  weston
+)
 source=(
   "git+https://gitlab.gnome.org/GNOME/nautilus.git#tag=${pkgver/[a-z]/.&}"
 )
-b2sums=('8422f2b5858cc4a62ef4a32302bf79e86fe97f938029557e6262c4c6fd804f814fc2d651a3a773715e740c2b3c8e101f9c7bd5b1500056c08fa8304cb4133f10')
+b2sums=('5deb16a0d803794717630f22ccb31154577894710ef8c5153b3bbafe0c903be1a9f763b733f150acab5166ce269b7db7ee2acdfb4fb94f16efa2de6f783718c2')
 validpgpkeys=(
   6B211753AC950672287226800538577822AE4B17 # Ant√≥nio Fernandes <antoniof@gnome.org>
   550660707A6F40376B9B9F8D504A78811E6160CC # Corey Berla <corey@berla.me>
@@ -66,13 +70,28 @@
     -D packagekit=false
   )
 
-  arch-meson nautilus build "${meson_options[@]}"
+  artix-meson nautilus build "${meson_options[@]}"
   meson compile -C build
 }
 
-check() {
+check() (
+  export XDG_RUNTIME_DIR="$PWD/runtime-dir"
+  mkdir -p -m 700 "$XDG_RUNTIME_DIR"
+
+  export WAYLAND_DISPLAY=wl-$pkgname-$RANDOM
+  weston --backend=headless --socket=$WAYLAND_DISPLAY --idle-time=0 &
+  _w=$!
+
+  trap "kill $_w; wait" EXIT
+
+  install -D /dev/stdin path/bwrap <<END
+exit 1
+END
+  export PATH="$PWD/path:$PATH"
+
+  export NO_AT_BRIDGE=1 GTK_A11Y=none
   meson test -C build --print-errorlogs
-}
+)
 
 _pick() {
   local p="$1" f d; shift


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -18,6 +18,7 @@
 gtk4
 gvfs
 hicolor-icon-theme
+icu
 libadwaita
 libcloudproviders
 libgexiv2

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -6,6 +6,6 @@
 -D docs=true
 -D packagekit=false
 )
-arch-meson nautilus build "${meson_options[@]}"
+artix-meson nautilus build "${meson_options[@]}"
 meson compile -C build
 }
