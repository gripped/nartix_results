--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -3,7 +3,7 @@
 pkgname=(avogadrolibs
          avogadrolibs-qt5)
 pkgver=1.99.0
-pkgrel=3
+pkgrel=4
 pkgdesc='Libraries that provide 3D rendering, visualization, analysis and data processing useful in computational chemistry, molecular modeling, bioinformatics, materials science, and related areas'
 arch=(x86_64)
 url='https://www.openchemistry.org/'
@@ -13,6 +13,7 @@
              eigen
              fast_float
              fmt
+             git
              hdf5
              genxrdpattern
              glew
@@ -29,18 +30,17 @@
              utf8cpp
              verdict
              vtk)
-source=(https://github.com/OpenChemistry/avogadrolibs/archive/$pkgver/$pkgname-$pkgver.tar.gz
-        https://github.com/antonio-rojas/avogadrolibs/commit/6e2e84db.patch)
-sha256sums=('34808e3c602b0f60f3c160ff0220832aee777db86e962e3f958c6327fb434063'
-            '285d7b8aef7cd489a2829840519051dbdbe232c06a540268860a3a6dbc8d5ca9')
+source=(git+https://github.com/OpenChemistry/avogadrolibs#tag=$pkgver)
+sha256sums=('ad26ef7d887924a867c5aba68ecc3803b2684652d65a442516903c9343a332ff')
 
 prepare() {
   mkdir crystals fragments molecules # Dummy dirs to trick cmake, actually provided by avogadro-{crystals,fragments,molecules}
-  patch -d $pkgname-$pkgver -p1 < 6e2e84db.patch # Fix wrong cmake variable name
+  cd $pkgname
+  git cherry-pick -n 6e2e84dbb088a40d69117c1836f4306792f57acd # Fix wrong cmake variable name
 }
 
 build() {
-  cmake -B build -S $pkgname-$pkgver \
+  cmake -B build -S $pkgname \
     -DCMAKE_INSTALL_PREFIX=/usr \
     -DCMAKE_C_FLAGS="$CFLAGS -ffat-lto-objects" \
     -DCMAKE_CXX_FLAGS="$CXXFLAGS -ffat-lto-objects" \
@@ -76,7 +76,7 @@
         "$pkgdir"/usr/include/avogadro/{molequeue,qt*,vtk} \
         "$pkgdir"/usr/lib/avogadro2/{scripts,staticplugins}
 
-  install -Dm644 $pkgname-$pkgver/LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname
+  install -Dm644 $pkgname/LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname
 }
 
 package_avogadrolibs-qt5() {
@@ -101,5 +101,5 @@
   DESTDIR="$pkgdir" cmake --install build/avogadro/qtplugins
   DESTDIR="$pkgdir" cmake --install build/avogadro/vtk
 
-  install -Dm644 $pkgbase-$pkgver/LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname
+  install -Dm644 $pkgbase/LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -9,6 +9,7 @@
 fmt
 gcc-libs
 genxrdpattern
+git
 glew
 glibc
 hdf5

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,9 +1,10 @@
 prepare() {
 mkdir crystals fragments molecules # Dummy dirs to trick cmake, actually provided by avogadro-{crystals,fragments,molecules}
-patch -d $pkgname-$pkgver -p1 < 6e2e84db.patch # Fix wrong cmake variable name
+cd $pkgname
+git cherry-pick -n 6e2e84dbb088a40d69117c1836f4306792f57acd # Fix wrong cmake variable name
 }
 build() {
-cmake -B build -S $pkgname-$pkgver \
+cmake -B build -S $pkgname \
 -DCMAKE_INSTALL_PREFIX=/usr \
 -DCMAKE_C_FLAGS="$CFLAGS -ffat-lto-objects" \
 -DCMAKE_CXX_FLAGS="$CXXFLAGS -ffat-lto-objects" \
