--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,120 +1,74 @@
 
 pkgname=gimp
-_pkgver=3.0.0
-pkgver=3.0.0
-pkgrel=1
+pkgver=2.10.38
+pkgrel=5
 pkgdesc='GNU Image Manipulation Program'
 url='https://www.gimp.org/'
 arch=('x86_64')
 license=('GPL-3.0-or-later')
 depends=(
-  'appstream-glib'
-  'babl'
-  'cairo'
-  'fontconfig'
-  'freetype2'
-  'gcc-libs'
-  'gdk-pixbuf2'
-  'gegl'
-  'glib2'
-  'glibc'
-  'gtk3'
-  'harfbuzz'
-  'hicolor-icon-theme'
-  'iso-codes'
-  'json-glib'
-  'lcms2'
-  'libgexiv2'
-  'libmypaint'
-  'libunwind'
-  'mypaint-brushes1'
-  'pango'
-  'python-gobject'
-  'zlib'
+  'babl' 'cairo' 'fontconfig' 'freetype2' 'gcc-libs' 'gdk-pixbuf2' 'gegl' 'glib2' 'glibc' 'gtk2'
+  'harfbuzz' 'hicolor-icon-theme' 'iso-codes' 'json-glib' 'lcms2' 'libgexiv2' 'libmypaint'
+  'libunwind' 'mypaint-brushes1' 'pango' 'zlib'
 
-  'aalib'
-  'bzip2'
-  'libgudev'
-  'libheif'
-  'libjpeg-turbo'
-  'libjxl'
-  'libmng'
-  'libpng'
-  'librsvg'
-  'libtiff'
-  'libwebp'
-  'libwmf'
-  'libx11'
-  'libxcursor'
-  'libxext'
-  'libxfixes'
-  'libxmu'
-  'libxpm'
-  'openexr'
-  'openjpeg2'
-  'poppler-data'
-  'poppler-glib'
-  'xz'
+  'bzip2' 'libgudev' 'libheif' 'libjpeg-turbo' 'libjxl' 'libmng' 'libpng' 'librsvg' 'libtiff'
+  'libwebp' 'libwmf' 'libx11' 'libxcursor' 'libxext' 'libxfixes' 'libxmu' 'libxpm' 'openexr'
+  'openjpeg2' 'poppler-data' 'poppler-glib' 'xz' 'aalib'
 )
-makedepends=(
-  'alsa-lib'
-  'appstream'
-  'cfitsio'
-  'ghostscript'
-  'gi-docgen'
-  'gjs'
-  'glib2-devel'
-  'gobject-introspection'
-  'gtk-doc'
-  'gvfs'
-  'intltool'
-  'meson'
-  'vala'
-)
-optdepends=(
-  'alsa-lib: for MIDI event controller module'
-  'cfitsio: for FITS support'
-  'ghostscript: for PostScript support'
-  'gjs: for JavaScript scripting support'
-  'gutenprint: for sophisticated printing only as gimp has built-in cups print support'
-  'gvfs: for HTTP/S support (and many other schemes)'
-)
+makedepends=('alsa-lib' 'ghostscript' 'gtk-doc' 'gvfs' 'intltool' 'glib2-devel')
+optdepends=('alsa-lib: for MIDI event controller module'
+            'ghostscript: for PostScript support'
+            'gutenprint: for sophisticated printing only as gimp has built-in cups print support'
+            'gvfs: for HTTP/S support (and many other schemes)')
 install=gimp.install
-source=(
-  https://download.gimp.org/gimp/v${pkgver%.*}/${pkgname}-${_pkgver}.tar.xz
-  0001-no-check-update.patch
-  0002-fix-detection-of-libheif-1.15.0.patch
-  linux.gpl
-)
-sha256sums=('93f1ca3d9d1bd8cac0e52c49fb886cbbe4b28222ee835bf1319e3287901d2d20'
+source=(https://download.gimp.org/pub/gimp/v${pkgver%.*}/${pkgname}-${pkgver}.tar.bz2
+        0001-no-check-update.patch
+        0002-fix-detection-of-libheif-1.15.0.patch
+        linux.gpl)
+sha256sums=('50a845eec11c8831fe8661707950f5b8446e35f30edfb9acf98f85c1133f856e'
             'ac3e8b44cf391f4ab3050652f2cc1f146f451fb25178d5a596d905f5bad13fcf'
             '24814e981121830242f0a9b7d1da99e7282b247b87b482e2b394cff75b4675ef'
             '1003bbf5fc292d0d63be44562f46506f7b2ca5729770da9d38d3bb2e8a2f36b3')
 
 prepare() {
-  cd ${pkgname}-${_pkgver}
+  cd ${pkgname}-${pkgver}
 
+  patch -Np1 < ../0001-no-check-update.patch
+  patch -Np1 < ../0002-fix-detection-of-libheif-1.15.0.patch
+
+  autoreconf -vi
 }
 
 build() {
-  local meson_options=(
-    --buildtype=plain
-    --prefix=/usr
-    --sysconfdir=/etc
+  cd ${pkgname}-${pkgver}
+
+  export CFLAGS+=" -Wno-incompatible-pointer-types"
+
+  ./configure \
+    --prefix=/usr \
+    --sysconfdir=/etc \
     --libexecdir=/usr/bin \
-    -Dopenmp=enabled
-    -Dcheck-update=no
-    -Dbug-report-url='https://gitlab.archlinux.org/archlinux/packaging/packages/gimp/-/issues'
-    -Dopenexr=enabled
-    -Dilbm=disabled
-    -Dheadless-tests=disabled # enabled by default, depends on xorg-server-xvfb
-  )
+    --enable-mp \
+    --enable-gimp-console \
+    --enable-gtk-doc \
+    --disable-check-update \
+    --disable-python \
+    --with-bug-report-url='https://gitlab.archlinux.org/archlinux/packaging/packages/gimp/-/issues' \
+    --with-openexr
 
-  arch-meson ${pkgname}-${_pkgver} build "${meson_options[@]}"
-  meson compile -C build
+  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
+  make
 }
 
 package() {
-  meson install -C build --destdir "${pkgdir}"
+  cd ${pkgname}-${pkgver}
+
+  make DESTDIR="${pkgdir}" install
+  install -D -m644 "${srcdir}/linux.gpl" "${pkgdir}/usr/share/gimp/2.0/palettes/Linux.gpl"
+
+  rm "${pkgdir}/usr/share/man/man1/gimp-console.1"
+  ln -s gimp-console-${pkgver%.*}.1.gz "${pkgdir}/usr/share/man/man1/gimp-console.1.gz"
+  ln -s gimptool-2.0 "${pkgdir}/usr/bin/gimptool"
+  ln -sf gimptool-2.0.1.gz "${pkgdir}/usr/share/man/man1/gimptool.1.gz"
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,25 +1,19 @@
 aalib
 alsa-lib
-appstream
-appstream-glib
 babl
 bzip2
 cairo
-cfitsio
 fontconfig
 freetype2
 gcc-libs
 gdk-pixbuf2
 gegl
 ghostscript
-gi-docgen
-gjs
 glib2
 glib2-devel
 glibc
-gobject-introspection
 gtk-doc
-gtk3
+gtk2
 gvfs
 harfbuzz
 hicolor-icon-theme
@@ -46,14 +40,11 @@
 libxfixes
 libxmu
 libxpm
-meson
 mypaint-brushes1
 openexr
 openjpeg2
 pango
 poppler-data
 poppler-glib
-python-gobject
-vala
 xz
 zlib

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,19 +1,23 @@
 prepare() {
-cd ${pkgname}-${_pkgver}
+cd ${pkgname}-${pkgver}
+patch -Np1 < ../0001-no-check-update.patch
+patch -Np1 < ../0002-fix-detection-of-libheif-1.15.0.patch
+autoreconf -vi
 }
 build() {
-local meson_options=(
---buildtype=plain
---prefix=/usr
---sysconfdir=/etc
+cd ${pkgname}-${pkgver}
+export CFLAGS+=" -Wno-incompatible-pointer-types"
+./configure \
+--prefix=/usr \
+--sysconfdir=/etc \
 --libexecdir=/usr/bin \
--Dopenmp=enabled
--Dcheck-update=no
--Dbug-report-url='https://gitlab.archlinux.org/archlinux/packaging/packages/gimp/-/issues'
--Dopenexr=enabled
--Dilbm=disabled
--Dheadless-tests=disabled # enabled by default, depends on xorg-server-xvfb
-)
-arch-meson ${pkgname}-${_pkgver} build "${meson_options[@]}"
-meson compile -C build
+--enable-mp \
+--enable-gimp-console \
+--enable-gtk-doc \
+--disable-check-update \
+--disable-python \
+--with-bug-report-url='https://gitlab.archlinux.org/archlinux/packaging/packages/gimp/-/issues' \
+--with-openexr
+sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
+make
 }
