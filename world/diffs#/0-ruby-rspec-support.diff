--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,63 +1,57 @@
 
 _gemname=rspec-support
 pkgname=ruby-${_gemname}
-pkgver=3.13.2
-pkgrel=2
+pkgver=3.13.1
+pkgrel=4
 pkgdesc='Common code needed by the other RSpec gems. Not intended for direct use'
-url='https://github.com/rspec/rspec'
+url='https://github.com/rspec/rspec-support'
 arch=('any')
 license=('MIT')
 depends=(
+  git
   ruby
 )
 makedepends=(
-  git
   ruby-rdoc
 )
 checkdepends=(
-  ruby-bigdecimal
   ruby-bundler
   ruby-childprocess
-  ruby-diff-lcs
-  ruby-drb
   ruby-ffi
-  ruby-minitest
   ruby-rake
   ruby-rspec
   ruby-rspec-core
   ruby-rspec-expectations
   ruby-rspec-mocks
-  ruby-test-unit
   ruby-thread_order
 )
 options=('!emptydirs')
 source=(
-  "${pkgname}::git+${url}#tag=${_gemname}-v${pkgver}"
+  "git+${url}#tag=v${pkgver}"
+  "git+https://github.com/rspec/rspec-core#tag=v3.13.1"
+  "git+https://github.com/rspec/rspec-expectations#tag=v3.13.3"
+  "git+https://github.com/rspec/rspec-mocks#tag=v3.13.1"
   "${pkgname}_no_version_constraints.patch"
-  "${pkgname}_fix-diff-lcs-errors.patch"
 )
-sha512sums=('06c89f2be3d61be71059476cb15af3a80774cc50e52ce8a0708171a480f80f3eba7c82836b9555cfb643f95c4ba052ca7155bf0400292abfea03b773e0213b4b'
-            '39ada3f754b90a4895d87a8005f91fc3e3bcd1d4ed534e0210c97a2fb1173a361f354cb2608f8ebe0130bae0d6bb4c39929c1e20e17aef2ed92cf8613f79ea62'
-            '40b1a23ead8ad59cbfc7914069a46bc14ec6876c445f23f02ec7ed4bdd5fc07053beac93f5dc96e1d32c9f67ebeb3af8846716f8f842cecbadd59cd3717c747f')
-b2sums=('c36d62a8085d1c8af43a245997267133e2a510a857e8abdbe6d5a976066552ec31a40b07eded60da78f3dd851344d1fe4e27d36a0eaaf9d99d8e65218b1a6bea'
-        'ebafb00a756958c2b8664dcdedfc2cd753b9c258c8aa2ae798e88cfeb17b3a6bcac18c26389b89e4e2766dd9d44c3b90cd5811e1f07fe368264ed1640d71143e'
-        '0735ff5b85f17c5eef2a510b852c1003696405a480a09099bfb91ef5f3dbcadc0a7b888e2781b1c1e35e05679b5c340936548a3f6e7b8931c760c16e556bd2e5')
+sha512sums=('ab6889db445a4f9c9e01b285e766fd34c62967accbf769715d36e1eb1861c17264017a3d1bc4a6b176e0a450b6855733427d4806d8c476eb88daafb3ca39ffed'
+            'e4499e73f866839be9555b1c5581c5102c1f04469733db02a5a253f543d3481530332c2fcc0e62645c061efd07033b77827d2ff85a25702d51a24c34c5b6e114'
+            '17048eae589ad64d7365b124358612b7d3eb243eaba4f62d51a2f4f581d68c057755139b00d36372d27104e028fd9ebf3629f7108917f563cf52db50e0b57ec6'
+            '777521810f61cffa7d8085f3cf12f667129f4f743789388c75390a0764b6969c911cf89320568d84eb1964ea35f6be7e4a42c143a1ec4d9139cd5ebcbda052a8'
+            'ad1d4f200533810ed09d30914c539958a2d11c40fb7e120ac9fff3938ad0c594a15802d3afbeafe75be73d98c203f1c96be85b347a4cfe18373996c9aa63f292')
+b2sums=('4489f8af10b565e032f56ff5cc514fa4a52d9e53c4158a6021db73f7d06a571906e85880c308d7b7a9fa35cff55f489a90fd52edb3ce42b1966b1ed4b780870f'
+        '8eda18f4aca196d6ab896a680456efd4b53df0dbd1ff98e95026e95fbba490da00cf7acda0aab54031cca665d37cd8d3cabbab92d3b0b48b6082e9d29dff44b3'
+        'f7763eaa372e6186ee37373fbc72db57b52e242082df6b4290dcdfd13ee927e9e922232ad4349927b4f1439e1f9956556e6e623e3e73eefa8145d6576779971c'
+        '1ef6b73100e810ca88a071a8f7610f4bfcb22c9724aa3c138d1dff1f7f7bd52787bd20ae5023f401869c8b8e1dcf27d1f6efb1eb03c6d5305ce231ced5e8bb7b'
+        '797d0691625857574a01248cfd0abc65e07c9960a56e7b5c4ee1d6c2fdbce6f803ab6d23928c4698af899899ef34e5e2fce0310f4156b3debc4d1e47e84abd66')
 
 prepare() {
-  cd "${pkgname}"
+  cd "${_gemname}"
 
-  git cherry-pick -n 9310b4b72e205c6352c4b30015a3b8f3d2fb02e8 # Format hashes in new {a: :b} format on Ruby 3.4
-
-  patch --verbose --strip=1 --input="../${pkgname}_fix-diff-lcs-errors.patch"
   patch --verbose --strip=1 --input="../${pkgname}_no_version_constraints.patch"
-
-  sed --in-place --regexp-extended \
-    --expression '/%w\[ core mocks expectations support \]/,+6d' \
-    rspec-support/spec/rspec/support/caller_filter_spec.rb
 }
 
 build() {
-  cd "${pkgname}/rspec-support"
+  cd "${_gemname}"
 
   local _gemdir="$(gem env gemdir)"
 
@@ -99,15 +93,24 @@
 }
 
 check() {
-  cd "${pkgname}/rspec-support"
+  for c in core mocks expectations; do
+    if [[ "$(git -C rspec-${c} describe)" != "v$(gem list rspec-${c} | sed 's/.*(\(.*\)).*/\1/')" ]] then
+      echo rspec-${c} "$(git -C rspec-${c} describe)" does not match expected version "v$(gem list rspec-${c} | sed 's/.*(\(.*\)).*/\1/')"
+      false
+    fi
+
+    ln -s "../rspec-${c}" "${_gemname}/rspec-${c}"
+  done
+
+  cd "${_gemname}"
 
   local _gemdir="$(gem env gemdir)"
 
-  GEM_HOME="tmp_install${_gemdir}" rake spec
+  GEM_HOME="tmp_install${_gemdir}" NO_COVERAGE=true rake spec
 }
 
 package() {
-  cd "${pkgname}/rspec-support"
+  cd "${_gemname}"
 
   cp --archive --verbose tmp_install/* "${pkgdir}"
 


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,14 +1,9 @@
 prepare() {
-cd "${pkgname}"
-git cherry-pick -n 9310b4b72e205c6352c4b30015a3b8f3d2fb02e8 # Format hashes in new {a: :b} format on Ruby 3.4
-patch --verbose --strip=1 --input="../${pkgname}_fix-diff-lcs-errors.patch"
+cd "${_gemname}"
 patch --verbose --strip=1 --input="../${pkgname}_no_version_constraints.patch"
-sed --in-place --regexp-extended \
---expression '/%w\[ core mocks expectations support \]/,+6d' \
-rspec-support/spec/rspec/support/caller_filter_spec.rb
 }
 build() {
-cd "${pkgname}/rspec-support"
+cd "${_gemname}"
 local _gemdir="$(gem env gemdir)"
 gem build --verbose "${_gemname}.gemspec"
 gem install \
