--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,6 +1,6 @@
 
 pkgname=nodejs
-pkgver=23.7.0
+pkgver=23.4.0
 pkgrel=1
 pkgdesc='Evented I/O for V8 javascript'
 arch=('x86_64')
@@ -23,9 +23,15 @@
   'python'
 )
 optdepends=('npm: nodejs package manager')
-options=('!lto')
-source=("git+https://github.com/nodejs/node.git#tag=v$pkgver?signed")
-sha512sums=('46d65469982187520051b0b81ac37fbab49682a807144e0b3f58e808b2c8b948645cdb8a75f6fc10bc85601099179e51fba0428c6b31e00c8f78d2f6c5b70b07')
+options=(!lto)
+source=("git+https://github.com/nodejs/node.git#tag=v$pkgver?signed"
+        "0001-test-make-test-crypto-hash-compatible-with-OpenSSL-3.patch"
+        "0002-test-adjust-OpenSSL-error-code-for-3.4.0.patch"
+        "0001-test-disable-openssl-3.4.0-incompatible-tests.patch")
+sha512sums=('1db1536af0c8ae154272aea1dba1c625c54790301a80ca0c363d4202a4f445f0637d40773c80b4ad5accdb53548c9f90e78b484604b5bd785d1b6798012d4d63'
+            'dd3d2328c4b24228f0109aa3159989527bfa622497f685ce493fed8334ce5c367d07ebc442bb77b050559a4ec5eb0956661c658f6c9957bc40f1927d384cf728'
+            '296a9117bee86ba141e0748e4857a5f2fb6e630f931f724ce1f3c0acfe166dfe1eb9d6bceaeb2ba06d23e8a937d02bb529aaf3ed458cd18b72fc745237e69b60'
+            'a4f1218b6970b9beb4a0e3da5fb732e74722f014084423293be402b5876da7bba29c9aef770a1e34db7c8876b5dc7b150b44c32c5fd3ca4b741978342fcc636a')
 validpgpkeys=(
   '8FCCA13FEF1D0C2E91008E09770F7A9A5AE15600' # MichaÃ«l Zasso (Targos) <targos@protonmail.com>
   '890C08DB8579162FEE0DF9DB8BEAB4DFCF555EF4' # RafaelGSS <rafael.nunu@hotmail.com>
@@ -33,8 +39,16 @@
   'C0D6248439F1D5604AAFFB4021D900FFDB233756' # Antoine du Hamel <duhamelantoine1995@gmail.com>
 )
 
+prepare() {
+  cd node
+  patch -Np1 -i ../0001-test-make-test-crypto-hash-compatible-with-OpenSSL-3.patch
+  patch -Np1 -i ../0002-test-adjust-OpenSSL-error-code-for-3.4.0.patch
+  patch -Np1 -i ../0001-test-disable-openssl-3.4.0-incompatible-tests.patch
+}
+
 build() {
   cd node
+
   export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
   export CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
 
@@ -56,7 +70,7 @@
 
 check() {
   cd node
-  make test-only
+  make test
 }
 
 package() {


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,3 +1,9 @@
+prepare() {
+cd node
+patch -Np1 -i ../0001-test-make-test-crypto-hash-compatible-with-OpenSSL-3.patch
+patch -Np1 -i ../0002-test-adjust-OpenSSL-error-code-for-3.4.0.patch
+patch -Np1 -i ../0001-test-disable-openssl-3.4.0-incompatible-tests.patch
+}
 build() {
 cd node
 export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
