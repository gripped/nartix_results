--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,50 +1,46 @@
 
-pkgbase=postgresql-old-upgrade
-pkgname=(
-  postgresql-old-upgrade
-)
-pkgver=17.6
-pkgrel=1
-pkgdesc="Older PostgreSQL for migrating major versions with pg_upgrade"
-url="https://www.postgresql.org/"
-arch=(x86_64)
-license=(PostgreSQL)
+pkgname=postgresql-old-upgrade
+pkgver=16.10
+_majorver=${pkgver%.*}
+pkgrel=2
+pkgdesc='PostgreSQL build for migrating between major versions with pg_upgrade'
+url='https://www.postgresql.org/'
+arch=('x86_64')
+license=('PostgreSQL')
 depends=(
-  gcc-libs
-  glibc
-  icu
-  krb5
-  libldap
-  libxml2
-  llvm-libs
-  lz4
-  openssl
-  pam
-  systemd-libs
-  util-linux-libs
-  zlib
-  zstd
+  "postgresql-libs>=${_majorver}"
+  'bash'
+  'gcc-libs'
+  'glibc'
+  'icu'
+  'krb5'
+  'libldap'
+  'libxml2'
+  'llvm-libs'
+  'lz4'
+  'openssl'
+  'pam'
+  'zlib'
+  'zstd'
 )
 makedepends=(
-  clang
-  llvm
-  perl
-  python
-  systemd
-  tcl
-  util-linux
+  'clang'
+  'llvm'
+  'perl'
+  'python'
+  'tcl'
 )
 source=(
   https://ftp.postgresql.org/pub/source/v${pkgver}/postgresql-${pkgver}.tar.bz2
   0001-jit-fix-build-with-LLVM-21.patch
 )
-b2sums=('9287eab85e17a65333d970bf7d4d254e25295615b4787072ff2a6c705cb66b7775dbe3a0c6b6fa3e2ab37c3278d204ccfdd3e587226d4c1d6363868569149216'
-        '392403ece1c5886d6e0d7062091dc71ec1cb085d1da2e0d4b91638c875c5d84ce2b2e4faca05ee336f57a9482e81aeccf882c9ced8dd56091095f5f612d86e03')
+md5sums=('96faafa6f2504827038f13c18781dc10'
+         'e3ef345d74705a1a5e40d82187758ff3')
+sha256sums=('de8485f4ce9c32e3ddfeef0b7c261eed1cecb54c9bcd170e437ff454cb292b42'
+            'fd8512247dbf629a7bf9f1d3c8c45afdddc36bef68e7bf3623ce8d542b0ef43d')
+b2sums=('0b07df6cdd92159ca464dec9fc3f86a806a0a5d9829937f1084e914cac55deff4c3f63b8d9ff1dcac01086b1c1d83ed726c00b007ccd57490bef15194181ddd7'
+        '43bbbc51fe386f28ef587c4f0f59eb46fcc181e61ba9cb2e5c67903ffe97e568e8b14acfc163a144565bd594f96687b2842aef4b520eae1fe12a43fc168f5279')
 
-md5sums=('e72b7e5dc22d44d56b113ed1f74e4084'
-         '0d34dd948e5b031d9ae4312a1eb10bd6')
-sha256sums=('e0630a3600aea27511715563259ec2111cd5f4353a4b040e0be827f94cd7a8b0'
-            'ee6a8220d846c3064ca93dbdc656a0ffbcfad8736333fae17b40e5e65d4ed558')
 
 prepare() {
   cd postgresql-${pkgver}
@@ -52,11 +48,13 @@
 }
 
 build() {
+  cd postgresql-${pkgver}
   local configure_options=(
-    --prefix=/opt/pgsql-${pkgver%%.*}
+    --prefix=/opt/pgsql-${_majorver}
     --disable-rpath
     --disable-nls
     --disable-tap-tests
+    --enable-thread-safety
     --with-gssapi
     --with-icu
     --with-ldap
@@ -70,31 +68,31 @@
     --with-python
     --without-readline
     --with-system-tzdata=/usr/share/zoneinfo
-    --with-systemd
+    --without-systemd
     --with-tcl
     --with-uuid=e2fs
     --with-zstd
   )
 
   CFLAGS+=" -ffat-lto-objects"
-  CXXFLAGS+=" -ffat-lto-objects"
 
-  mkdir -p build; cd build
-  ../postgresql-${pkgver}/configure "${configure_options[@]}"
-  make world-bin
+  ./configure "${configure_options[@]}"
+  make -C src all
+  make -C contrib all
 }
 
-package_postgresql-old-upgrade() {
-  depends+=("postgresql-libs>=${pkgver}")
+package() {
   optdepends=(
     'perl: for PL/Perl support'
     'python: for PL/Python 3 support'
     'tcl: for PL/Tcl support'
   )
 
-  make -C build DESTDIR="${pkgdir}" install-world-bin
+  cd postgresql-${pkgver}
 
+  make -C src DESTDIR="${pkgdir}" install
+  make -C contrib DESTDIR="${pkgdir}" install
 
-  install -Dm644 postgresql-${pkgver}/COPYRIGHT -t "${pkgdir}/usr/share/licenses/${pkgname}"
+  install -Dm 644 COPYRIGHT -t "${pkgdir}/usr/share/licenses/${pkgname}"
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,3 +1,4 @@
+bash
 clang
 gcc-libs
 glibc
@@ -13,10 +14,6 @@
 perl
 postgresql-libs>
 python
-systemd
-systemd-libs
 tcl
-util-linux
-util-linux-libs
 zlib
 zstd