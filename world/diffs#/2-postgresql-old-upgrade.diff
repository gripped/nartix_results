--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -3,8 +3,8 @@
 pkgname=(
   postgresql-old-upgrade
 )
-pkgver=17.7
-pkgrel=1
+pkgver=17.6
+pkgrel=2
 pkgdesc="Older PostgreSQL for migrating major versions with pg_upgrade"
 url="https://www.postgresql.org/"
 arch=(x86_64)
@@ -20,7 +20,6 @@
   lz4
   openssl
   pam
-  systemd-libs
   util-linux-libs
   zlib
   zstd
@@ -30,24 +29,29 @@
   llvm
   perl
   python
-  systemd
   tcl
   util-linux
 )
 source=(
   https://ftp.postgresql.org/pub/source/v${pkgver}/postgresql-${pkgver}.tar.bz2
+  0001-jit-fix-build-with-LLVM-21.patch
 )
-b2sums=('245f866c7375566ca772171b89eb2277a17175b599973e740ce599605292a5847e68b857f83b208a24d0ab6938740faf00ab26758d72c7e119131745f8ab63cb')
+b2sums=('9287eab85e17a65333d970bf7d4d254e25295615b4787072ff2a6c705cb66b7775dbe3a0c6b6fa3e2ab37c3278d204ccfdd3e587226d4c1d6363868569149216'
+        '392403ece1c5886d6e0d7062091dc71ec1cb085d1da2e0d4b91638c875c5d84ce2b2e4faca05ee336f57a9482e81aeccf882c9ced8dd56091095f5f612d86e03')
 
-md5sums=('a4fa04d16e511e068736d154ca74752d')
-sha256sums=('ef9e343302eccd33112f1b2f0247be493cb5768313adeb558b02de8797a2e9b5')
+md5sums=('e72b7e5dc22d44d56b113ed1f74e4084'
+         '0d34dd948e5b031d9ae4312a1eb10bd6')
+sha256sums=('e0630a3600aea27511715563259ec2111cd5f4353a4b040e0be827f94cd7a8b0'
+            'ee6a8220d846c3064ca93dbdc656a0ffbcfad8736333fae17b40e5e65d4ed558')
 
 prepare() {
   cd postgresql-${pkgver}
+  patch -Np1 < ../0001-jit-fix-build-with-LLVM-21.patch
 }
 
 build() {
   local configure_options=(
+    --without-systemd
     --prefix=/opt/pgsql-${pkgver%%.*}
     --disable-rpath
     --disable-nls
@@ -65,7 +69,6 @@
     --with-python
     --without-readline
     --with-system-tzdata=/usr/share/zoneinfo
-    --with-systemd
     --with-tcl
     --with-uuid=e2fs
     --with-zstd


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -13,8 +13,6 @@
 perl
 postgresql-libs>
 python
-systemd
-systemd-libs
 tcl
 util-linux
 util-linux-libs