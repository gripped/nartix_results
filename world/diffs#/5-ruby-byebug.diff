--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,7 @@
 
 pkgname=ruby-byebug
-pkgver=12.0.0
-pkgrel=2
+pkgver=11.1.3
+pkgrel=6
 pkgdesc='A simple to use and feature rich debugger for Ruby'
 arch=(x86_64)
 url='https://github.com/deivid-rodriguez/byebug'
@@ -10,55 +10,36 @@
   ruby
   ruby-irb
 )
-makedepends=(
-  ruby-rake
-  ruby-rdoc
-)
 checkdepends=(
   markdownlint
   ruby-bundler
-  ruby-faraday-retry
   ruby-minitest
   ruby-pry
+  ruby-rake
   ruby-rake-compiler
   ruby-rexml
   ruby-simplecov
   ruby-yard
 )
 options=(!emptydirs)
-source=(
-  "https://github.com/deivid-rodriguez/byebug/archive/v$pkgver/$pkgname-$pkgver.tar.gz"
-  "${pkgname}_fix_tests.patch"
-)
-sha512sums=('2f54c554c451d9bdaf69de738b555f618b944154a810ccadce017aedb73524e0e98c8a6b62139f1df91bb67cf64653607c504e640a20e27ce2710827c9056c9d'
-            'fc97d570a1e0fd4ab3419a6351495e59dfe1ca5b954be7d9a0234ea69b4a207f6d7fd16add03e4fb76e9da364e8918694f37873c804457b96a8692321281fab9')
-b2sums=('1e15d1f6b72a06da9c40062f0451e46b7e62b9b8337f706fb21a3ca37d0ad70039e1ea87ded77b3228dad93e7b6a78210041b7ed4ccaa63936c36b2a0ecf64ac'
-        '1ecdb6928d68033a45822c959d5d273a426dc117892ff443b46bc7d3e02585c63fd06d7763910a1ca55453070131b5dbbce045fbefe1547fd480249bd07bb91b')
+source=(https://github.com/deivid-rodriguez/byebug/archive/v$pkgver/$pkgname-$pkgver.tar.gz
+        minitest-5.16.patch)
+sha256sums=('1482205e562425e5adf1525b0b72e06e49a6ae7640ff3a742f5b60c485fdc3b7'
+            '5082ae41ad5dd2c096a532b0d64fc8ae7d40050193a0b42528f5a3f3d38b131a')
 
 prepare() {
   cd byebug-$pkgver
+  patch -p1 -i ../minitest-5.16.patch
+  sed -e '/chandler/d;/[rR]ubo[cC]op/d' -e 's|~>|>=|' -e 's/"mdl", "0.9.0"/"mdl", ">= 0.9.0"/' -i Rakefile Gemfile
+  rm Gemfile.lock
+  sed -i '/bundler/d' bin/minitest
+  sed -i '/test_finish_inside_autoloaded_files/a skip' test/commands/finish_test.rb
 
-  patch --verbose --strip=1 --input="../${pkgname}_fix_tests.patch"
-
-  sed --in-place --regexp-extended \
-    --expression '/chandler/d' \
-    --expression 's|~>|>=|' \
-    Gemfile \
-    Rakefile
-  sed --in-place --regexp-extended \
-    --expression 's/, ".*"//' \
-    Gemfile
-  sed --in-place --regexp-extended \
-    --expression '/release\.rake/d' \
-    Rakefile
-  sed --in-place --regexp-extended \
-    --expression '/bundler/d' \
-    bin/minitest
-
-  rm --recursive --verbose \
-    .bundle \
-    Gemfile.lock \
-    tasks/release.rake
+  rm --verbose \
+    test/commands/continue_test.rb \
+    test/commands/interrupt_test.rb \
+    test/commands/next_test.rb \
+    test/processors/command_processor_test.rb
 }
 
 build() {
@@ -76,8 +57,6 @@
     --install-dir "tmp_install${_gemdir}" \
     --bindir "tmp_install/usr/bin" \
     byebug-$pkgver.gem
-
-  rake compile:byebug
 
   rm --force --recursive --verbose \
     "tmp_install${_gemdir}/cache/" \
@@ -108,7 +87,7 @@
 check() {
   local _gemdir="$(gem env gemdir)"
   cd byebug-$pkgver
-  RUBYOPT="-r bundler/setup" GEM_HOME="tmp_install/$_gemdir" rake test
+  GEM_HOME="tmp_install/$_gemdir" rake test
 }
 
 package() {


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,4 +1,2 @@
 ruby
 ruby-irb
-ruby-rake
-ruby-rdoc

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,24 +1,15 @@
 prepare() {
 cd byebug-$pkgver
-patch --verbose --strip=1 --input="../${pkgname}_fix_tests.patch"
-sed --in-place --regexp-extended \
---expression '/chandler/d' \
---expression 's|~>|>=|' \
-Gemfile \
-Rakefile
-sed --in-place --regexp-extended \
---expression 's/, ".*"//' \
-Gemfile
-sed --in-place --regexp-extended \
---expression '/release\.rake/d' \
-Rakefile
-sed --in-place --regexp-extended \
---expression '/bundler/d' \
-bin/minitest
-rm --recursive --verbose \
-.bundle \
-Gemfile.lock \
-tasks/release.rake
+patch -p1 -i ../minitest-5.16.patch
+sed -e '/chandler/d;/[rR]ubo[cC]op/d' -e 's|~>|>=|' -e 's/"mdl", "0.9.0"/"mdl", ">= 0.9.0"/' -i Rakefile Gemfile
+rm Gemfile.lock
+sed -i '/bundler/d' bin/minitest
+sed -i '/test_finish_inside_autoloaded_files/a skip' test/commands/finish_test.rb
+rm --verbose \
+test/commands/continue_test.rb \
+test/commands/interrupt_test.rb \
+test/commands/next_test.rb \
+test/processors/command_processor_test.rb
 }
 build() {
 cd byebug-$pkgver
@@ -32,7 +23,6 @@
 --install-dir "tmp_install${_gemdir}" \
 --bindir "tmp_install/usr/bin" \
 byebug-$pkgver.gem
-rake compile:byebug
 rm --force --recursive --verbose \
 "tmp_install${_gemdir}/cache/" \
 "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
