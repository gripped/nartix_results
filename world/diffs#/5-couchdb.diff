--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,7 @@
 
 pkgname=couchdb
 pkgver=3.4.2
-pkgrel=3
+pkgrel=4
 pkgdesc="Document-oriented database that can be queried and indexed in a MapReduce fashion using JSON"
 arch=(x86_64)
 url="https://couchdb.apache.org"
@@ -13,13 +13,21 @@
   ncurses
   zlib
 )
-makedepends=(erlang-nox)
+makedepends=(
+  erlang-asn1
+  erlang-erts
+  erlang-eunit
+  erlang-os_mon
+  erlang-reltool
+  erlang-xmerl
+  rebar3
+)
 checkdepends=(
   elixir
   procps-ng
   python
 )
-optdepends=('erlang-nox: for weatherreport')
+optdepends=('erlang-erts: for weatherreport')
 options=(!makeflags)
 backup=(
   etc/couchdb/local.ini
@@ -29,14 +37,12 @@
 source=(
   "https://archive.apache.org/dist/${pkgname}/source/${pkgver}/apache-${pkgname}-${pkgver}.tar.gz"{,.asc}
   couchdb.default
-  couchdb.service
   couchdb.sysusers
   couchdb.tmpfiles
 )
 sha256sums=('d27ff2a13356000296a98ab884caf3d175927cf21727963ff90fab3a747544cf'
             'SKIP'
             '0d21fdd7851b3a6fa099b030cab0e96705b1d5a3a83a4ff1c871814d8742cae9'
-            '6ab3d362f3fcd9079036c883dc09dc597584cb627831460f2e0c68a31aa052ae'
             '76404436346167dd19c3eace1164e35e3ac91ffed9bc3c20acb1b76e6d306f43'
             '7331b9675e3668c5f0d632bee5d154c061cc3e60d451bef3dc0d0ab2dadfa006')
 validpgpkeys=(
@@ -52,7 +58,9 @@
 
 build() {
   cd apache-couchdb-${pkgver}
-  ./configure --disable-spidermonkey
+  ./configure \
+    --js-engine=quickjs \
+    --disable-spidermonkey
   make release
 }
 
@@ -71,7 +79,6 @@
 
   cd "${srcdir}"
   install -vDm644 ${pkgname}.default "${pkgdir}"/etc/default/${pkgname}
-  install -vDm644 ${pkgname}.service -t "${pkgdir}"/usr/lib/systemd/system/
   install -vDm644 ${pkgname}.tmpfiles "${pkgdir}"/usr/lib/tmpfiles.d/${pkgname}.conf
   install -vDm644 ${pkgname}.sysusers "${pkgdir}"/usr/lib/sysusers.d/${pkgname}.conf
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,6 +1,12 @@
-erlang-nox
+erlang-asn1
+erlang-erts
+erlang-eunit
+erlang-os_mon
+erlang-reltool
+erlang-xmerl
 gcc-libs
 glibc
 icu
 ncurses
+rebar3
 zlib

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -4,6 +4,8 @@
 }
 build() {
 cd apache-couchdb-${pkgver}
-./configure --disable-spidermonkey
+./configure \
+--js-engine=quickjs \
+--disable-spidermonkey
 make release
 }
