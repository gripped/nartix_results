--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,107 +1,47 @@
 
 _gemname=async-dns
 pkgname=ruby-${_gemname}
-pkgver=1.4.1
-pkgrel=1
+pkgver=1.2.6
+pkgrel=3
 pkgdesc='Asynchronous DNS resolver and server'
 url='https://github.com/socketry/async-dns'
 arch=('any')
 license=('MIT')
 depends=(
   ruby
-  ruby-async
-  ruby-io-endpoint
+  ruby-async-io
 )
 makedepends=(
   ruby-rdoc
 )
-checkdepends=(
-  ruby-bake
-  ruby-bake-test
-  ruby-bake-test-external
-  ruby-bundler
-  ruby-covered
-  ruby-decode
-  ruby-sus
-  ruby-sus-fixtures-async
-)
 options=('!emptydirs')
 source=(https://github.com/socketry/async-dns/archive/v${pkgver}/${pkgname}-${pkgver}.tar.gz)
-sha512sums=('4faee2aea6c3218ae97f65e6d625e4fad9707f3c3eac225ffc47439a9b795089855e786d6af1631c69ff056bdd1de60f7c281c6de95b9e3898da1c01cef00b73')
-b2sums=('cbe42f6b1b8d4ec17ac4437cfb40dcad8a60f4a43a6d85a6aa721109887a0c104549002773c313bed3b8ff5dd4cb7b91e56d0ae0001f38d11ff0c18d931ef1a6')
+sha256sums=('ddea9371672f89dd635a2ef930f6df28b06b7ea5a9092a9e6c23ed91a9d778f0')
+sha512sums=('27f36ca08d97b2789347231e2ca12f70a6df8f498bf3231aa5c910858a9c63e89ce20c68de9d6014bdaf238c0e388a5a1a9f7fe959d7b56288046f14b41ab44d')
 
 prepare() {
   cd ${_gemname}-${pkgver}
-
   sed 's|git ls-files|find|' -i ${_gemname}.gemspec
-
-  sed --in-place --regexp-extended \
-    --expression 's|~>|>=|g' \
-    --expression '/signing_key/d' \
-    ${_gemname}.gemspec
-
-  sed --in-place \
-    --expression '/group :maintenance/,/end/d' \
-    --expression '/rubocop/d' \
-    gems.rb
+  sed 's|~>|>=|g' -i ${_gemname}.gemspec # don't give a fuck about rubys bla bla
 }
 
 build() {
-  cd "${_gemname}-${pkgver}"
-
-  local _gemdir="$(gem env gemdir)"
-
-  gem build --verbose "${_gemname}.gemspec"
-
-  gem install \
-    --local \
-    --verbose \
-    --ignore-dependencies \
-    --no-user-install \
-    --install-dir "tmp_install${_gemdir}" \
-    --bindir "tmp_install/usr/bin" \
-    "${_gemname}-${pkgver}.gem"
-
-  rm --force --recursive --verbose \
-    "tmp_install${_gemdir}/cache/" \
-    "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
-    "tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
-
-  find "tmp_install${_gemdir}/gems/" \
-    -type f \
-    \( \
-      -iname "*.o" -o \
-      -iname "*.c" -o \
-      -iname "*.so" -o \
-      -iname "*.time" -o \
-      -iname "gem.build_complete" -o \
-      -iname "Makefile" \
-    \) \
-    -delete
-
-  find "tmp_install${_gemdir}/extensions/" \
-    -type f \
-    \( \
-      -iname "mkmf.log" -o \
-      -iname "gem_make.out" \
-    \) \
-    -delete
-}
-
-check() {
-  cd "${_gemname}-${pkgver}"
-
-  local _gemdir="$(gem env gemdir)"
-
-  GEM_HOME="tmp_install${_gemdir}" bake test
+  cd ${_gemname}-${pkgver}
+  gem build ${_gemname}.gemspec
 }
 
 package() {
-  cd "${_gemname}-${pkgver}"
+  cd ${_gemname}-${pkgver}
+  local _gemdir="$(gem env gemdir)"
+  gem install --ignore-dependencies --no-user-install -i "${pkgdir}/${_gemdir}" \
+    -n "${pkgdir}/usr/bin" ${_gemname}-${pkgver}.gem
 
-  cp --archive --verbose tmp_install/* "${pkgdir}"
+  install -Dm 644 README.md -t "${pkgdir}/usr/share/doc/${pkgname}"
+  install -d "${pkgdir}/usr/share/licenses/${pkgname}"
+  ln -s /usr/share/doc/${pkgname}/README.md "${pkgdir}/usr/share/licenses/${pkgname}"
 
-  install --verbose -D --mode=0644 license* --target-directory "${pkgdir}/usr/share/licenses/${pkgname}"
-  install --verbose -D --mode=0644 *.md --target-directory "${pkgdir}/usr/share/doc/${pkgname}"
+  cd "${pkgdir}/${_gemdir}"
+  rm -rf cache gems/${_gemname}-${pkgver}/{ext,lib/*/*.so} \
+    extensions/*/*/${_gemname}-${pkgver}/{mkmf.log,gem_make.out}
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,4 +1,3 @@
 ruby
-ruby-async
-ruby-io-endpoint
+ruby-async-io
 ruby-rdoc

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,47 +1,9 @@
 prepare() {
 cd ${_gemname}-${pkgver}
 sed 's|git ls-files|find|' -i ${_gemname}.gemspec
-sed --in-place --regexp-extended \
---expression 's|~>|>=|g' \
---expression '/signing_key/d' \
-${_gemname}.gemspec
-sed --in-place \
---expression '/group :maintenance/,/end/d' \
---expression '/rubocop/d' \
-gems.rb
+sed 's|~>|>=|g' -i ${_gemname}.gemspec # don't give a fuck about rubys bla bla
 }
 build() {
-cd "${_gemname}-${pkgver}"
-local _gemdir="$(gem env gemdir)"
-gem build --verbose "${_gemname}.gemspec"
-gem install \
---local \
---verbose \
---ignore-dependencies \
---no-user-install \
---install-dir "tmp_install${_gemdir}" \
---bindir "tmp_install/usr/bin" \
-"${_gemname}-${pkgver}.gem"
-rm --force --recursive --verbose \
-"tmp_install${_gemdir}/cache/" \
-"tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
-"tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
-find "tmp_install${_gemdir}/gems/" \
--type f \
-\( \
--iname "*.o" -o \
--iname "*.c" -o \
--iname "*.so" -o \
--iname "*.time" -o \
--iname "gem.build_complete" -o \
--iname "Makefile" \
-\) \
--delete
-find "tmp_install${_gemdir}/extensions/" \
--type f \
-\( \
--iname "mkmf.log" -o \
--iname "gem_make.out" \
-\) \
--delete
+cd ${_gemname}-${pkgver}
+gem build ${_gemname}.gemspec
 }
