--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,31 +1,35 @@
 
 pkgname=python-stestr
-pkgver=4.2.0
-pkgrel=1
+pkgver=4.1.0
+pkgrel=7
 pkgdesc="A test runner runner similar to testrepository"
 url="https://stestr.readthedocs.io/en/latest/"
-license=('Apache-2.0')
+license=('Apache')
 arch=('any')
-depends=('python-cliff' 'python-subunit' 'python-fixtures' 'python-testtools'
-         'python-yaml' 'python-voluptuous' 'python-tomlkit')
-makedepends=('git' 'python-build' 'python-installer' 'python-flit-core')
-checkdepends=('python-ddt')
-source=("git+https://github.com/mtreinish/stestr.git#tag=$pkgver")
-sha512sums=('232aba1b37f42c13695e586023207259292fc546712d539857095a5819da6091059ec8c1d1262287e2d7f8c7ef6771c5533a730ef5539efdd7f30207b205853e')
+depends=('python-cliff' 'python-pbr' 'python-subunit' 'python-fixtures' 'python-testtools'
+         'python-yaml' 'python-voluptuous' 'python-tomlkit' 'python-extras')
+checkdepends=('python-hacking' 'python-sphinx'
+              'python-ddt')
+source=("https://pypi.io/packages/source/s/stestr/stestr-$pkgver.tar.gz")
+sha512sums=('77287ffdfe59042c4d189aa6c662df4357633d3a134ea60a4533b5b8b1b433ffd6f265a430977da175f242cc1c8e8514f876a486cc900a436cf93ab629fe7b7d')
 
 build() {
-  cd stestr
-  python -m build --wheel --no-isolation
+  cd stestr-$pkgver
+  python setup.py build
 }
 
 check() {
-  cd stestr
-  python -m venv --system-site-packages testenv
-  testenv/bin/python -m installer dist/*.whl
-  PATH="$PWD/testenv/bin:$PATH" testenv/bin/stestr run
+  cd stestr-$pkgver
+  local python_version=$(python -c 'import sys; print(".".join(map(str, sys.version_info[:2])))')
+  python setup.py install --root="$PWD/tmp_install" --optimize=1
+  (
+    export PYTHONPATH="$PWD/tmp_install/usr/lib/python${python_version}/site-packages"
+    export PATH="$PWD/tmp_install/usr/bin:$PATH"
+    stestr run
+  )
 }
 
 package() {
-  cd stestr
-  python -m installer --destdir="$pkgdir" dist/*.whl
+  cd stestr-$pkgver
+  python setup.py install --root="$pkgdir" --optimize=1
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,9 +1,7 @@
-git
-python-build
 python-cliff
+python-extras
 python-fixtures
-python-flit-core
-python-installer
+python-pbr
 python-subunit
 python-testtools
 python-tomlkit

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,4 +1,4 @@
 build() {
-cd stestr
-python -m build --wheel --no-isolation
+cd stestr-$pkgver
+python setup.py build
 }
