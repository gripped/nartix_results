--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,7 @@
 
 pkgname=netavark
 pkgver=1.17.1
-pkgrel=2
+pkgrel=1
 pkgdesc="Container network stack"
 arch=(x86_64)
 url="https://github.com/containers/netavark"
@@ -10,7 +10,6 @@
   aardvark-dns
   gcc-libs
   glibc
-  nftables
 )
 makedepends=(
   cargo
@@ -25,23 +24,18 @@
 
 prepare() {
   cd $pkgname
-  cargo fetch --locked --target "$(rustc --print host-tuple)"
-
-  local in_file
-  for in_file in contrib/systemd/system/*.in; do
-    sed "s|@@NETAVARK@@|/usr/lib/podman/netavark|" "$in_file" > "${in_file%.in}"
-  done
+  cargo fetch --locked --target "$(rustc -vV | sed -n 's/host: //p')"
 }
 
 build() {
   cd $pkgname
   make -C docs
-  cargo build --frozen --release
+  cargo build --frozen --release --all-features
 }
 
 check() {
   cd $pkgname
-  cargo test --frozen
+  cargo test --frozen --all-features
 }
 
 package() {
@@ -49,6 +43,5 @@
   install -vDm 755 target/release/$pkgname -t "$pkgdir/usr/lib/podman/"
   install -vDm 644 docs/*.1 -t "$pkgdir/usr/share/man/man1/"
   install -vDm 644 docs/*.7 -t "$pkgdir/usr/share/man/man7/"
-  install -vDm 644 contrib/systemd/system/*.{service,socket} -t "$pkgdir/usr/lib/systemd/system/"
   install -vDm 644 README.md -t "$pkgdir/usr/share/doc/$pkgname/"
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -4,5 +4,4 @@
 git
 glibc
 go-md2man
-nftables
 protobuf

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,13 +1,9 @@
 prepare() {
 cd $pkgname
-cargo fetch --locked --target "$(rustc --print host-tuple)"
-local in_file
-for in_file in contrib/systemd/system/*.in; do
-sed "s|@@NETAVARK@@|/usr/lib/podman/netavark|" "$in_file" > "${in_file%.in}"
-done
+cargo fetch --locked --target "$(rustc -vV | sed -n 's/host: //p')"
 }
 build() {
 cd $pkgname
 make -C docs
-cargo build --frozen --release
+cargo build --frozen --release --all-features
 }
