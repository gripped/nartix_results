--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,26 +1,19 @@
 
 pkgname=sqlcipher
-pkgver=4.13.0
+pkgver=4.6.1
 pkgrel=1
 pkgdesc="SQLite extension that provides transparent 256-bit AES encryption of database files"
 arch=('x86_64')
-url="https://www.zetetic.net/sqlcipher"
-license=('BSD-3-Clause')
-depends=(
-  'glibc'
-  'openssl'
-  'readline'
-  'tcl'
-  'zlib'
-)
-makedepends=('patchelf')
-source=("$url/verify/$pkgver/$pkgname-$pkgver.zip"{,.sig})
-b2sums=('5bd401df93e0703f1613fdaded1f59f6d36f405908e65b5e88f34594ef35c382cecb6b416344b03c8b02edb5edd602a4efb9754d1e56adbc61d07fb5bf236abc'
-        'SKIP')
+url="https://www.zetetic.net/sqlcipher/"
+license=('BSD')
+depends=('openssl' 'sqlite' 'tcl' 'readline' 'zlib')
+source=(https://www.zetetic.net/$pkgname/verify/$pkgver/$pkgname-$pkgver.zip{,.sig})
 validpgpkeys=('D83F5F9EB811D6E6B4A0D9C5D1FA3A2A97ED25C2') # Zetetic LLC <support@zetetic.net>
+sha256sums=('759adee03f53b46f07c9c0be51a0be3a6fe31640e81d0777b919c8df8d40f6d8'
+            'SKIP')
 
 build() {
-  cd $pkgname-$pkgver
+  cd "${srcdir}"/$pkgname-$pkgver
 
   export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
   export CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
@@ -36,54 +29,31 @@
     -DSQLITE_MAX_EXPR_DEPTH=10000 \
     -DSQLITE_ENABLE_MATH_FUNCTIONS"
 
-  export CFLAGS="$CFLAGS \
-    -DSQLITE_HAS_CODEC \
-    -DSQLITE_TEMP_STORE=2 \
-    -DSQLCIPHER_TEST \
-    -DSQLITE_EXTRA_INIT=sqlcipher_extra_init \
-    -DSQLITE_EXTRA_SHUTDOWN=sqlcipher_extra_shutdown"
-  export LDFLAGS="$LDFLAGS -lcrypto -Wl,-soname,libsqlcipher.so.0"
+  export CFLAGS="$CFLAGS -DSQLITE_HAS_CODEC -DSQLITE_TEMP_STORE=2 -DSQLCIPHER_TEST"
+  export LDFLAGS="$LDFLAGS -lcrypto"
 
   ./configure --prefix=/usr \
-    --with-tempstore=yes \
+    --enable-tempstore=yes \
     --disable-static \
-    --dll-basename=libsqlcipher \
-    --fts3 \
-    --fts4 \
-    --fts5 \
-    --rtree
+    --enable-fts3 \
+    --enable-fts4 \
+    --enable-fts5 \
+    --enable-rtree \
+    --enable-json1
+  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
   make
   make testfixture
 }
 
 check() {
-  cd $pkgname-$pkgver
+  cd "${srcdir}"/$pkgname-$pkgver
   ./testfixture test/sqlcipher.test
 }
 
 package() {
-  cd $pkgname-$pkgver
-  make DESTDIR="$pkgdir" install
+  cd "${srcdir}"/$pkgname-$pkgver
 
-  mv -v "$pkgdir/usr/bin/sqlite3" "$pkgdir/usr/bin/sqlcipher"
+  make DESTDIR="${pkgdir}" install
 
-  install -vd "$pkgdir/usr/include/sqlcipher"
-  mv -v "$pkgdir/usr/include/sqlite3.h" "$pkgdir/usr/include/sqlcipher/"
-  mv -v "$pkgdir/usr/include/sqlite3ext.h" "$pkgdir/usr/include/sqlcipher/"
-
-  mv -v "$pkgdir/usr/lib/tcl8.6/sqlite3.51.2" "$pkgdir/usr/lib/tcl8.6/sqlite3"
-  mv -v "$pkgdir/usr/lib/tcl8.6/sqlite3/libsqlite3.51.2.so" \
-    "$pkgdir/usr/lib/tcl8.6/sqlite3/libtclsqlite3.so"
-  patchelf --set-soname libtclsqlite3.so \
-    "$pkgdir/usr/lib/tcl8.6/sqlite3/libtclsqlite3.so"
-
-  rm -v "$pkgdir/usr/share/man/man1/sqlite3.1"
-  install -vDm644 sqlcipher.1 "$pkgdir/usr/share/man/man1/sqlcipher.1"
-
-  mv -v "$pkgdir/usr/lib/pkgconfig/sqlite3.pc" "$pkgdir/usr/lib/pkgconfig/sqlcipher.pc"
-  sed -i -e 's/-lsqlite3/-lsqlcipher/g' \
-    -e 's|includedir=.*|includedir=${prefix}/include/sqlcipher|' \
-    "$pkgdir/usr/lib/pkgconfig/sqlcipher.pc"
-
-  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE.md
+  install -Dm644 LICENSE.md "${pkgdir}"/usr/share/licenses/$pkgname/LICENSE
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,6 +1,5 @@
-glibc
 openssl
-patchelf
 readline
+sqlite
 tcl
 zlib

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,5 +1,5 @@
 build() {
-cd $pkgname-$pkgver
+cd "${srcdir}"/$pkgname-$pkgver
 export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
 export CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
 export CPPFLAGS="$CPPFLAGS \
@@ -12,21 +12,17 @@
 -DSQLITE_MAX_VARIABLE_NUMBER=250000 \
 -DSQLITE_MAX_EXPR_DEPTH=10000 \
 -DSQLITE_ENABLE_MATH_FUNCTIONS"
-export CFLAGS="$CFLAGS \
--DSQLITE_HAS_CODEC \
--DSQLITE_TEMP_STORE=2 \
--DSQLCIPHER_TEST \
--DSQLITE_EXTRA_INIT=sqlcipher_extra_init \
--DSQLITE_EXTRA_SHUTDOWN=sqlcipher_extra_shutdown"
-export LDFLAGS="$LDFLAGS -lcrypto -Wl,-soname,libsqlcipher.so.0"
+export CFLAGS="$CFLAGS -DSQLITE_HAS_CODEC -DSQLITE_TEMP_STORE=2 -DSQLCIPHER_TEST"
+export LDFLAGS="$LDFLAGS -lcrypto"
 ./configure --prefix=/usr \
---with-tempstore=yes \
+--enable-tempstore=yes \
 --disable-static \
---dll-basename=libsqlcipher \
---fts3 \
---fts4 \
---fts5 \
---rtree
+--enable-fts3 \
+--enable-fts4 \
+--enable-fts5 \
+--enable-rtree \
+--enable-json1
+sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
 make
 make testfixture
 }
