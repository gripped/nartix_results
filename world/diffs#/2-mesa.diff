--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -12,11 +12,10 @@
   vulkan-radeon
   vulkan-swrast
   vulkan-virtio
-  vulkan-mesa-device-select
   vulkan-mesa-layers
   mesa-docs
 )
-pkgver=25.2.3
+pkgver=25.2.2
 pkgrel=2
 epoch=1
 pkgdesc="Open-source OpenGL drivers"
@@ -48,7 +47,6 @@
   rust
   spirv-llvm-translator
   spirv-tools
-  systemd-libs
   vulkan-icd-loader
   wayland
   xcb-util-keysyms
@@ -81,6 +79,7 @@
 )
 source=(
   "https://archive.mesa3d.org/mesa-$pkgver.tar.xz"{,.sig}
+  0001-Revert-virgl-Avoid-possible-double-free-when-destroy.patch
 )
 validpgpkeys=(
   946D09B5E4C9845E63075FF1D961C596A7203456 # Andres Gomez <tanty@igalia.com>
@@ -134,8 +133,9 @@
   )
 done
 
-b2sums=('1810c17e589f95f1e3b18f2562a0c193016a6b9aa260387d06b0750db7c1fb08e7ad1b2476caf79cde18fa919b320de2b12508228047e8ca3af13efb2046b3fe'
+b2sums=('bed81e32c05ebff6f2a76bb14387882eed48556737e30e2da2f5a02fbe9e9973f5fa05303e10e624bb703ef56c4fe2f48ab69f3d2806191969d73d99920b5abb'
         'SKIP'
+        '3198b6925142ee72f674a80466a057e0cbaa6beb4a09b91032e6b80da2d56363bbe51787a5a00a056bcee341dd9a9ca9a790fd35a8c5949bf8b49223c34c9a20'
         '431439d31632d177aeb15f910b4f546efa76d54fc74fc8e140399dc5e54eca33fd606f11dbfb48fa83067c8474ee512e62751895d5948367b65ab08b984284e5'
         'a6d47c903be6094423d89b8ec3ca899d0a84df6dbd6e76632bb6c9b9f40ad9c216f8fa400310753d392f85072756b43ac3892e0a2c4d55f87ab6463002554823'
         '9a73962e1e38b84131ab2350b69a1f5d611c549533eec73e898c394a9b9442f357bb5d5f59e1be12270dd29bdf237dc2d21786c0c2210736e224ef5d48300dcf'
@@ -164,8 +164,9 @@
         '7681b1a7497b5711e663773c1a7e076f333c06c10d3f289079a781c36f050c1620cc279742ea8e5b15ec48f3d6038a6079bbda7fee3ae8e1128bd916d53ed43a'
         '93385f64103fdb482bec34c7912474ae7a5935948715e6eb9a54907e0db5c39f089f6cd393bab33c935c59a1bbb0f4099431f206343811c1a450554d96a35756')
 
-sha256sums=('f2d6b28562f1d6cb9c17ee8e58eeade7aa5faf927ae71065eadb41e17f92b4f8'
+sha256sums=('43d7abcd4aa8049d8fd75538344a374104765e81e17b4a6314cee2c0160e4412'
             'SKIP'
+            'd917b24fcbc00776cb2b24aae2030f1cc456c6d3885392530ee508d108097aa8'
             '67914ab451f3bfd2e69e5e9d2ef3858484e7074d63f204fd166ec391b54de21d'
             'ed646292ffc8188ef8ea4d1e0e0150fb15a5c2e12ad9b8fc191ae7a8a7f3c4b9'
             '7f9f832470494906d1fca5329f8ab5791cc60beb230c74815dff541cbd2b5ca0'
@@ -235,7 +236,7 @@
 
   export MESON_PACKAGE_CACHE_DIR="$srcdir"
 
-  arch-meson mesa-$pkgver build "${meson_options[@]}"
+  artix-meson mesa-$pkgver build "${meson_options[@]}"
   meson compile -C build
 }
 
@@ -329,12 +330,9 @@
     _pick vkvirtio $icddir/virtio_icd.*.json
     _pick vkvirtio $libdir/libvulkan_virtio.so
 
-    _pick vkdevice $libdir/libVkLayer_MESA_device_select.so
-    _pick vkdevice usr/share/vulkan/implicit_layer.d
-
     _pick vklayer $libdir/libVkLayer_*.so
     _pick vklayer usr/bin/mesa-*-control.py
-    _pick vklayer usr/share/vulkan/explicit_layer.d
+    _pick vklayer usr/share/vulkan/{ex,im}plicit_layer.d
 
     _pick docs usr/share/doc
 
@@ -388,9 +386,7 @@
     libxcb
     libxshmfence
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
     zlib
@@ -415,9 +411,7 @@
     libxcb
     libxshmfence
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
     zlib
@@ -442,9 +436,7 @@
     libxcb
     libxshmfence
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
     zlib
@@ -468,9 +460,7 @@
     libx11
     libxcb
     libxshmfence
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
   )
@@ -493,9 +483,7 @@
     libxcb
     libxshmfence
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
     zlib
@@ -520,9 +508,7 @@
     libxcb
     libxshmfence
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
     zlib
@@ -549,9 +535,7 @@
     libxshmfence
     llvm-libs
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
     zlib
@@ -577,9 +561,7 @@
     libxshmfence
     llvm-libs
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
     zlib
@@ -605,9 +587,7 @@
     libx11
     libxcb
     libxshmfence
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-device-select
+    vulkan-icd-loader
     wayland
     xcb-util-keysyms
     zlib
@@ -617,20 +597,6 @@
   provides=(vulkan-driver)
 
   mv vkvirtio/* "$pkgdir"
-
-  install -Dm644 mesa-$pkgver/docs/license.rst -t "$pkgdir/usr/share/licenses/$pkgname"
-}
-
-package_vulkan-mesa-device-select() {
-  pkgdesc="Mesa's Vulkan Device Select layer"
-  depends=(
-    glibc
-    libdrm
-    libxcb
-    wayland
-  )
-
-  mv vkdevice/* "$pkgdir"
 
   install -Dm644 mesa-$pkgver/docs/license.rst -t "$pkgdir/usr/share/licenses/$pkgname"
 }
@@ -640,7 +606,10 @@
   depends=(
     gcc-libs
     glibc
+    libdrm
     libpng
+    libxcb
+    wayland
 
     python
   )


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -37,10 +37,8 @@
 rust-bindgen
 spirv-llvm-translator
 spirv-tools
-systemd-libs
 valgrind
 vulkan-icd-loader
-vulkan-mesa-device-select
 wayland
 wayland-protocols
 xcb-util-keysyms