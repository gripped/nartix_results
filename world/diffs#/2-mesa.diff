--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -12,13 +12,13 @@
   vulkan-radeon
   vulkan-swrast
   vulkan-virtio
-  vulkan-mesa-implicit-layers
+  vulkan-mesa-device-select
   vulkan-mesa-layers
   mesa-docs
 )
-pkgver=25.3.1
+pkgver=25.2.7
 _pkgver=${pkgver/[a-z]/-&}
-pkgrel=2
+pkgrel=1
 epoch=1
 pkgdesc="Open-source OpenGL drivers"
 url="https://www.mesa3d.org/"
@@ -30,12 +30,12 @@
   expat
   gcc-libs
   glibc
-  libdisplay-info
   libdrm
   libelf
   libglvnd
   libpng
   libva
+  libvdpau
   libx11
   libxcb
   libxext
@@ -49,7 +49,6 @@
   rust
   spirv-llvm-translator
   spirv-tools
-  systemd-libs
   vulkan-icd-loader
   wayland
   xcb-util-keysyms
@@ -82,6 +81,8 @@
 )
 source=(
   "https://archive.mesa3d.org/mesa-$_pkgver.tar.xz"{,.sig}
+
+  0001-anv-fix-FS-output-attachment-map-building.patch
 )
 validpgpkeys=(
   946D09B5E4C9845E63075FF1D961C596A7203456 # Andres Gomez <tanty@igalia.com>
@@ -123,7 +124,7 @@
 )
 
 _gencrates() {
-  grep '^source_url' subprojects/*-rs.wrap | \
+  grep crates.io subprojects/*.wrap | \
     sed -r 's|.*crates/([^/]+)/([0-9.]+)/download|\1 \2|' | \
     column -t -S 2 | sed 's/^/  /'
 }
@@ -135,8 +136,9 @@
   )
 done
 
-b2sums=('1c2927a04eeac787a583a31167ae1d40cb839fc45fcd3c0bad0e0b3842694444bd3f950d106f692ceb47b9881c9d101be995bcf7385a4fb992c54a23d56ffd1e'
+b2sums=('7e834275fc23760e76c944cd83440e26bbc6286bb4bad75d7344a62934dc472e9f9f24a756e3b7488a617c2934dbdefd91bf79847ea09b5767ea3ccc2fdf5173'
         'SKIP'
+        'ee9be38d036aad299b3ecd32b2ca3fca5534c6ab329bb0d9f841ce5911d5f6a0fcdab2219b7a3a849f585863c313465ea3160e201b23ce3a80a2bfeaaabd06bc'
         '431439d31632d177aeb15f910b4f546efa76d54fc74fc8e140399dc5e54eca33fd606f11dbfb48fa83067c8474ee512e62751895d5948367b65ab08b984284e5'
         'a6d47c903be6094423d89b8ec3ca899d0a84df6dbd6e76632bb6c9b9f40ad9c216f8fa400310753d392f85072756b43ac3892e0a2c4d55f87ab6463002554823'
         '9a73962e1e38b84131ab2350b69a1f5d611c549533eec73e898c394a9b9442f357bb5d5f59e1be12270dd29bdf237dc2d21786c0c2210736e224ef5d48300dcf'
@@ -165,8 +167,9 @@
         '7681b1a7497b5711e663773c1a7e076f333c06c10d3f289079a781c36f050c1620cc279742ea8e5b15ec48f3d6038a6079bbda7fee3ae8e1128bd916d53ed43a'
         '93385f64103fdb482bec34c7912474ae7a5935948715e6eb9a54907e0db5c39f089f6cd393bab33c935c59a1bbb0f4099431f206343811c1a450554d96a35756')
 
-sha256sums=('059d0d985622f49588f01aa29152804f4da8ffe6add046e00a52923379c2d8da'
+sha256sums=('b40232a642011820211aab5a9cdf754e106b0bce15044bc4496b0ac9615892ad'
             'SKIP'
+            '58e81f7d5f38c837f6414f4eb8ba150b21309d02a2060559556e47a3c67cc2fe'
             '67914ab451f3bfd2e69e5e9d2ef3858484e7074d63f204fd166ec391b54de21d'
             'ed646292ffc8188ef8ea4d1e0e0150fb15a5c2e12ad9b8fc191ae7a8a7f3c4b9'
             '7f9f832470494906d1fca5329f8ab5791cc60beb230c74815dff541cbd2b5ca0'
@@ -215,10 +218,9 @@
   local meson_options=(
     -D android-libbacktrace=disabled
     -D b_ndebug=true
-    -D gallium-drivers=asahi,crocus,d3d12,freedreno,i915,iris,llvmpipe,nouveau,r300,r600,radeonsi,softpipe,svga,virgl,zink
+    -D gallium-drivers=r300,r600,radeonsi,nouveau,virgl,svga,llvmpipe,softpipe,iris,crocus,i915,zink,d3d12,asahi,freedreno
     -D gallium-extra-hud=true
     -D gallium-mediafoundation=disabled
-    -D gallium-rusticl-enable-drivers=asahi,freedreno,radeonsi
     -D gallium-rusticl=true
     -D gles1=disabled
     -D html-docs=enabled
@@ -228,8 +230,8 @@
     -D sysprof=true
     -D valgrind=enabled
     -D video-codecs=all
-    -D vulkan-drivers=amd,freedreno,intel,intel_hasvk,swrast,virtio,microsoft-experimental,nouveau,asahi,gfxstream
-    -D vulkan-layers=device-select,intel-nullhw,overlay,screenshot,anti-lag,vram-report-limit
+    -D vulkan-drivers=amd,gfxstream,intel,intel_hasvk,nouveau,swrast,virtio,microsoft-experimental,asahi,freedreno
+    -D vulkan-layers=device-select,intel-nullhw,overlay,screenshot,vram-report-limit
   )
 
   CFLAGS+=" -g1"
@@ -237,7 +239,7 @@
 
   export MESON_PACKAGE_CACHE_DIR="$srcdir"
 
-  arch-meson mesa-$_pkgver build "${meson_options[@]}"
+  artix-meson mesa-$_pkgver build "${meson_options[@]}"
   meson compile -C build
 }
 
@@ -275,16 +277,20 @@
   provides=(
     "libva-mesa-driver=$epoch:$pkgver-$pkgrel"
     "mesa-libgl=$epoch:$pkgver-$pkgrel"
+    "mesa-vdpau=$epoch:$pkgver-$pkgrel"
     libva-driver
     opengl-driver
+    vdpau-driver
   )
   conflicts=(
     'libva-mesa-driver<1:24.2.7-1'
     'mesa-libgl<17.0.1-2'
+    'mesa-vdpau<1:24.2.7-1'
   )
   replaces=(
     'libva-mesa-driver<1:24.2.7-1'
     'mesa-libgl<17.0.1-2'
+    'mesa-vdpau<1:24.2.7-1'
   )
 
   meson install -C build --destdir "$pkgdir" --no-rebuild
@@ -327,7 +333,6 @@
     _pick vkvirtio $icddir/virtio_icd.*.json
     _pick vkvirtio $libdir/libvulkan_virtio.so
 
-    _pick vkdevice $libdir/libVkLayer_MESA_anti_lag.so
     _pick vkdevice $libdir/libVkLayer_MESA_device_select.so
     _pick vkdevice usr/share/vulkan/implicit_layer.d
 
@@ -382,15 +387,13 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
-    libdrm
-    libx11
-    libxcb
-    libxshmfence
-    spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    libdrm
+    libx11
+    libxcb
+    libxshmfence
+    spirv-tools
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
     zlib
@@ -410,15 +413,13 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
-    libdrm
-    libx11
-    libxcb
-    libxshmfence
-    spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    libdrm
+    libx11
+    libxcb
+    libxshmfence
+    spirv-tools
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
     zlib
@@ -438,15 +439,13 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
-    libdrm
-    libx11
-    libxcb
-    libxshmfence
-    spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    libdrm
+    libx11
+    libxcb
+    libxshmfence
+    spirv-tools
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
     zlib
@@ -466,14 +465,12 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
-    libdrm
-    libx11
-    libxcb
-    libxshmfence
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    libdrm
+    libx11
+    libxcb
+    libxshmfence
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
   )
@@ -491,15 +488,13 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
-    libdrm
-    libx11
-    libxcb
-    libxshmfence
-    spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    libdrm
+    libx11
+    libxcb
+    libxshmfence
+    spirv-tools
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
     zlib
@@ -519,15 +514,13 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
-    libdrm
-    libx11
-    libxcb
-    libxshmfence
-    spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    libdrm
+    libx11
+    libxcb
+    libxshmfence
+    spirv-tools
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
     zlib
@@ -547,7 +540,6 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
     libdrm
     libelf
     libx11
@@ -555,9 +547,8 @@
     libxshmfence
     llvm-libs
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
     zlib
@@ -578,16 +569,14 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
     libdrm
     libx11
     libxcb
     libxshmfence
     llvm-libs
     spirv-tools
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
     zlib
@@ -609,14 +598,12 @@
     expat
     gcc-libs
     glibc
-    libdisplay-info
-    libdrm
-    libx11
-    libxcb
-    libxshmfence
-    systemd-libs
-    vulkan-icd-loader
-    vulkan-mesa-implicit-layers
+    libdrm
+    libx11
+    libxcb
+    libxshmfence
+    vulkan-icd-loader
+    vulkan-mesa-device-select
     wayland
     xcb-util-keysyms
     zlib
@@ -630,16 +617,14 @@
   install -Dm644 mesa-$_pkgver/docs/license.rst -t "$pkgdir/usr/share/licenses/$pkgname"
 }
 
-package_vulkan-mesa-implicit-layers() {
-  pkgdesc="Mesa's implicit Vulkan layers"
-  depends=(
-    glibc
-    libdrm
-    libxcb
-    wayland
-  )
-  conflicts=(vulkan-mesa-device-select)
-  replaces=(vulkan-mesa-device-select)
+package_vulkan-mesa-device-select() {
+  pkgdesc="Mesa's Vulkan Device Select layer"
+  depends=(
+    glibc
+    libdrm
+    libxcb
+    wayland
+  )
 
   mv vkdevice/* "$pkgdir"
 
@@ -647,7 +632,7 @@
 }
 
 package_vulkan-mesa-layers() {
-  pkgdesc="Mesa's explicit Vulkan layers"
+  pkgdesc="Mesa's Vulkan layers"
   depends=(
     gcc-libs
     glibc


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -8,13 +8,13 @@
 glibc
 glslang
 libclc
-libdisplay-info
 libdrm
 libelf
 libglvnd
 libpng
 libsysprof-capture
 libva
+libvdpau
 libx11
 libxcb
 libxext
@@ -37,10 +37,9 @@
 rust-bindgen
 spirv-llvm-translator
 spirv-tools
-systemd-libs
 valgrind
 vulkan-icd-loader
-vulkan-mesa-implicit-layers
+vulkan-mesa-device-select
 wayland
 wayland-protocols
 xcb-util-keysyms