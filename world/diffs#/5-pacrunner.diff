--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,77 +1,48 @@
 
 pkgname=pacrunner
 pkgver=0.19
-pkgrel=4
+pkgrel=3
 pkgdesc="Proxy configuration daemon"
 arch=(x86_64)
 url="https://git.kernel.org/pub/scm/network/connman/pacrunner.git"
-license=(GPL-2.0-only)
-depends=(
-  curl
-  dbus
-  duktape
-  glib2
-  glibc
-)
+license=(GPL2 LGPL2.1)
+depends=(glib2 dbus curl duktape)
 makedepends=(git)
-source=(
-  "git+https://git.kernel.org/pub/scm/network/connman/pacrunner.git#tag=$pkgver"
-  0001-Link-duktape-dynamically.patch
-)
-b2sums=('c7fdb1641c5933a62d99c696c77d6edabc9d2a6b47b52f2e7434bed874c063a3000ccc47c09bd7e2c6829937d5cd05e083f752d3cda7b6e52d00211f17ef4802'
-        '97700f151a95badde24c110659c1e95a8656cb021a54de3627ced2bb792cc65c0a35ea330302ae125ce1b9713077293e6f6073599e6b71d6180b8f366754c5d8')
+_commit=bb888a1f99cc05d63bd61b65cad7026feea92a4e  # tags/0.19^0
+source=("git+https://git.kernel.org/pub/scm/network/connman/pacrunner.git#commit=$_commit"
+        duktape-shared.diff)
+sha256sums=('SKIP'
+            '2cbb148bc7cd72230a1aa465c806260eb0fc1dd47d8663b2b48d25cc29622d02')
+
+pkgver() {
+  cd $pkgname
+  git describe --tags | sed 's/-/+/g'
+}
 
 prepare() {
   cd $pkgname
 
-  git apply -3 ../0001-Link-duktape-dynamically.patch
+  git apply -3 ../duktape-shared.diff
 
   ./bootstrap
 }
 
 build() {
-  local configure_options=(
-    --prefix=/usr
-    --sysconfdir=/etc
-    --localstatedir=/var
-    --sbindir=/usr/bin
-    --libexecdir=/usr/lib
-    --with-dbusconfdir=/usr/share
-    --enable-pie
-    --enable-duktape
+  cd $pkgname
+  ./configure \
+    --prefix=/usr \
+    --sysconfdir=/etc \
+    --localstatedir=/var \
+    --sbindir=/usr/bin \
+    --libexecdir=/usr/lib \
+    --with-dbusconfdir=/usr/share \
+    --enable-pie \
+    --enable-duktape \
     --enable-curl
-  )
-
-  cd $pkgname
-  ./configure "${configure_options[@]}"
   make
 }
 
 package() {
   cd $pkgname
   make DESTDIR="$pkgdir" install
-
-  install -Dm644 /dev/stdin "$pkgdir/usr/lib/systemd/system/pacrunner.service" <<END
-[Unit]
-Description=Proxy configuration daemon
-Before=network.target
-Wants=network.target
-
-[Service]
-Type=dbus
-BusName=org.pacrunner
-ExecStart=/usr/bin/pacrunner
-
-[Install]
-WantedBy=multi-user.target
-END
-
-  install -Dm644 /dev/stdin "$pkgdir/usr/share/dbus-1/system-services/org.pacrunner.service" <<END
-[D-BUS Service]
-Name=org.pacrunner
-Exec=/usr/bin/pacrunner
-User=root
-SystemdService=pacrunner.service
-END
 }
-


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -3,4 +3,3 @@
 duktape
 git
 glib2
-glibc

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,21 +1,19 @@
 prepare() {
 cd $pkgname
-git apply -3 ../0001-Link-duktape-dynamically.patch
+git apply -3 ../duktape-shared.diff
 ./bootstrap
 }
 build() {
-local configure_options=(
---prefix=/usr
---sysconfdir=/etc
---localstatedir=/var
---sbindir=/usr/bin
---libexecdir=/usr/lib
---with-dbusconfdir=/usr/share
---enable-pie
---enable-duktape
+cd $pkgname
+./configure \
+--prefix=/usr \
+--sysconfdir=/etc \
+--localstatedir=/var \
+--sbindir=/usr/bin \
+--libexecdir=/usr/lib \
+--with-dbusconfdir=/usr/share \
+--enable-pie \
+--enable-duktape \
 --enable-curl
-)
-cd $pkgname
-./configure "${configure_options[@]}"
 make
 }
