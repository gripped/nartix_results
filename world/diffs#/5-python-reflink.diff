--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,10 +1,10 @@
 
 pkgname=python-reflink
 pkgver=0.2.2
-pkgrel=6
+pkgrel=5
 pkgdesc='Reflink support for Python'
 arch=(x86_64)
-url='https://gitlab.com/rubdos/pyreflink'
+url=https://gitlab.com/rubdos/pyreflink
 license=(MIT)
 depends=(
   glibc
@@ -13,33 +13,30 @@
 )
 makedepends=(
   git
-  python-build
-  python-installer
   python-setuptools
   python-wheel
 )
-source=("$pkgname::git+$url#tag=$pkgver")
-sha512sums=('7814d63d294f37a5de46f13dccb14db84ebc92c23916cd8f165d43b0330a1e162dd1f543c4e8788bf7edb5b9c976954c3356e778e77b5a96653379e73632efb8')
-b2sums=('2b6e4c572945d3598664f49853b248ddaa0689e3286d891011717ed19dc868c6f5ce1b60278155e9d7f3bd656bc321ca40c17a843071330c32bdd3096289f47f')
+_tag=f49e834dea6be63c7eb7d31e344232820514880d
+source=(git+https://gitlab.com/rubdos/pyreflink.git#tag=${_tag})
+b2sums=(SKIP)
 
 prepare() {
-  cd "$pkgname"
+  sed '/pytest-runner/d' -i pyreflink/setup.py
+}
 
-  sed \
-    -e '/pytest-runner/d' \
-    -i setup.py
+pkgver() {
+  cd pyreflink
+  git describe --tags
 }
 
 build() {
-  cd "$pkgname"
-
-  python -m build --wheel --no-isolation
+  cd pyreflink
+  python setup.py build
 }
 
 package() {
-  cd "$pkgname"
+  cd pyreflink
+  python setup.py install --root="${pkgdir}" --optimize=1
+  install -Dm 644 LICENSE -t "${pkgdir}"/usr/share/licenses/python-reflink/
+}
 
-  python -m installer --destdir="$pkgdir" dist/*.whl
-
-  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE
-}


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,8 +1,6 @@
 git
 glibc
 python
-python-build
 python-cffi
-python-installer
 python-setuptools
 python-wheel

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,10 +1,7 @@
 prepare() {
-cd "$pkgname"
-sed \
--e '/pytest-runner/d' \
--i setup.py
+sed '/pytest-runner/d' -i pyreflink/setup.py
 }
 build() {
-cd "$pkgname"
-python -m build --wheel --no-isolation
+cd pyreflink
+python setup.py build
 }
