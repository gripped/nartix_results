--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,8 +1,8 @@
 
 _gemname='rdoc'
 pkgname="ruby-${_gemname}"
-pkgver=6.10.0
-pkgrel=57
+pkgver=6.6.3.1
+pkgrel=2
 pkgdesc='Command-line documentation generator for Ruby projects'
 arch=('any')
 url='https://ruby.github.io/rdoc/'
@@ -27,8 +27,7 @@
 )
 options=('!emptydirs')
 source=("https://github.com/ruby/rdoc/archive/v${pkgver}/${pkgname}-${pkgver}.tar.gz")
-sha512sums=('670295bf8dceb59100fcf6cef46942414d5b1367ff604be3623b5264955c879e37f0bbe382af48a22113f7702d6e3d6e2ed122b6649466779ae4bca1cb0c128b')
-b2sums=('f73029ea1d4984510a2ffe30ca608f609b218948b34ea9966e0ea0482b20946b90b753fe905109a042819677a291442fadc9e66961648db4f1bc442fc817600b')
+sha512sums=('c6f3aae83e895e2de28e5a7c27456160dd53007ceb4464a045e0211473eb3d51f49a7c2ac28f2e44e807c5b36447140d15eadff65bfa52335e94adc9c8b56d2e')
 
 prepare() {
   cd "${_gemname}-${pkgver}"
@@ -39,68 +38,53 @@
 build() {
   cd "${_gemname}-${pkgver}"
 
+  rake generate
+  gem build "${_gemname}.gemspec"
+
+  rake rdoc
+}
+
+check() {
+  cd "${_gemname}-${pkgver}"
+
+  rake normal_test
+  rake rubygems_test
+}
+
+package() {
+  cd "${_gemname}-${pkgver}"
+
   local _gemdir="$(gem env gemdir)"
-
-  rake generate
-  gem build --verbose "${_gemname}.gemspec"
-  rake rdoc
+  local _platform="$(gem env platform | cut -d':' -f2)"
+  local _extension_api_version="$(ruby -e 'puts Gem.extension_api_version')"
 
   gem install \
     --local \
     --verbose \
     --ignore-dependencies \
     --no-user-install \
-    --install-dir "tmp_install${_gemdir}" \
-    --bindir "tmp_install/usr/bin" \
+    --install-dir "${pkgdir}/${_gemdir}" \
+    --bindir "${pkgdir}/usr/bin" \
     "${_gemname}-${pkgver}.gem"
 
-    rm --force --recursive --verbose \
-      "tmp_install${_gemdir}/cache/" \
-      "tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
-      "tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
+  install --verbose --directory --mode=0755 \
+    "${pkgdir}/usr/lib/ruby/${_extension_api_version}/${_platform}" \
+    "${pkgdir}${_gemdir}/specifications/default"
 
-    find "tmp_install${_gemdir}/gems/" \
-      -type f \
-      \( \
-        -iname "*.o" -o \
-        -iname "*.c" -o \
-        -iname "*.so" -o \
-        -iname "*.time" -o \
-        -iname "gem.build_complete" -o \
-        -iname "Makefile" \
-      \) \
-      -delete
+  mv --verbose "${pkgdir}${_gemdir}/specifications/${_gemname}-${pkgver}.gemspec" "${pkgdir}${_gemdir}/specifications/default/${_gemname}-${pkgver}.gemspec"
+  mv --verbose "${pkgdir}${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}.rb" "${pkgdir}/usr/lib/ruby/${_extension_api_version}/${_gemname}.rb"
+  mv --verbose "${pkgdir}${_gemdir}/gems/${_gemname}-${pkgver}/lib/${_gemname}" "${pkgdir}/usr/lib/ruby/${_extension_api_version}/${_gemname}"
 
-    find "tmp_install${_gemdir}/extensions/" \
-      -type f \
-      \( \
-        -iname "mkmf.log" -o \
-        -iname "gem_make.out" \
-      \) \
-      -delete
-}
-
-check() {
-  cd "${_gemname}-${pkgver}"
-
-  local _gemdir="\$(gem env gemdir)"
-
-  GEM_HOME="tmp_install\${_gemdir}" rake normal_test rubygems_test
-}
-
-package() {
-  cd "${_gemname}-${pkgver}"
-
-  cp --archive --verbose tmp_install/* "${pkgdir}"
+  rm --force --recursive --verbose \
+    "${pkgdir}${_gemdir}/cache/" \
+    "${pkgdir}${_gemdir}/build_info/" \
+    "${pkgdir}${_gemdir}/extensions/" \
+    "${pkgdir}${_gemdir}/gems/${_gemname}-${pkgver}/"{.git*,bin,man,*.*,Gemfile,Rakefile} \
+    "${pkgdir}${_gemdir}/plugins/" \
+    "${pkgdir}${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
 
   install --verbose -D --mode=0644 man/ri.1 --target-directory "${pkgdir}/usr/share/man/man1"
   install --verbose -D --mode=0644 LEGAL.rdoc LICENSE.rdoc --target-directory "${pkgdir}/usr/share/licenses/${pkgname}"
   install --verbose -D --mode=0644 *.md *.rdoc --target-directory "${pkgdir}/usr/share/doc/${pkgname}"
-
-  local _gemdir="$(gem env gemdir)"
-  local _rubygems_plugin_path="${pkgdir}${_gemdir}/plugins"
-
-  mkdir --parents ${_rubygems_plugin_path}
-  echo "require_relative '../gems/rdoc-${pkgver}/lib/rubygems_plugin.rb'" > "${_rubygems_plugin_path}/rdoc_plugin.rb"
 }
 


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -4,38 +4,7 @@
 }
 build() {
 cd "${_gemname}-${pkgver}"
-local _gemdir="$(gem env gemdir)"
 rake generate
-gem build --verbose "${_gemname}.gemspec"
+gem build "${_gemname}.gemspec"
 rake rdoc
-gem install \
---local \
---verbose \
---ignore-dependencies \
---no-user-install \
---install-dir "tmp_install${_gemdir}" \
---bindir "tmp_install/usr/bin" \
-"${_gemname}-${pkgver}.gem"
-rm --force --recursive --verbose \
-"tmp_install${_gemdir}/cache/" \
-"tmp_install${_gemdir}/gems/${_gemname}-${pkgver}/vendor/" \
-"tmp_install${_gemdir}/doc/${_gemname}-${pkgver}/ri/ext/"
-find "tmp_install${_gemdir}/gems/" \
--type f \
-\( \
--iname "*.o" -o \
--iname "*.c" -o \
--iname "*.so" -o \
--iname "*.time" -o \
--iname "gem.build_complete" -o \
--iname "Makefile" \
-\) \
--delete
-find "tmp_install${_gemdir}/extensions/" \
--type f \
-\( \
--iname "mkmf.log" -o \
--iname "gem_make.out" \
-\) \
--delete
 }
