--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,6 +1,6 @@
 
 pkgname=flatpak-builder
-pkgver=1.4.3
+pkgver=1.4.2
 pkgrel=1
 pkgdesc="Tool to build flatpaks from source"
 url="https://flatpak.org"
@@ -11,20 +11,11 @@
   binutils
   breezy
   cpio
-  curl
   debugedit
   elfutils
   flatpak
   fuse3
-  gcc-libs
   git
-  glib2
-  glibc
-  json-glib
-  libelf
-  libxml2
-  libyaml
-  ostree
   patch
   rpmextract
   tar
@@ -39,23 +30,30 @@
 )
 checkdepends=(valgrind)
 replaces=('flatpak<0.9.10')
+_commit=0b9070037a573a6061d7893312611957561ca841  # tags/1.4.2
 source=(
-  "git+https://github.com/flatpak/flatpak-builder#tag=$pkgver"
+  "git+https://github.com/flatpak/flatpak-builder#commit=$_commit"
   "git+https://gitlab.gnome.org/GNOME/libglnx.git"
   fusermount3.diff
 )
-b2sums=('fabb2a890fe39a0b1bb130a6858cbd348a80b35e14d73c1165bb70c9e649c990f5b7ae56ef1802f1c7c9a6c42ce7db0706f5fa099544eb682bc104bca4a06e7f'
+b2sums=('SKIP'
         'SKIP'
         'ef1a73c8e2876a8c0c1401300b4367cfc3e656d2144fb66fbf22a57c178588a42ac842f5d7ccec9fba15084dc8bb6a544b2b77c1877c4c924dbe4ab6cd1962c4')
+
+pkgver() {
+  cd $pkgname
+  git describe --tags | sed 's/[^-]*-g/r&/;s/-/+/g'
+}
 
 prepare() {
   cd $pkgname
 
+  git cherry-pick -n ae86bde81fbb0316f08121793c0824c18b1cfb9a
+
   git apply -3 ../fusermount3.diff
 
   git submodule set-url subprojects/libglnx "$srcdir/libglnx"
-  git -c protocol.file.allow=always -c protocol.allow=never \
-    submodule update --init -- subprojects/libglnx
+  git -c protocol.file.allow=always submodule update --init -- subprojects/libglnx
 }
 
 build() {
@@ -63,12 +61,12 @@
     -D fuse=3
   )
 
-  arch-meson $pkgname build "${meson_options[@]}"
+  artix-meson $pkgname build "${meson_options[@]}"
   meson compile -C build
 }
 
 check() {
-  meson test -C build --print-errorlogs
+  meson test -C build --print-errorlogs ||: # skip failing tests
 }
 
 package() {


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -2,23 +2,14 @@
 binutils
 breezy
 cpio
-curl
 debugedit
 docbook-xsl
 elfutils
 flatpak
 fuse3
-gcc-libs
 git
-glib2
-glibc
 gobject-introspection
-json-glib
-libelf
-libxml2
-libyaml
 meson
-ostree
 patch
 rpmextract
 tar

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,14 +1,14 @@
 prepare() {
 cd $pkgname
+git cherry-pick -n ae86bde81fbb0316f08121793c0824c18b1cfb9a
 git apply -3 ../fusermount3.diff
 git submodule set-url subprojects/libglnx "$srcdir/libglnx"
-git -c protocol.file.allow=always -c protocol.allow=never \
-submodule update --init -- subprojects/libglnx
+git -c protocol.file.allow=always submodule update --init -- subprojects/libglnx
 }
 build() {
 local meson_options=(
 -D fuse=3
 )
-arch-meson $pkgname build "${meson_options[@]}"
+artix-meson $pkgname build "${meson_options[@]}"
 meson compile -C build
 }
