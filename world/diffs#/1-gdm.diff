--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -4,8 +4,8 @@
   gdm
   libgdm
 )
-pkgver=49.0.1
-pkgrel=1
+pkgver=48.0
+pkgrel=2
 pkgdesc="Display manager and login screen"
 url="https://gitlab.gnome.org/GNOME/gdm"
 arch=(x86_64)
@@ -30,8 +30,8 @@
   libxcb
   libxdmcp
   pam
-  systemd
-  systemd-libs
+  elogind
+  libelogind
   upower
 )
 makedepends=(
@@ -56,18 +56,26 @@
 source=(
   "git+https://gitlab.gnome.org/GNOME/gdm.git#tag=${pkgver/[a-z]/.&}"
   0001-Xsession-Don-t-start-ssh-agent-by-default.patch
+  0002-gdm-settings-utils-rename-variable-to-fix-build-with.patch
 )
-b2sums=('bf9a8743fdac75bdac37edaae7c237454a28e781522d1082492d6c09ba86c1354214c84df7a7307660a2f02969b2c8c08b647720a829b7929fde5d845efabda6'
-        'f7e868fdd7cc121433de1572583eb728f4d186cd4f52c6d6c8f2ccf4a3cf781144ff71f704f13571ddb97a1ff4ec55cfa3df25d38737ad19da21e84ddc2d3ee4')
+b2sums=('d08d2137f630999b2f36bd8b798805e145fd7350fc4a092056cfdddd2170ae57b3b17a3a8f44f4c08a7e527a165fdce0dfa7a934188bc487d2a6d5bd848497b0'
+        'f7e868fdd7cc121433de1572583eb728f4d186cd4f52c6d6c8f2ccf4a3cf781144ff71f704f13571ddb97a1ff4ec55cfa3df25d38737ad19da21e84ddc2d3ee4'
+        'c704138b5f6be3ebb7d6606a78d2008cff1116bb033a0ba531b21e2b0cfc7c631c7c0720aa35694c1f0e36d9d6b81e9186f8e3f9fa12e885fe522cfcd2d98d63')
 
 prepare() {
   cd gdm
 
   git apply -3 ../0001-Xsession-Don-t-start-ssh-agent-by-default.patch
+
+  git apply -3 ../0002-gdm-settings-utils-rename-variable-to-fix-build-with.patch
 }
 
 build() {
   local meson_options=(
+    -D logind-provider=elogind
+    -D systemd-journal=false
+    -D systemdsystemunitdir=no
+    -D systemduserunitdir=no
     -D dbus-sys="/usr/share/dbus-1/system.d"
     -D default-pam-config=arch
     -D default-path="/usr/local/bin:/usr/local/sbin:/usr/bin"
@@ -77,7 +85,7 @@
     -D selinux=disabled
   )
 
-  arch-meson gdm build "${meson_options[@]}"
+  artix-meson gdm build "${meson_options[@]}"
   meson compile -C build
 }
 
@@ -115,14 +123,34 @@
 
   cd "$pkgdir"
 
+  install -d -o   0 -g   0 -m 0755 var
+  install -d -o   0 -g   0 -m 0755 var/lib
+  install -d -o 120 -g 120 -m 1770 var/lib/gdm
+  install -d -o 120 -g 120 -m 0700 var/lib/gdm/.config
+  install -d -o 120 -g 120 -m 0700 var/lib/gdm/.config/pulse
+
+  install -o120 -g120 -m644 /dev/stdin var/lib/gdm/.config/pulse/default.pa <<END
+load-module module-device-restore
+load-module module-card-restore
+load-module module-udev-detect
+load-module module-native-protocol-unix
+load-module module-default-device-restore
+load-module module-always-sink
+load-module module-intended-roles
+load-module module-suspend-on-idle
+load-module module-systemd-login
+load-module module-position-event-sounds
+END
+
   install -Dm644 /dev/stdin usr/lib/sysusers.d/gdm.conf <<END
 g gdm 120 -
+u gdm 120 "Gnome Display Manager" /var/lib/gdm
 END
 
   install -Dm644 /dev/stdin usr/share/glib-2.0/schemas/org.gnome.login-screen.gschema.override <<END
 [org.gnome.login-screen]
 enable-smartcard-authentication=false
-logo='/usr/share/pixmaps/archlinux-logo-text-dark.svg'
+logo='/usr/share/pixmaps/artixlinux-logo-text-dark.svg'
 END
 
   _pick libgdm usr/include
@@ -138,8 +166,8 @@
     glib2
     glibc
     libg{lib,object,io}-2.0.so
-    libsystemd.so
-    systemd-libs
+    libelogind.so
+    libelogind
   )
   provides=(libgdm.so)
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -3,6 +3,7 @@
 bash
 dconf
 docbook-xsl
+elogind
 gcc-libs
 gdk-pixbuf2
 git
@@ -16,12 +17,13 @@
 json-glib
 keyutils
 libcanberra
+libelogind
+libelogind.so
 libgdm
 libgio-2.0.so
 libglib-2.0.so
 libgobject-2.0.so
 libgudev
-libsystemd.so
 libx11
 libxau
 libxcb
@@ -29,8 +31,6 @@
 meson
 pam
 plymouth
-systemd
-systemd-libs
 upower
 xorg-server
 xorg-xhost