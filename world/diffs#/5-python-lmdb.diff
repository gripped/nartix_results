--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,54 +1,42 @@
 
-_srcname=py-lmdb
+_pkg=py-lmdb
 pkgname=python-lmdb
-pkgver=1.7.5
+pkgver=1.5.1
 pkgrel=1
-pkgdesc='Universal Python binding for the LMDB Lightning Database'
-arch=('x86_64')
-url='https://github.com/jnwatson/py-lmdb/'
+pkgdesc="Universal Python binding for the LMDB Lightning Database"
+arch=(x86_64)
+url="https://github.com/jnwatson/py-lmdb/"
 license=('OLDAP-2.8')
-depends=(
-    'glibc'
-    'lmdb'
-    'python'
-    'python-cffi')
-makedepends=(
-    'python-build'
-    'python-installer'
-    'python-patch-ng'
-    'python-setuptools'
-    'python-wheel')
-checkdepends=(
-    'python-pytest')
-source=("https://github.com/jnwatson/py-lmdb/archive/${_srcname}_${pkgver}/${pkgname}-${pkgver}.tar.gz")
-sha256sums=('715a642f6d8df1dbd2ad47d30a567982350213388ab4559fb418be4c1eb3a320')
+depends=(python python-cffi lmdb)
+makedepends=(python-build python-installer python-setuptools python-wheel)
+checkdepends=(python-pytest)
+source=(${url}/archive/${_pkg}_${pkgver}.tar.gz
+        010-python-lmdb-python3.13-fix.patch::https://github.com/jnwatson/py-lmdb/pull/368/commits/206a3754466397baeb418e70be9d35b12cc4079f.patch)
+sha256sums=('fa0a84d166418fdb87fc8bd235d85aa7bcb690e995ff32ea411aa50eaf52607e'
+            '5f97c3327e23cd01041373214f95d42304943f681bf88733ee933194a874aca9')
+
+prepare() {
+    patch -d ${_pkg}-${_pkg}_${pkgver} -Np1 -i "${srcdir}/010-python-lmdb-python3.13-fix.patch"
+}
 
 build() {
-    cd "${_srcname}-${_srcname}_${pkgver}"
-
-    export LMDB_FORCE_SYSTEM='1'
-    python -m build --wheel --no-isolation
+  cd ${_pkg}-${_pkg}_${pkgver}
+  LMDB_FORCE_SYSTEM=1 python -m build --wheel --no-isolation
 }
 
 check() {
-    cd "${_srcname}-${_srcname}_${pkgver}"
-
-    local _pyver
-    _pyver="$(python -c 'import sys; print("".join(map(str, sys.version_info[:2])))')"
-
-    export LMDB_FORCE_SYSTEM='1'
-    export PYTHONPATH="${PWD}/build/lib.linux-${CARCH}-cpython-${_pyver}"
-    pytest -vv --color='yes'
+  cd ${_pkg}-${_pkg}_${pkgver}
+  local _pyver
+  _pyver="$(python -c 'import sys; print("".join(map(str, sys.version_info[:2])))')"
+  LMDB_FORCE_SYSTEM=1 PYTHONPATH="${PWD}"/build/lib.linux-$CARCH-cpython-${_pyver} pytest -vv --color=yes
 }
 
 package() {
-    export LMDB_FORCE_SYSTEM='1'
-    python -m installer --destdir="$pkgdir" "${_srcname}-${_srcname}_${pkgver}/dist"/*.whl
-
-    local _sitepkgs
-    _sitepkgs="$(python -c 'import site; print(site.getsitepackages()[0])')"
-
-    install -d -m755 "${pkgdir}/usr/share/licenses/${pkgname}"
-    ln -sr "${pkgdir}${_sitepkgs}/lmdb-${pkgver}.dist-info/licenses/LICENSE" \
-        "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
+  cd ${_pkg}-${_pkg}_${pkgver}
+  local _pyver
+  _pyver="$(python -c 'import sys; print("%s.%s" %sys.version_info[0:2])')"
+  LMDB_FORCE_SYSTEM=1 python -m installer --destdir="$pkgdir" dist/*.whl
+  install -d -m755 "${pkgdir}"/usr/share/licenses/${pkgname}
+  ln -s ../../../lib/python${_pyver}/site-packages/lmdb-${pkgver}.dist-info/LICENSE \
+    "${pkgdir}"/usr/share/licenses/${pkgname}/LICENSE
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,9 +1,7 @@
-glibc
 lmdb
 python
 python-build
 python-cffi
 python-installer
-python-patch-ng
 python-setuptools
 python-wheel

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,5 +1,7 @@
+prepare() {
+patch -d ${_pkg}-${_pkg}_${pkgver} -Np1 -i "${srcdir}/010-python-lmdb-python3.13-fix.patch"
+}
 build() {
-cd "${_srcname}-${_srcname}_${pkgver}"
-export LMDB_FORCE_SYSTEM='1'
-python -m build --wheel --no-isolation
+cd ${_pkg}-${_pkg}_${pkgver}
+LMDB_FORCE_SYSTEM=1 python -m build --wheel --no-isolation
 }
