--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,7 @@
 
 pkgname=cfitsio
-pkgver=4.5.0
-pkgrel=1
+pkgver=4.6.0
+pkgrel=4
 epoch=1
 pkgdesc='A library of C and Fortran subroutines for reading and writing data files in FITS (Flexible Image Transport System) data format'
 arch=(x86_64)
@@ -10,19 +10,20 @@
 depends=(curl
          glibc
          zlib)
-makedepends=(cmake)
-source=(https://heasarc.gsfc.nasa.gov/FTP/software/fitsio/c/$pkgname-$pkgver.tar.gz)
-sha256sums=('e4854fc3365c1462e493aa586bfaa2f3d0bb8c20b75a524955db64c27427ce09')
+makedepends=(cmake
+             git)
+source=(git+https://github.com/HEASARC/cfitsio#tag=cfitsio-$pkgver)
+sha256sums=('41d79d1cabc3ae860ad3ecf25fc22ec1d6595f3618d1af6934fad7996cdddf84')
 
 prepare() {
-  sed -e 's|/lib/|/|g' -i $pkgname-$pkgver/CMakeLists.txt
+  sed -e 's|@LIB_DESTINATION@|/usr/lib|' -e 's|@INCLUDE_INSTALL_DIR@|/usr/include|' -i $pkgname/cfitsio.pc.cmake
 }
 
 build() {
-  cmake -B build -S $pkgname-$pkgver \
+  cmake -B build -S $pkgname \
     -DCMAKE_INSTALL_PREFIX=/usr \
     -DUSE_PTHREADS=ON \
-    -DTESTS=ON \
+    -DTESTS=OFF \
     -DUTILS=ON
   cmake --build build
 }
@@ -34,5 +35,9 @@
 
 package() {
   DESTDIR="$pkgdir" cmake --install build
-  install -D -m644 $pkgname-$pkgver/licenses/* "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
+  install -D -m644 $pkgname/licenses/* "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
+
+  for _bin in imcopy smem speed; do
+    mv "$pkgdir"/usr/bin/{,cfitsio-}$_bin
+  done
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,4 +1,5 @@
 cmake
 curl
+git
 glibc
 zlib

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,11 +1,11 @@
 prepare() {
-sed -e 's|/lib/|/|g' -i $pkgname-$pkgver/CMakeLists.txt
+sed -e 's|@LIB_DESTINATION@|/usr/lib|' -e 's|@INCLUDE_INSTALL_DIR@|/usr/include|' -i $pkgname/cfitsio.pc.cmake
 }
 build() {
-cmake -B build -S $pkgname-$pkgver \
+cmake -B build -S $pkgname \
 -DCMAKE_INSTALL_PREFIX=/usr \
 -DUSE_PTHREADS=ON \
--DTESTS=ON \
+-DTESTS=OFF \
 -DUTILS=ON
 cmake --build build
 }
