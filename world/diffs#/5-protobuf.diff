--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -2,7 +2,7 @@
 pkgbase='protobuf'
 pkgname=('protobuf' 'python-protobuf' 'ruby-google-protobuf')
 pkgver=30.2
-pkgrel=1
+pkgrel=3
 pkgdesc="Protocol Buffers - Google's data interchange format"
 arch=('x86_64')
 url='https://developers.google.com/protocol-buffers/'
@@ -23,6 +23,7 @@
   'python-setuptools'
   'python-wheel'
   'ruby'
+  'ruby-ffi-compiler'
   'ruby-rake'
   'ruby-rake-compiler'
 )
@@ -76,8 +77,7 @@
   local _gemver=4.$pkgver
 
   PROTOC="$srcdir"/build/protoc \
-  rake genproto
-  rake copy_third_party
+  rake
 
   gem build --verbose "${_gemname}.gemspec"
 
@@ -90,6 +90,9 @@
     --bindir "tmp_install/usr/bin" \
     "${_gemname}-${_gemver}.gem"
 
+  install -D lib/google/protobuf_c.so \
+    "tmp_install${_gemdir}/gems/${_gemname}-${_gemver}"/lib/google/$(ruby -e 'require "rbconfig"; puts RbConfig::CONFIG["RUBY_API_VERSION"]')/protobuf_c.so
+
   rm --force --recursive --verbose \
     "tmp_install${_gemdir}/cache/" \
     "tmp_install${_gemdir}/gems/${_gemname}-${_gemver}/vendor/" \
@@ -100,7 +103,6 @@
     \( \
       -iname "*.o" -o \
       -iname "*.c" -o \
-      -iname "*.so" -o \
       -iname "*.time" -o \
       -iname "gem.build_complete" -o \
       -iname "Makefile" \


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -13,6 +13,7 @@
 python-wheel
 ruby
 ruby-bigdecimal
+ruby-ffi-compiler
 ruby-rake
 ruby-rake-compiler
 zlib

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -25,8 +25,7 @@
 local _gemdir="$(gem env gemdir)"
 local _gemver=4.$pkgver
 PROTOC="$srcdir"/build/protoc \
-rake genproto
-rake copy_third_party
+rake
 gem build --verbose "${_gemname}.gemspec"
 gem install \
 --local \
@@ -36,6 +35,8 @@
 --install-dir "tmp_install${_gemdir}" \
 --bindir "tmp_install/usr/bin" \
 "${_gemname}-${_gemver}.gem"
+install -D lib/google/protobuf_c.so \
+"tmp_install${_gemdir}/gems/${_gemname}-${_gemver}"/lib/google/$(ruby -e 'require "rbconfig"; puts RbConfig::CONFIG["RUBY_API_VERSION"]')/protobuf_c.so
 rm --force --recursive --verbose \
 "tmp_install${_gemdir}/cache/" \
 "tmp_install${_gemdir}/gems/${_gemname}-${_gemver}/vendor/" \
@@ -45,7 +46,6 @@
 \( \
 -iname "*.o" -o \
 -iname "*.c" -o \
--iname "*.so" -o \
 -iname "*.time" -o \
 -iname "gem.build_complete" -o \
 -iname "Makefile" \
