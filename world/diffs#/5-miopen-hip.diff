--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,128 +1,60 @@
 
 pkgname=miopen-hip
-pkgver=7.2.0
+pkgver=6.0.2
 pkgrel=1
-_fdeep_ver=0.15.31
 pkgdesc="AMD's Machine Intelligence Library (HIP backend)"
 arch=('x86_64')
 url="https://rocm.docs.amd.com/projects/MIOpen/en/latest/index.html"
 license=('MIT')
-depends=(
-  'bzip2'
-  'comgr'
-  'composable-kernel'
-  'gcc-libs'
-  'glibc'
-  'hip-runtime-amd'
-  'hipblas'
-  'hipblaslt'
-  'rocblas'
-  'rocm-core'
-  'rocrand'
-  'roctracer'
-  'sqlite'
-)
-makedepends=(
-  'boost'
-  'cmake'
-  'eigen'
-  'functional-plus'
-  'git'
-  'git-lfs'
-  'lbzip2'
-  'ninja'
-  'nlohmann-json'
-  'rocm-cmake'
-)
+depends=('rocm-core' 'glibc' 'gcc-libs' 'rocblas' 'rocm-clang-ocl' 'hip'
+         'comgr' 'bzip2' 'composable-kernel' 'roctracer' 'sqlite')
+makedepends=('cmake' 'ninja' 'rocm-cmake' 'boost' 'lbzip2'
+             'nlohmann-json' 'eigen' 'half' 'functional-plus' 'frugally-deep')
 provides=('miopen')
 conflicts=('miopen')
+_git='https://github.com/ROCm/MIOpen'
 _mlir='https://github.com/ROCm/rocMLIR'
-_mlir_ver=7.1
-_git='https://github.com/ROCm/rocm-libraries'
-source=(
-  "rocm-libraries::git+$_git.git#tag=rocm-$pkgver"
-  "${pkgname}-MIFin::git+https://github.com/ROCm/MIFin.git"
-  "${pkgname}-rocmlir::git+https://github.com/ROCm/rocMLIR#tag=rocm-$_mlir_ver"
-  "${pkgname}-half::git+https://github.com/ROCm/half#tag=rocm-$pkgver"
-  "${pkgname}-frugally-deep::git+https://github.com/Dobiasd/frugally-deep#tag=v$_fdeep_ver"
-)
-sha256sums=('e1b1239b5c9025437edd1a3af757fd37cd8fa299bdbbbce6f82392fd2c7df736'
-            'SKIP'
-            '52051d393202b5a72824d788fd245fd81bd12e3a88f95969d65031912127f927'
-            'f21d7a04cae40af1d843ad9ca81416bb469f0540607f68b2e35b642362c89b42'
-            'd1e1d55945eded7219c50f59f55967327118d6792df5a283c01131b18a3f061f')
+source=("$pkgname-$pkgver.tar.gz::$_git/archive/rocm-$pkgver.tar.gz"
+        "$pkgname-rocmlir-$pkgver.tar.gz::$_mlir/archive/rocm-$pkgver.tar.gz")
+sha256sums=('e6f671bd6af59f7470f42cda2ff9e77441d8f6c2105772bbf855d31da1085ffa'
+            '6ed039e8045169bb64c10fb063c2e1753b8d52d6d56c60e001c929082be1f20b')
 options=(!lto)
-_dirname="rocm-libraries/projects/miopen"
+_dirname="$(basename "$_git")-$(basename "${source[0]}" .tar.gz)"
+_mlirname="$(basename "$_mlir")-$(basename "${source[1]}" .tar.gz)"
 
 prepare() {
-  cd "$_dirname"
-  git submodule init
-
-  git config submodule."fin".url "${srcdir}/${pkgname}"-MIFin
-
-  git -c protocol.file.allow=always submodule update --init --recursive
-
-  sed -i '/add_subdirectory(test)/d' CMakeLists.txt
+    sed -i '/add_subdirectory(test)/d' "$_dirname/CMakeLists.txt"
 }
 
 build() {
-  local fdeep_args=(
-    -S $pkgname-frugally-deep
-        -B build-frugally-deep
-        -Wno-dev
-        -DCMAKE_BUILD_TYPE=None
-        -DCMAKE_INSTALL_PREFIX=/usr
-    -DCMAKE_POLICY_VERSION_MINIMUM=3.5
-  )
-  cmake "${fdeep_args[@]}"
-  cmake --build build-frugally-deep
-  DESTDIR="$srcdir/deps" cmake --install build-frugally-deep
-
+  export CC=/opt/rocm/llvm/bin/clang
+  export CXX=/opt/rocm/llvm/bin/clang++
   local llvm_args=(
     -Wno-dev
     -G Ninja
     -B build-mlir
-    -S "$pkgname-rocmlir"
+    -S "$_mlirname"
     -D CMAKE_CXX_FLAGS="${CXXFLAGS} -fcf-protection=none"
     -D CMAKE_INSTALL_PREFIX=/usr
     -D CMAKE_BUILD_TYPE=Release
-    -D CMAKE_C_COMPILER=amdclang
-    -D CMAKE_CXX_COMPILER=amdclang++
     -D ROCM_TEST_CHIPSET=gfx900
     -D BUILD_FAT_LIBROCKCOMPILER=ON
-    -D CMAKE_POLICY_VERSION_MINIMUM=3.5
   )
   cmake "${llvm_args[@]}"
   cmake --build build-mlir
   DESTDIR="$srcdir/deps" cmake --install build-mlir
 
-  local half_args=(
-    -Wno-dev
-    -G Ninja
-    -B build-half
-    -S "$pkgname-half"
-    -D CMAKE_INSTALL_PREFIX=/usr
-    -D CMAKE_BUILD_TYPE=None
-    -D CMAKE_POLICY_VERSION_MINIMUM=3.5
-  )
-  cmake "${half_args[@]}"
-  cmake --build build-half
-  DESTDIR="$srcdir/deps" cmake --install build-half
-
   local cmake_args=(
-    -Wno-dev
+     -Wno-dev
     -G Ninja
     -B build
     -S "$_dirname"
     -D CMAKE_CXX_FLAGS="${CXXFLAGS} -fcf-protection=none -DNDEBUG"
     -D CMAKE_INSTALL_PREFIX=/opt/rocm
     -D CMAKE_BUILD_TYPE=None
-    -D CMAKE_C_COMPILER=amdclang
-    -D CMAKE_CXX_COMPILER=amdclang++
     -D MIOPEN_BACKEND=HIP
-    -D HALF_INCLUDE_DIR="$srcdir/deps/usr/include"
+    -D HALF_INCLUDE_DIR=/usr/include/half
     -D CMAKE_PREFIX_PATH="$srcdir/deps/usr/lib/cmake"
-    -D CMAKE_POLICY_VERSION_MINIMUM=3.5
   )
   cmake "${cmake_args[@]}"
   cmake --build build
@@ -131,5 +63,5 @@
 package() {
   DESTDIR="$pkgdir" cmake --install build
 
-  install -Dm644 "$_dirname/LICENSE.md" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
+  install -Dm644 "$_dirname/LICENSE.txt" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -4,20 +4,18 @@
 comgr
 composable-kernel
 eigen
+frugally-deep
 functional-plus
 gcc-libs
-git
-git-lfs
 glibc
-hip-runtime-amd
-hipblas
-hipblaslt
+half
+hip
 lbzip2
 ninja
 nlohmann-json
 rocblas
+rocm-clang-ocl
 rocm-cmake
 rocm-core
-rocrand
 roctracer
 sqlite

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,51 +1,23 @@
 prepare() {
-cd "$_dirname"
-git submodule init
-git config submodule."fin".url "${srcdir}/${pkgname}"-MIFin
-git -c protocol.file.allow=always submodule update --init --recursive
-sed -i '/add_subdirectory(test)/d' CMakeLists.txt
+sed -i '/add_subdirectory(test)/d' "$_dirname/CMakeLists.txt"
 }
 build() {
-local fdeep_args=(
--S $pkgname-frugally-deep
--B build-frugally-deep
--Wno-dev
--DCMAKE_BUILD_TYPE=None
--DCMAKE_INSTALL_PREFIX=/usr
--DCMAKE_POLICY_VERSION_MINIMUM=3.5
-)
-cmake "${fdeep_args[@]}"
-cmake --build build-frugally-deep
-DESTDIR="$srcdir/deps" cmake --install build-frugally-deep
+export CC=/opt/rocm/llvm/bin/clang
+export CXX=/opt/rocm/llvm/bin/clang++
 local llvm_args=(
 -Wno-dev
 -G Ninja
 -B build-mlir
--S "$pkgname-rocmlir"
+-S "$_mlirname"
 -D CMAKE_CXX_FLAGS="${CXXFLAGS} -fcf-protection=none"
 -D CMAKE_INSTALL_PREFIX=/usr
 -D CMAKE_BUILD_TYPE=Release
--D CMAKE_C_COMPILER=amdclang
--D CMAKE_CXX_COMPILER=amdclang++
 -D ROCM_TEST_CHIPSET=gfx900
 -D BUILD_FAT_LIBROCKCOMPILER=ON
--D CMAKE_POLICY_VERSION_MINIMUM=3.5
 )
 cmake "${llvm_args[@]}"
 cmake --build build-mlir
 DESTDIR="$srcdir/deps" cmake --install build-mlir
-local half_args=(
--Wno-dev
--G Ninja
--B build-half
--S "$pkgname-half"
--D CMAKE_INSTALL_PREFIX=/usr
--D CMAKE_BUILD_TYPE=None
--D CMAKE_POLICY_VERSION_MINIMUM=3.5
-)
-cmake "${half_args[@]}"
-cmake --build build-half
-DESTDIR="$srcdir/deps" cmake --install build-half
 local cmake_args=(
 -Wno-dev
 -G Ninja
@@ -54,12 +26,9 @@
 -D CMAKE_CXX_FLAGS="${CXXFLAGS} -fcf-protection=none -DNDEBUG"
 -D CMAKE_INSTALL_PREFIX=/opt/rocm
 -D CMAKE_BUILD_TYPE=None
--D CMAKE_C_COMPILER=amdclang
--D CMAKE_CXX_COMPILER=amdclang++
 -D MIOPEN_BACKEND=HIP
--D HALF_INCLUDE_DIR="$srcdir/deps/usr/include"
+-D HALF_INCLUDE_DIR=/usr/include/half
 -D CMAKE_PREFIX_PATH="$srcdir/deps/usr/lib/cmake"
--D CMAKE_POLICY_VERSION_MINIMUM=3.5
 )
 cmake "${cmake_args[@]}"
 cmake --build build
