--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,6 +1,6 @@
 
 pkgname=nodejs-lts-jod
-pkgver=22.18.0
+pkgver=22.17.1
 pkgrel=1
 pkgdesc='Evented I/O for V8 javascript ("Active LTS" release: Jod)'
 arch=(x86_64)
@@ -16,16 +16,13 @@
 )
 conflicts=(nodejs)
 source=("https://nodejs.org/dist/v${pkgver}/node-v${pkgver}.tar.xz")
-sha256sums=('120e0f74419097a9fafae1fd80b9de7791a587e6f1c48c22b193239ccd0f7084')
-
-_set_flags() {
-  CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
-  CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
-}
+sha256sums=('327415fd76fcebb98133bf56e2d90e3ac048b038fac2676f03b6db91074575b9')
 
 build() {
-  _set_flags
   cd node-v${pkgver}
+
+  export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
+  export CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
 
   ./configure \
     --prefix=/usr \
@@ -43,7 +40,6 @@
 }
 
 check() {
-  _set_flags
   cd node-v${pkgver}
   rm test/parallel/test-http2-client-set-priority.js
   rm test/parallel/test-http2-priority-event.js
@@ -52,8 +48,11 @@
 }
 
 package() {
-  _set_flags
   cd node-v${pkgver}
+
+  export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
+  export CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
+
   make DESTDIR="${pkgdir}" install
   install -Dm644 LICENSE -t "${pkgdir}"/usr/share/licenses/${pkgname}/
 }


############# Stripped diff below #################



--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,6 +1,7 @@
 build() {
-_set_flags
 cd node-v${pkgver}
+export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
+export CXXFLAGS="${CXXFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
 ./configure \
 --prefix=/usr \
 --with-intl=system-icu \
