--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,18 +1,14 @@
 
 pkgname=(cuda cuda-tools)
 pkgbase=cuda
-pkgver=13.0.1
-_driverver=580.82.07
-pkgrel=1
+pkgver=12.9.1
+_driverver=575.57.08
+pkgrel=2
 pkgdesc="NVIDIA's GPU programming toolkit"
-arch=(x86_64)
+arch=('x86_64')
 url="https://developer.nvidia.com/cuda-zone"
 license=(LicenseRef-NVIDIA-CUDA)
-depends=(
-  opencl-nvidia
-  python
-  gcc
-)
+depends=('opencl-nvidia' 'python' 'gcc14')
 options=(!strip !debug staticlibs)
 install=cuda.install
 source=(https://developer.download.nvidia.com/compute/cuda/${pkgver}/local_installers/cuda_${pkgver}_${_driverver}_linux.run
@@ -48,11 +44,13 @@
         nvToolsExt.pc
         nsight-compute.desktop
         nsight-systems.desktop
+        nvvp.desktop
+        fix-glibc241.patch
         fix-glibc242.patch
 )
-sha512sums=('ec45bdbf883114092058a03f3efd03355d0d612597ce5baef812305a889e90d1faf8db805190ff19aa431b4c9b9454d8901bb38dcbec84278887d27ea10e965e'
-            '0a8eb5f01cf3bf5cce22b7bcffec825ad926ee46ecfd9b266749045736cb8e3decb0158f14e6bee0e07ead8a88495d29a778de2e71c7b255b67500a049b2d52b'
-            '3ef1d31adef59aaac464441aa1b8d92e706323492347e8ffec4ba1419576d3889791c8c13e8903dd79ceefc164cf473aef650105d1927cdb6676c936b66b2e45'
+sha512sums=('fc29c5fc1121fb6634f1fe396abe7f34d351686454516269e9143e678ea178f906a35b916b8bb2d96ecfcfc705dda7d0f4547f7e7f00d36e392d981a766b6a56'
+            '0d16ae7c880ee6e73babac28a80cb439098ded2224f06b3f0a1cbd8ad35302505fd89230a2b7d5a1a7dbd2df170a7897884eb9d06d515b56500dfc32a8d81fad'
+            '714d973bc79446f73bebe85306b3566fe25b554bcbcba2fcbe76709a3eca71fb5d183ab4da2d3b5e9326cb9cd8d13a93f6d4a005ea5a41f7ef8e6c6e81e06b5e'
             'a4b3b03682801a98a1d8c1d14c084fd35efd384d92d497e230e3a28e0bd97b1fa48a93ccb2150f892f0b4154ca4ea2d66f5484a6a59b5c9b49963de42ecf1736'
             'd69d3ec0e270648f55d8c3e420f89d056b120eca5b25e9e7fc1cca799d1a252909ee31ff399c137223eca57cdf82b856221a251b6ff1daf5d6f75c1a582b1e32'
             'e463a596d34cc7d7e42c32e8a72b327aedb8707902dda8767f2c22a6a7e6dda7fcd297c0036b004ce4f1677408084acb6f4ed683cd6c79558ba8bb4e1a83867f'
@@ -83,6 +81,8 @@
             '16003e7e6307d39a95fe246a7d079e9a3d827bd03fd5f03bdd2051a5033a1f93d9c8531073ef587808a9d0c75d20e3d79417a90b14102bc872d32c2c7a5ebdcb'
             '78109166c44bd9d84399f97805b2d7b3dc2dffd5730f2f7c5dde1c07c4e90e3a5af14ff2b46f4b90b8b8390f72ca509526e38042ecfb57f50bb69ccb1f34db15'
             '1f3edd63bc8d252f2818204657da9bcf9c78ec009d4b4e2addbad83e619c1ebaad9c28c0e592974d29e1ce1c29588ff9100a0970febe789cdea7316d16884cce'
+            '0fdd26868445946d5a3a64fd1a9a996dab6e85ee07b08e7c64a66a5db194653b98817bee876838c792cf57fcd4747173f1b1e77b083a9bbbb68932c0aa95185a'
+            'a6107446d30b3e95b63064c56a86622cf186e140de2ed2de476035ad1d7caaf056af6c86149818edbd6b488942b24724d176cf8f976f272ab4023bbe2f972681'
             'c7c7dbb0e21cb2342ede4bf730fe1191d59879e03151707c5519f4cafb64f1f7fdc3211f9d451ca789ab362de67cd43c2d4e1e2a714c8537a601b36cb63cb5b2')
 
 prepare() {
@@ -103,6 +103,7 @@
   mkdir -p "${_prepdir_tools}"/opt/cuda/
   local tools_components=(
     cuda_nsight/{bin,nsightee_plugins}
+    cuda_nvvp/{bin,libnvvp}
     cuda_sanitizer_api/compute-sanitizer
     nsight_compute
     nsight_systems
@@ -111,7 +112,7 @@
     cp -alr "$component" "${_prepdir_tools}"/opt/cuda/
     rm -r "$component"
   done
-  rmdir cuda_nsight cuda_sanitizer_api
+  rmdir cuda_nvvp cuda_nsight cuda_sanitizer_api
 
   ln -s ../compute-sanitizer/compute-sanitizer "${_prepdir_tools}"/opt/cuda/bin/compute-sanitizer
 
@@ -121,10 +122,6 @@
     cp -alr --force "$lib"/* "${_prepdir}"/opt/cuda/
     rm -r "$lib"
   done
-
-  mv "${_prepdir}"/opt/cuda/extras/CUPTI/include/* "${_prepdir}"/opt/cuda/include/
-  mv "${_prepdir}"/opt/cuda/extras/CUPTI/lib64/* "${_prepdir}"/opt/cuda/lib64/
-  rmdir "${_prepdir}"/opt/cuda/extras/CUPTI/{include,lib64}
 
   rm "${_prepdir}"/opt/cuda/include/include
   rm "${_prepdir}"/opt/cuda/lib64/lib64
@@ -138,6 +135,7 @@
     sed -i "s|/usr/local/cuda|/opt/cuda|g" "$f"
   done
 
+  patch -p1 -d "$_prepdir" -i "$srcdir"/fix-glibc241.patch
   patch -p1 -d "$_prepdir" -i "$srcdir"/fix-glibc242.patch
 }
 
@@ -163,8 +161,9 @@
 }
 
 package_cuda-tools() {
-  pkgdesc+=" (extra tools: nsight, compute-sanitizer)"
-  depends=('cuda' 'nss')
+  pkgdesc+=" (extra tools: nvvp, nsight, compute-sanitizer)"
+  depends=('cuda' 'java-runtime=8' 'nss')
+  optdepends=('perl: required by some NVVP plugins')
 
   local _prepdir_tools="${srcdir}"/prep_tools
   mv "${_prepdir_tools}"/* "${pkgdir}"


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,5 +1,6 @@
 cuda
-gcc
+gcc14
+java-runtime
 nss
 opencl-nvidia
 python

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -12,6 +12,7 @@
 mkdir -p "${_prepdir_tools}"/opt/cuda/
 local tools_components=(
 cuda_nsight/{bin,nsightee_plugins}
+cuda_nvvp/{bin,libnvvp}
 cuda_sanitizer_api/compute-sanitizer
 nsight_compute
 nsight_systems
@@ -20,7 +21,7 @@
 cp -alr "$component" "${_prepdir_tools}"/opt/cuda/
 rm -r "$component"
 done
-rmdir cuda_nsight cuda_sanitizer_api
+rmdir cuda_nvvp cuda_nsight cuda_sanitizer_api
 ln -s ../compute-sanitizer/compute-sanitizer "${_prepdir_tools}"/opt/cuda/bin/compute-sanitizer
 mkdir -p "${_prepdir}"/opt/cuda/
 mv EULA.txt "${_prepdir}"/opt/cuda/
@@ -28,9 +29,6 @@
 cp -alr --force "$lib"/* "${_prepdir}"/opt/cuda/
 rm -r "$lib"
 done
-mv "${_prepdir}"/opt/cuda/extras/CUPTI/include/* "${_prepdir}"/opt/cuda/include/
-mv "${_prepdir}"/opt/cuda/extras/CUPTI/lib64/* "${_prepdir}"/opt/cuda/lib64/
-rmdir "${_prepdir}"/opt/cuda/extras/CUPTI/{include,lib64}
 rm "${_prepdir}"/opt/cuda/include/include
 rm "${_prepdir}"/opt/cuda/lib64/lib64
 ln -s lib64 "${_prepdir}"/opt/cuda/lib
@@ -39,5 +37,6 @@
 for f in $(find "$_prepdir"/opt/cuda -name Makefile); do
 sed -i "s|/usr/local/cuda|/opt/cuda|g" "$f"
 done
+patch -p1 -d "$_prepdir" -i "$srcdir"/fix-glibc241.patch
 patch -p1 -d "$_prepdir" -i "$srcdir"/fix-glibc242.patch
 }
