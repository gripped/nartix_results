--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,29 +1,26 @@
-
 pkgname=hipcub
-pkgver=7.1.1
+pkgver=6.0.2
 pkgrel=1
 pkgdesc='Header-only library on top of rocPRIM or CUB'
 arch=('x86_64')
-url='https://rocm.docs.amd.com/projects/hipCUB/en/latest/index.html'
+url='https://hipcub.readthedocs.io/en/latest/'
 license=('NCSA')
-depends=('rocm-core' 'rocprim' 'hip-runtime-amd')
-makedepends=('git' 'cmake' 'rocm-cmake' 'rocm-toolchain' 'rocm-llvm')
-_git='https://github.com/ROCm/rocm-libraries'
-source=("$pkgname-$pkgver.tar.gz::https://github.com/ROCm/rocm-libraries/releases/download/rocm-$pkgver/hipcub.tar.gz")
-sha256sums=('6dadbb7689c7906493ec42f56792d9557f0293670a86059c9c188851f399647b')
+depends=('rocm-core' 'rocprim' 'hip')
+makedepends=('cmake' 'rocm-cmake')
+_git='https://github.com/ROCm/hipCUB'
+source=("$pkgname-$pkgver.tar.gz::$_git/archive/rocm-$pkgver.tar.gz")
+sha256sums=('3f912a23dc34510cf18d9097f6eda37e01d01724975c8149c92a64c92415968c')
+_dirname="$(basename $_git)-$(basename "${source[0]}" ".tar.gz")"
 
 build() {
-  export CC=amdclang
-  export CXX=amdclang++
-  CXXFLAGS+=" -fcf-protection=none"
   local cmake_args=(
     -Wno-dev
-    -S "$pkgname"
+    -S "$_dirname"
     -B build
     -D CMAKE_BUILD_TYPE=None
     -D CMAKE_INSTALL_PREFIX=/opt/rocm
-    -D CMAKE_TOOLCHAIN_FILE="$srcdir/$pkgname"/toolchain-linux.cmake
-    -D GPU_TARGETS=$(rocm-supported-gfx)
+    -D CMAKE_CXX_COMPILER=/opt/rocm/bin/hipcc
+    -D CMAKE_CXX_FLAGS="${CXXFLAGS} -fcf-protection=none"
   )
   cmake "${cmake_args[@]}"
   cmake --build build
@@ -31,5 +28,5 @@
 
 package() {
   DESTDIR="$pkgdir" cmake --install build
-  install -Dm644 "$pkgname/LICENSE.txt" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
+  install -Dm644 "$_dirname/LICENSE.txt" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,8 +1,5 @@
 cmake
-git
-hip-runtime-amd
+hip
 rocm-cmake
 rocm-core
-rocm-llvm
-rocm-toolchain
 rocprim

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,15 +1,12 @@
 build() {
-export CC=amdclang
-export CXX=amdclang++
-CXXFLAGS+=" -fcf-protection=none"
 local cmake_args=(
 -Wno-dev
--S "$pkgname"
+-S "$_dirname"
 -B build
 -D CMAKE_BUILD_TYPE=None
 -D CMAKE_INSTALL_PREFIX=/opt/rocm
--D CMAKE_TOOLCHAIN_FILE="$srcdir/$pkgname"/toolchain-linux.cmake
--D GPU_TARGETS=$(rocm-supported-gfx)
+-D CMAKE_CXX_COMPILER=/opt/rocm/bin/hipcc
+-D CMAKE_CXX_FLAGS="${CXXFLAGS} -fcf-protection=none"
 )
 cmake "${cmake_args[@]}"
 cmake --build build
