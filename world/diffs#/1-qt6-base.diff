--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -2,8 +2,9 @@
 pkgbase=qt6-base
 pkgname=(qt6-base
          qt6-xcb-private-headers)
-pkgver=6.7.1
-pkgrel=2
+_qtver=6.7.0
+pkgver=${_qtver/-/}
+pkgrel=7
 arch=(x86_64)
 url='https://www.qt.io'
 license=(GPL3 LGPL3 FDL custom)
@@ -40,7 +41,7 @@
          pcre2
          shared-mime-info
          sqlite
-         systemd-libs
+         libelogind
          tslib
          vulkan-headers
          xcb-util-cursor
@@ -79,17 +80,22 @@
 _pkgfn=${pkgbase/6-/}
 source=(git+https://code.qt.io/qt/$_pkgfn#tag=v$pkgver
         qt6-base-cflags.patch
-        qt6-base-nostrip.patch)
-sha256sums=('bc68440a69a331b6b79b3c36acc8346b5dc0aad1b53536fe363860af31dd494b'
+        qt6-base-nostrip.patch
+        fix-wrong-cpp-if.patch::https://code.qt.io/cgit/qt/qtbase.git/patch/?id=68102202)
+sha256sums=('ee87abbfdf2d5bb204056bcb6c53e21c03e1abd779e3669faa56db7249c5e39e'
             '5411edbe215c24b30448fac69bd0ba7c882f545e8cf05027b2b6e2227abc5e78'
-            '4b93f6a79039e676a56f9d6990a324a64a36f143916065973ded89adc621e094')
+            '4b93f6a79039e676a56f9d6990a324a64a36f143916065973ded89adc621e094'
+            '81c4821fb1c258603474771a267d450aa8b5d1d298443bc04620d70719c7eab7')
 
 prepare() {
   patch -d $_pkgfn -p1 < qt6-base-cflags.patch # Use system CFLAGS
   patch -d $_pkgfn -p1 < qt6-base-nostrip.patch # Don't strip binaries with qmake
-
+  patch -d $_pkgfn -p1 < fix-wrong-cpp-if.patch # https://bugreports.qt.io/browse/QTBUG-123937
   cd $_pkgfn
-  git cherry-pick -n f05cf3f11f4e42e05d069b5d9249d4b9aff41ffe # Fix locale issues
+  git cherry-pick -n 7c4e1357e49baebdd2d20710fccb5604cbb36c0d # CVE-2024-33861
+  git cherry-pick -n a8ef8ea55014546e0e835cd0eacf694919702a11 # https://bugreports.qt.io/browse/QTBUG-124386
+  git cherry-pick -n 062f701a11d2c46660f5c5edd73f245477918a47 # Fix dependencies in pc files
+  git cherry-pick -n 5ee9da89af7efe31ac45858bf1eb04e5155a3b50 # Fix dependencies in pc files
 }
 
 build() {
@@ -105,7 +111,7 @@
     -DINSTALL_INCLUDEDIR=include/qt6 \
     -DINSTALL_MKSPECSDIR=lib/qt6/mkspecs \
     -DINSTALL_EXAMPLESDIR=share/doc/qt6/examples \
-    -DFEATURE_journald=ON \
+    -DFEATURE_journald=OFF \
     -DFEATURE_libproxy=ON \
     -DFEATURE_openssl_linked=ON \
     -DFEATURE_system_sqlite=ON \


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -19,6 +19,7 @@
 libb2
 libcups
 libdrm
+libelogind
 libfbclient
 libgl
 libice
@@ -44,7 +45,6 @@
 qt6-translations
 shared-mime-info
 sqlite
-systemd-libs
 tslib
 unixodbc
 vulkan-headers