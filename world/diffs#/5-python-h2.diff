--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,29 +1,36 @@
 
 pkgname=python-h2
-pkgver=4.2.0
-pkgrel=1
+pkgver=4.1.0
+pkgrel=5
 pkgdesc="HTTP/2 State-Machine based protocol implementation"
 arch=('any')
 license=('MIT')
 url="https://hyper.rtfd.org"
 depends=('python-hpack' 'python-hyperframe')
-makedepends=('git' 'python-setuptools' 'python-build' 'python-installer' 'python-wheel')
+makedepends=('python-setuptools' 'python-build' 'python-installer' 'python-wheel')
 checkdepends=('python-pytest' 'python-hypothesis')
-source=("git+https://github.com/python-hyper/h2.git#tag=v$pkgver")
-sha512sums=('7b3407653b0bf51b462080a425697e65c06fdc39e8b0da418a7a136bf1b6e77f11fdce219236d2eaaf8374e80645352cee7ff3d82477fe6eee08388e19cd8a78')
+source=("https://github.com/python-hyper/h2/archive/v$pkgver/$pkgname-$pkgver.tar.gz"
+        $pkgname-python-3.11.patch::https://github.com/python-hyper/h2/pull/1274.patch)
+sha512sums=('4e9cf88b3ae702a8a42bded775ad337809787fe8172d501c230d55abbf1edd764acf3b227f2e58756d882499661ffcf6bbdd4812a4d938c04fac3f1aa2390b28'
+            '94c0c5f6a5146e76c0ca9ccd62c7acfb7073b520ffe41a80cfaf51f619af5966d8beac923ca89bc439ec7170fd4c07d016b9024afce39a430214d6a8c8af6595')
+
+prepare() {
+  cd h2-$pkgver
+  patch -p1 -i ../$pkgname-python-3.11.patch
+}
 
 build() {
-  cd h2
+  cd h2-$pkgver
   python -m build --wheel --no-isolation
 }
 
 check() {
-  cd h2
+  cd h2-$pkgver
   PYTHONPATH="$PWD/src" pytest
 }
 
 package() {
-  cd h2
+  cd h2-$pkgver
   python -m installer --destdir="$pkgdir" dist/*.whl
   install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,4 +1,3 @@
-git
 python-build
 python-hpack
 python-hyperframe

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,4 +1,8 @@
+prepare() {
+cd h2-$pkgver
+patch -p1 -i ../$pkgname-python-3.11.patch
+}
 build() {
-cd h2
+cd h2-$pkgver
 python -m build --wheel --no-isolation
 }
