--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -7,7 +7,7 @@
   ruby-bundled-gems
   ruby-stdlib
 )
-pkgver=3.4.3
+pkgver=3.3.7
 pkgrel=2
 pkgdesc='An object-oriented language for quick and easy programming'
 url='https://www.ruby-lang.org/en/'
@@ -33,41 +33,33 @@
   procps-ng
 )
 options=('!emptydirs')
-source=("https://cache.ruby-lang.org/pub/ruby/${pkgver:0:3}/ruby-${pkgver}.tar.xz")
-sha512sums=('b30aad675cdcc1bdfe9e5fffe9d1925db3b3ac854a5e34180c368bc6e66f73e29ba5d802fea249353b7d799c01384c58bdd763fd1b679303158baa7824b9c08e')
-b2sums=('7c54768a768d4c293b8406e8a49ee5328eaea7744540b27b976284cc6c3e145c4f56f4691ea5db054265c333e4bf9cc38fa5f70789938e1bf5ecda3da41bf4d4')
+source=(
+  "https://cache.ruby-lang.org/pub/ruby/${pkgver:0:3}/ruby-${pkgver}.tar.xz"
+  https://github.com/ruby/ruby/commit/46b544c54955348ef1ea9692b837b061f59f91cd.patch
+)
+sha512sums=('4082a7684c1b0d53a0ce493f79568e851d37a864f59c58b2e0c273b2659e0ca75318ddff939fdf5e9d0a3eeba1b6d8f03bf88afb49a5ffd77714f1c8a7dfdd55'
+            'c8918afae331732516be222aa0e635ab719105a0f02aadf7ad80c546ec614278269fe0dde0e0e6b3775d77f2065d98af9d29f48f7d5e95572fefde383e51b826')
+b2sums=('33bd05d8462ec7e33872a31bcbfabcfc65a0245dc6519248e474085f3255dc3ad67210400ac314b291f16d3eb261459cadba180dfccc510a2b2c978035435347'
+        'cb481ea79a19e32439519c639588c29eadda471d891f0237b74c77ea4222f4ada1c31320224cec6561a8eac44bf189a62d76e04f3bc2747bf1e10a8674f6893e')
 
 _bootstrap=0
 _rubyver="${pkgver:0:3}.0"
 _bundled_gems=(
-  abbrev
-  base64
-  bigdecimal
-  csv
   debug
-  drb
-  getoptlong
   matrix
   minitest
-  mutex_m
   net-ftp
   net-imap
   net-pop
   net-smtp
-  nkf
-  observer
   power_assert
   prime
   racc
   rake
   rbs
-  repl_type_completor
-  resolv-replace
   rexml
-  rinda
   rss
   test-unit
-  syslog
   typeprof
 )
 _bundled_gems_bins=(
@@ -78,12 +70,17 @@
   typeprof
 )
 _default_gems=(
+  abbrev
+  base64
   benchmark
+  bigdecimal
   cgi
+  csv
   date
   delegate
   did_you_mean
   digest
+  drb
   english
   error_highlight
   etc
@@ -92,28 +89,34 @@
   fileutils
   find
   forwardable
+  getoptlong
   io-console
   io-nonblock
   io-wait
   ipaddr
   json
   logger
+  mutex_m
   net-http
   net-protocol
+  nkf
+  observer
   open-uri
   open3
   openssl
   optparse
   ostruct
   pathname
-  prism
   pp
   prettyprint
   pstore
   psych
   readline
+  readline-ext
   reline
   resolv
+  resolv-replace
+  rinda
   ruby2_keywords
   securerandom
   set
@@ -122,6 +125,7 @@
   stringio
   strscan
   syntax_suggest
+  syslog
   tempfile
   time
   timeout
@@ -149,6 +153,12 @@
   rdoc
   ri
 )
+
+prepare() {
+  cd "ruby-${pkgver}"
+
+  patch --verbose --strip=1 --input=../46b544c54955348ef1ea9692b837b061f59f91cd.patch
+}
 
 build() {
   cd "ruby-${pkgver}"
@@ -203,12 +213,17 @@
     libruby.so
   )
   replaces=(
+    ruby-abbrev
+    ruby-base64
     ruby-benchmark
+    ruby-bigdecimal
     ruby-cgi
+    ruby-csv
     ruby-date
     ruby-delegate
     ruby-did_you_mean
     ruby-digest
+    ruby-drb
     ruby-english
     ruby-etc
     ruby-fcntl
@@ -216,15 +231,16 @@
     ruby-fileutils
     ruby-find
     ruby-forwardable
+    ruby-getoptlong
     ruby-io-console
     ruby-io-nonblock
     ruby-io-wait
     ruby-ipaddr
     ruby-json
     ruby-logger
+    ruby-mutex_m
     ruby-net-http
     ruby-open-uri
-    ruby-prism
     ruby-psych
     ruby-reline
     ruby-ruby2_keywords


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -9,40 +9,27 @@
 libyaml
 openssl
 readline
-ruby-abbrev
-ruby-base64
-ruby-bigdecimal
 ruby-bundled-gems
 ruby-bundler
-ruby-csv
 ruby-debug
 ruby-default-gems
-ruby-drb
 ruby-erb
-ruby-getoptlong
 ruby-irb
 ruby-matrix
 ruby-minitest
-ruby-mutex_m
 ruby-net-ftp
 ruby-net-imap
 ruby-net-pop
 ruby-net-smtp
-ruby-nkf
-ruby-observer
 ruby-power_assert
 ruby-prime
 ruby-racc
 ruby-rake
 ruby-rbs
 ruby-rdoc
-ruby-repl_type_completor
-ruby-resolv-replace
 ruby-rexml
-ruby-rinda
 ruby-rss
 ruby-rubygems
-ruby-syslog
 ruby-test-unit
 ruby-typeprof
 rubygems

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,3 +1,7 @@
+prepare() {
+cd "ruby-${pkgver}"
+patch --verbose --strip=1 --input=../46b544c54955348ef1ea9692b837b061f59f91cd.patch
+}
 build() {
 cd "ruby-${pkgver}"
 export CFLAGS="${CFLAGS/_FORTIFY_SOURCE=3/_FORTIFY_SOURCE=2}"
