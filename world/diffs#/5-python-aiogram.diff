--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,76 +1,51 @@
 
 pkgname=python-aiogram
-_pkgname=${pkgname#python-}
-pkgver=3.13.1
-pkgrel=1
-pkgdesc="A modern and fully asynchronous framework for Telegram Bot API"
+pkgver=2.22.2
+pkgrel=4
+pkgdesc="A pretty simple and fully asynchronous library for Telegram Bot API written with asyncio and aiohttp"
 arch=('any')
 url="https://github.com/aiogram/aiogram"
 license=('MIT')
-depends=(
-  'python'
-  'python-aiofiles'
-  'python-aiohttp'
-  'python-certifi'
-  'python-magic-filter'
-  'python-pydantic'
+depends=('python-aiohttp' 'python-babel' 'python-certifi')
+makedepends=('python-setuptools' 'python-build' 'python-installer' 'python-wheel')
+checkdepends=('python-aiohttp-socks' 'python-redis' 'python-aresponses' 'python-pytest'
+              'pifpaf' 'redis')
+optdepends=('python-uvloop: fast, drop-in replacement of the built-in asyncio event loop'
+            'python-ujson: ultra fast JSON encoder and decoder written in pure C'
+            'python-rapidjson: extremely fast C++ JSON parser and serialization library'
+            'python-emoji: emojize and demojize support'
+            'python-redis: Redis storage support'
+            'python-aiohttp-socks: SOCKS4(a) and SOCKS5 proxy support'
 )
-makedepends=(
-  'python-build'
-  'python-hatchling'
-  'python-installer'
-  'python-wheel'
-)
-checkdepends=(
-  'pifpaf'
-  'python-aiohttp-socks'
-  'python-aresponses'
-  'python-babel'
-  'python-motor'
-  'python-pycryptodomex'
-  'python-pymongo'
-  'python-pytest'
-  'python-pytest-aiohttp'
-  'python-pytest-lazy-fixture'
-  'python-pytz'
-  'python-redis'
-  'redis'
-)
-optdepends=(
-  'python-uvloop: fast, drop-in replacement of the built-in asyncio event loop'
-  'python-ujson: ultra fast JSON encoder and decoder written in pure C'
-  'python-rapidjson: extremely fast C++ JSON parser and serialization library'
-  'python-emoji: emojize and demojize support'
-  'python-redis: Redis storage support'
-  'python-aiohttp-socks: SOCKS4(a) and SOCKS5 proxy support'
-  'python-motor: MongoDB storage support'
-  'python-babel: i18n support'
-)
-source=(
-  "$url/archive/v$pkgver/$pkgname-$pkgver.tar.gz"
-  "fix-pytest-asyncio-deprecation-warning-in-test.patch::$url/commit/5cd958c5477330270c5c293682d53b11c24309dc.patch"
-)
-sha256sums=('d834ef3856f0f3706ae9baf00a534fd0a0efbebc1e4b4647e16255009e7a3196'
-            '11dc7ebfc156d2eed143f2925de6625e8ef094cdf27b37b946fe1fa5fb8a2aa0')
+source=("https://github.com/aiogram/aiogram/archive/v$pkgver/$pkgname-$pkgver.tar.gz"
+        $pkgname-replace-aioredis.patch::https://github.com/aiogram/aiogram/pull/1074.patch)
+sha512sums=('7cbc979acba4904e503c801c4a823f802a3daf048bc5433e7cf9cb101e6a77f69955f363a73c5559901fa2b674f5092ec8c6336977807feac087581ef35fe5e0'
+            '3678f55b8d14cabcaebc8375168992fa55f0f6433c73d9bf98b0fd696120853a4df74cd3867bd866aff5bf0cdf088588aac24d37c90b2d70ce1b39b76c846b4d')
 
 prepare() {
-  cd "$_pkgname-$pkgver"
-  patch -Np1 -i ../fix-pytest-asyncio-deprecation-warning-in-test.patch
+  cd aiogram-$pkgver
+  patch -p1 -i ../$pkgname-replace-aioredis.patch
+  sed -i -e 's/import aioredis$/import redis.asyncio/' \
+         -e 's/aioredis.__version__/"2"/' \
+         -e 's/aioredis.connection.parse_url/redis.asyncio.connection.parse_url/' \
+         tests/conftest.py
+  rm tests/test_contrib/test_fsm_storage/test_storage.py
 }
 
 build() {
-  cd "$_pkgname-$pkgver"
+  cd aiogram-$pkgver
   python -m build --wheel --no-isolation
 }
 
 check() {
-  cd "$_pkgname-$pkgver"
+  cd aiogram-$pkgver
   pifpaf run redis -- bash -c 'python -m pytest --redis $PIFPAF_REDIS_URL'
 }
 
 package() {
-  cd "$_pkgname-$pkgver"
+  cd aiogram-$pkgver
   python -m installer --destdir="$pkgdir" dist/*.whl
-  install -vDm644 -t "$pkgdir/usr/share/doc/$pkgname" README.rst
-  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE
+
+  install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
+  install -Dm644 README.md -t "$pkgdir"/usr/share/doc/$pkgname/
 }


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,10 +1,7 @@
-python
-python-aiofiles
 python-aiohttp
+python-babel
 python-build
 python-certifi
-python-hatchling
 python-installer
-python-magic-filter
-python-pydantic
+python-setuptools
 python-wheel

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,8 +1,13 @@
 prepare() {
-cd "$_pkgname-$pkgver"
-patch -Np1 -i ../fix-pytest-asyncio-deprecation-warning-in-test.patch
+cd aiogram-$pkgver
+patch -p1 -i ../$pkgname-replace-aioredis.patch
+sed -i -e 's/import aioredis$/import redis.asyncio/' \
+-e 's/aioredis.__version__/"2"/' \
+-e 's/aioredis.connection.parse_url/redis.asyncio.connection.parse_url/' \
+tests/conftest.py
+rm tests/test_contrib/test_fsm_storage/test_storage.py
 }
 build() {
-cd "$_pkgname-$pkgver"
+cd aiogram-$pkgver
 python -m build --wheel --no-isolation
 }
