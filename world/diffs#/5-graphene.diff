--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,53 +1,41 @@
 
-pkgbase=graphene
-pkgname=(
-  graphene
-  graphene-docs
-)
+pkgname=graphene
 pkgver=1.10.8
-pkgrel=2
-pkgdesc="Thin layer of graphic data types"
+pkgrel=1
+pkgdesc="A thin layer of graphic data types"
 url="https://ebassi.github.io/graphene/"
 arch=(x86_64)
 license=(MIT)
-depends=(
-  glib2
-  glibc
-)
-makedepends=(
-  git
-  gobject-introspection
-  gtk-doc
-  meson
-)
-checkdepends=(
-  python-gobject
-  python-tappy
-)
-source=(
-  "git+https://github.com/ebassi/graphene#tag=$pkgver"
-  "git+https://github.com/ebassi/mutest"
-)
-b2sums=('386f8b82979459807828a392d5071ece645c9e06699a706b0cc2a582df74388f78f8f8152d02004f2e3e093be9a10b0e72cad04687cf650e06deead6f4929c4a'
-        'SKIP')
+makedepends=(git gtk-doc gobject-introspection meson glib2)
+checkdepends=(python-gobject python-tappy)
+options=(debug)
+_commit=4e2578450809c2099400cf85caf18eafcd7100aa  # tags/1.10.8^0
+source=("git+https://github.com/ebassi/graphene#commit=$_commit"
+        "git+https://github.com/ebassi/mutest"
+        no-installed-tests.diff)
+sha256sums=('SKIP'
+            'SKIP'
+            'fd7c41b25920077158d7de77f5d073e3a5a215c4d96c3b9bd016ffda615be4c4')
+
+pkgver() {
+  cd graphene
+  git describe --tags | sed 's/[^-]*-g/r&/;s/-/+/g'
+}
 
 prepare() {
   cd graphene
 
-  git cherry-pick -n f89522ca60a76512b8b85c7b8e4d16b94849f22f
+  git apply -3 ../no-installed-tests.diff
 
   git submodule init
   git submodule set-url subprojects/mutest "$srcdir/mutest"
-  git -c protocol.file.allow=always -c protocol.allow=never submodule update
+  git submodule update
 }
 
 build() {
-  local meson_options=(
-    -D gtk_doc=true
+  artix-meson graphene build \
+    -D gtk_doc=true \
     -D installed_tests=false
-  )
-
-  arch-meson graphene build "${meson_options[@]}"
   meson compile -C build
 }
 
@@ -55,22 +43,11 @@
   meson test -C build --print-errorlogs
 }
 
-package_graphene() {
+package() {
+  depends=(libg{lib,object}-2.0.so)
   provides=(libgraphene-1.0.so)
 
   meson install -C build --destdir "$pkgdir"
-
-  mkdir -p doc/usr/share
-  mv {"$pkgdir",doc}/usr/share/gtk-doc
-
   install -Dt "$pkgdir/usr/share/licenses/$pkgname" -m644 graphene/LICENSE.txt
 }
 
-package_graphene-docs() {
-  pkgdesc+=" (documentation)"
-  depends=()
-
-  mv doc/* "$pkgdir"
-  install -Dt "$pkgdir/usr/share/licenses/$pkgname" -m644 graphene/LICENSE.txt
-}
-


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,7 +1,7 @@
-
 git
 glib2
-glibc
 gobject-introspection
 gtk-doc
+libglib-2.0.so
+libgobject-2.0.so
 meson

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,15 +1,13 @@
 prepare() {
 cd graphene
-git cherry-pick -n f89522ca60a76512b8b85c7b8e4d16b94849f22f
+git apply -3 ../no-installed-tests.diff
 git submodule init
 git submodule set-url subprojects/mutest "$srcdir/mutest"
-git -c protocol.file.allow=always -c protocol.allow=never submodule update
+git submodule update
 }
 build() {
-local meson_options=(
--D gtk_doc=true
+artix-meson graphene build \
+-D gtk_doc=true \
 -D installed_tests=false
-)
-arch-meson graphene build "${meson_options[@]}"
 meson compile -C build
 }
