--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -4,13 +4,15 @@
   glib2
   glib2-docs
 )
-pkgver=2.78.4
-pkgrel=1
+pkgver=2.80.2
+pkgrel=2
 pkgdesc="Low level core library"
 url="https://gitlab.gnome.org/GNOME/glib"
 license=(LGPL-2.1-or-later)
 arch=(x86_64)
 depends=(
+  bash
+  glibc
   libffi
   libsysprof-capture
   pcre2
@@ -21,10 +23,13 @@
   dbus
   gettext
   git
-  gtk-doc
+  gi-docgen
+  gobject-introspection
   libelf
   meson
   python
+  python-docutils
+  python-packaging
   shared-mime-info
   util-linux
 )
@@ -32,46 +37,42 @@
   desktop-file-utils
   glib2
 )
-options=(
-  debug
-  staticlibs
-)
-_commit=00edb7f7453a43cff343f9e99d49f2e421e4345c  # tags/2.78.4^0
 source=(
-  "git+https://gitlab.gnome.org/GNOME/glib.git#commit=$_commit"
+  "git+https://gitlab.gnome.org/GNOME/glib.git?signed#tag=$pkgver"
   "git+https://gitlab.gnome.org/GNOME/gvdb.git"
   0001-glib-compile-schemas-Remove-noisy-deprecation-warnin.patch
   gio-querymodules.hook
   glib-compile-schemas.hook
 )
-b2sums=('SKIP'
+b2sums=('5cee8c7aee08f20b759bb614475a3881f60586d5f388e9c45c670765e03b77916c3d1e27b6e0286f23d779014ba17993400ed4708bcb456a479e43a2e80f6756'
         'SKIP'
         '94c73ca7070c239494873dd52d6ee09382bbb5b1201f7afd737cfa140b1a2fb0744b2c2831baf3943d1d072550c35888d21ce6f19f89481ff9d1a60d9a0b30e0'
         '14c9211c0557f6d8d9a914f1b18b7e0e23f79f4abde117cb03ab119b95bf9fa9d7a712aa0a29beb266468aeb352caa3a9e4540503cfc9fe0bbaf764371832a96'
-        'd30d349b4cb4407839d9074ce08f5259b8a5f3ca46769aabc621f17d15effdb89c4bf19bd23603f6df3d59f8d1adaded0f4bacd0333afcab782f2d048c882858')
-
-
-pkgver() {
-  cd glib
-  git describe --tags | sed 's/[^-]*-g/r&/;s/-/+/g'
-}
+        'acc2f474139e535f4bdd70ac22a9150f786b3395e679b14d0d3fbb9361d511bb1b5069d95b2a7ac9c0f3d901b03a0c037eb273446ba00764191b30a777bd2bc9')
+validpgpkeys=(
+  923B7025EE03C1C59F42684CF0942E894B2EAFA0 # Philip Withnall <pwithnall@gnome.org>
+)
 
 prepare() {
   cd glib
+
+  git cherry-pick -n df2c5d925ac4b8f1708bafa5ac1d35acada05d55 \
+                     7a7137838e79e5a98e6f4eab6898e2a0dc6392cd
 
   git apply -3 ../0001-glib-compile-schemas-Remove-noisy-deprecation-warnin.patch
 
   git submodule init
   git submodule set-url subprojects/gvdb "$srcdir/gvdb"
-  git -c protocol.file.allow=always submodule update
+  git -c protocol.file.allow=always -c protocol.allow=never submodule update
 }
 
 build() {
   local meson_options=(
     --default-library both
     -D glib_debug=disabled
-    -D gtk_doc=true
-    -D man=true
+    -D documentation=true
+    -D introspection=enabled
+    -D man-pages=enabled
     -D selinux=disabled
     -D sysprof=enabled
   )
@@ -82,7 +83,7 @@
   CFLAGS+=" -ffat-lto-objects"
   CXXFLAGS+=" -ffat-lto-objects"
 
-  arch-meson glib build "${meson_options[@]}"
+  artix-meson glib build "${meson_options[@]}"
   meson compile -C build
 }
 
@@ -90,17 +91,29 @@
   meson test -C build --no-suite flaky --no-suite slow --print-errorlogs
 }
 
+_pick() {
+  local p="$1" f d; shift
+  for f; do
+    d="$srcdir/$p/${f#$pkgdir/}"
+    mkdir -p "$(dirname "$d")"
+    mv "$f" "$d"
+    rmdir -p --ignore-fail-on-non-empty "$(dirname "$f")"
+  done
+}
+
 package_glib2() {
   depends+=(
     libffi.so
     libmount.so
   )
-  provides+=(libg{lib,io,module,object,thread}-2.0.so)
+  provides+=(libg{lib,io,irepository,module,object,thread}-2.0.so)
   optdepends=(
     'gvfs: most gio functionality'
     'libelf: gresource inspection tool'
     'python: gdbus-codegen, glib-genmarshal, glib-mkenums, gtester-report'
+    'python-packaging: gdbus-codegen'
   )
+  options=(staticlibs)
 
   meson install -C build --destdir "$pkgdir"
 
@@ -112,8 +125,9 @@
   python -O -m compileall -d /usr/share/glib-2.0/codegen \
     "$pkgdir/usr/share/glib-2.0/codegen"
 
-  mkdir -p docs/usr/share
-  mv {"$pkgdir",docs}/usr/share/gtk-doc
+  cd "$pkgdir"
+
+  _pick docs usr/share/doc
 }
 
 package_glib2-docs() {
@@ -121,7 +135,7 @@
   depends=()
   license+=(LicenseRef-Public-Domain)
 
-  mv -t "$pkgdir" docs/*
+  mv docs/* "$pkgdir"
   install -Dt "$pkgdir/usr/share/licenses/$pkgname" -m644 glib/docs/reference/COPYING
 }
 


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -1,8 +1,11 @@
 
+bash
 dbus
 gettext
+gi-docgen
 git
-gtk-doc
+glibc
+gobject-introspection
 libelf
 libffi
 libffi.so
@@ -11,6 +14,8 @@
 meson
 pcre2
 python
+python-docutils
+python-packaging
 shared-mime-info
 util-linux
 util-linux-libs

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,16 +1,19 @@
 prepare() {
 cd glib
+git cherry-pick -n df2c5d925ac4b8f1708bafa5ac1d35acada05d55 \
+7a7137838e79e5a98e6f4eab6898e2a0dc6392cd
 git apply -3 ../0001-glib-compile-schemas-Remove-noisy-deprecation-warnin.patch
 git submodule init
 git submodule set-url subprojects/gvdb "$srcdir/gvdb"
-git -c protocol.file.allow=always submodule update
+git -c protocol.file.allow=always -c protocol.allow=never submodule update
 }
 build() {
 local meson_options=(
 --default-library both
 -D glib_debug=disabled
--D gtk_doc=true
--D man=true
+-D documentation=true
+-D introspection=enabled
+-D man-pages=enabled
 -D selinux=disabled
 -D sysprof=enabled
 )
@@ -18,6 +21,6 @@
 CXXFLAGS+=" -g3"
 CFLAGS+=" -ffat-lto-objects"
 CXXFLAGS+=" -ffat-lto-objects"
-arch-meson glib build "${meson_options[@]}"
+artix-meson glib build "${meson_options[@]}"
 meson compile -C build
 }
