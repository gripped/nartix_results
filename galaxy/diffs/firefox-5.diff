--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -1,7 +1,7 @@
 
 pkgname=firefox
-pkgver=147.0.4
-pkgrel=1
+pkgver=147.0.3
+pkgrel=2
 pkgdesc="Fast, Private & Safe Web Browser"
 url="https://www.mozilla.org/firefox/"
 arch=(x86_64)
@@ -15,14 +15,13 @@
   ffmpeg
   fontconfig
   freetype2
+  gcc-libs
   gdk-pixbuf2
   glib2
   glibc
   gtk3
   hicolor-icon-theme
-  libgcc
   libpulse
-  libstdc++
   libx11
   libxcb
   libxcomposite
@@ -49,7 +48,6 @@
   mesa
   nasm
   nodejs
-  onnxruntime
   python
   rust
   unzip
@@ -65,7 +63,6 @@
   'hunspell-en_US: Spell checking, American English'
   'libnotify: Notification integration'
   'networkmanager: Location detection via available WiFi networks'
-  'onnxruntime: Local machine learning features such as smart tab groups'
   'speech-dispatcher: Text-to-Speech'
   'xdg-desktop-portal: Screensharing with Wayland'
 )
@@ -81,32 +78,34 @@
   org.mozilla.$pkgname.metainfo.xml
   0001-Install-under-remoting-name.patch
   0002-Bug-2012006-WebRTC-backport-PipeWire-capture-clear-e.patch
-  0003-Patch-glsl-optimizer-to-build-with-glibc-2.43.patch
-  0004-Fix-sandbox-to-build-with-glibc-2.43.patch
+  policies.json
+  preferences.patch
+  preferences2.patch
 )
 validpgpkeys=(
   14F26682D0916CDD81E37B6D61B7B526D98F0353
 )
-sha256sums=('bc0742ac62b177987d3312352194d4a088396ccf7b02e94be88f8072d82e94f7'
+sha256sums=('bfa38a16d51a88ff077dceeca5ac28c14635d24401de305e6c5e2291a64d9c18'
             'SKIP'
             'a9b8b4a0a1f4a7b4af77d5fc70c2686d624038909263c795ecc81e0aec7711e9'
             '2a51d57d98fbda86f094bc991e1ad4dd6e8a9d32fd0836b1183bf70ec4b68915'
             '23f557fa7989adcae03cc9458d94716981dbcf0e9d6d52a289a2426e50b4b785'
-            'ef63a12975f108f30b00bb3290d9ca76f311d8af9c1d5dfc0d8335ad57e8f77c'
+            '883ca2fa723a7572269d18559d5b82412782ad63e5dd3820eeb0540e3fe34314'
             'eaa1e9c177f83ae9f20009b77eab8f97a8ad7ed5e4502999211d4eab57835774'
-            'c2aaff2a743c738edbf02d7be816c30fe3a5acb2d3dcb7a3906357a9f2ed438f'
-            '8d2182ae8660474ac567482fe6658af77f3b402314e361c846528ae171586245')
-b2sums=('ede1c530139bffa5858c1146fee5fff1b2cddd7836be4f4a1dbcabebfa61ba5f29d9d9c104524ac6a6baf1c870eebddf921839eea65fa560b67c5bbac6bbb593'
+            'edc9d297a890bdcbf87251a5ff398c49114c3f99f0881d6bf31ed2ccfffd298c'
+            '21dfd320408ffd57239eabf13df493fe7d575be6b12b07554f8454c233750ab2'
+            '7802a6e1c6fb2d117041671b7853d376cebc5e7d76001159ed960fc557d2a0f5')
+b2sums=('d1dfb15a47dbbaf50081c61b7b03d712886ec4b3ae749abf7886c7adebeb7e03831c65e49706f09bd670a11359aa91be45921d1166003ba89cededf61e7a8c96'
         'SKIP'
         '63a8dd9d8910f9efb353bed452d8b4b2a2da435857ccee083fc0c557f8c4c1339ca593b463db320f70387a1b63f1a79e709e9d12c69520993e26d85a3d742e34'
         '63c62c85ee70e22b02e9ea34e69f04f50403b7634b99fb0e996a83c963916dc4224041a0b265e54f6c224bd1777ddfdeb255037e3e30fec288695f3050278b05'
         '1a7fc030b1051df00df1b2f5b247b8c658de6cdfba0788041c830da3aaaa6ac974ab684e05feb80672aa2d2c22294cacfa93a71dc664b3e60becdd65e879fcee'
-        'ff0ba11844e99ab1b1fed91d70c6f45837198ba43e77313c8b9c48a621e40c459953fc35283b6b6eafb5641510a5ce1e18ebda4d7d076f8212810391c0a9234b'
+        '8a894b01e405b628877483e40e9b018647977cb053b6af02afc901ed24d6e1f767f3db8c321070e33aea4a05ba16f1eb47ae600e5299b5f9caad03d20ba38cf5'
         '512a387e28b64743f9086019860c649d7b08cf69aa10f256b39790fb9ab403ddad7693900684dfeb59206036940f7a273cede822b1395c947dd482f617f13729'
-        '1e6f24c3515c5bc66c33a0e0fcf33455622aa2138293f743c1e7df8327d76ecb47f4d516707f60f576d1ec6d64ee6bcdeffa49f53fd3d3188a0ac4a1cd3f561f'
-        '87e514cb3d5045489176a6d335f23ef82fa7b2805f689d8e4d9090dccf426c432e862a5dd537d91ceab6cc0a531fef9aa31fa2526666926224fcfdbd86c991a9')
-
-_google_api_key=AIzaSyDwr302FpOSkGRpLlUpPThNTDPbXcIn_FM
+        '87eea4bc3c4f326f0667245b206cd1b10ef7f010ce7600906aa411dd4dfa653bd081b48e6c8c9de47576594ef4e5dceaff317380c3d2d198b0f064255e650838'
+        '3a6d97231824c9c2d97bd15023faa4cdd25ae59a34c1961e6cd12bb5d172ede95594fd1f7e3dbed7d79a645cf734961a4b7d2bdedaee55c716d49f0e7fdfc3a4'
+        'e4c6d14fbfde0237da9fad63289c2dc55084378e1edc805e39c207595dc71c12e731934b83fbf0286635f520832774c6c33398a47b11288dd4c34e431e8f6ffd')
+
 
 prepare() {
   mkdir mozbuild
@@ -116,10 +115,10 @@
 
   patch -Np1 -i ../0002-Bug-2012006-WebRTC-backport-PipeWire-capture-clear-e.patch
 
-  patch -Np1 -i ../0003-Patch-glsl-optimizer-to-build-with-glibc-2.43.patch
-  patch -Np1 -i ../0004-Fix-sandbox-to-build-with-glibc-2.43.patch
-
   echo -n "$_google_api_key" >google-api-key
+
+  patch -Np1 -i ../preferences.patch
+  patch -Np1 -i ../preferences2.patch
 
   cat >../mozconfig <<END
 ac_add_options --enable-application=browser
@@ -132,19 +131,18 @@
 ac_add_options --enable-rust-simd
 ac_add_options --enable-linker=lld
 ac_add_options --disable-install-strip
+ac_add_options --disable-elf-hack
 ac_add_options --disable-bootstrap
 ac_add_options --with-wasi-sysroot=/usr/share/wasi-sysroot
 
 ac_add_options --enable-official-branding
 ac_add_options --enable-update-channel=release
-ac_add_options --with-distribution-id=org.archlinux
+ac_add_options --with-distribution-id=org.artixlinux
 ac_add_options --with-unsigned-addon-scopes=app,system
 ac_add_options --allow-addon-sideload
 export MOZILLA_OFFICIAL=1
 export MOZ_APP_REMOTINGNAME=$pkgname
 
-ac_add_options --with-google-location-service-api-keyfile=${PWD@Q}/google-api-key
-ac_add_options --with-google-safebrowsing-api-keyfile=${PWD@Q}/google-api-key
 
 ac_add_options --with-system-nspr
 ac_add_options --with-system-nss
@@ -197,7 +195,7 @@
 
   echo "Building optimized browser..."
   cat >.mozconfig ../mozconfig - <<END
-ac_add_options --enable-lto=cross,full
+ac_add_options --enable-lto=cross
 ac_add_options --enable-profile-use=cross
 ac_add_options --with-pgo-profile-path=${PWD@Q}/merged.profdata
 ac_add_options --with-pgo-jarlog=${PWD@Q}/jarlog
@@ -208,9 +206,9 @@
 package() {
   cd firefox-$pkgver
   DESTDIR="$pkgdir" ./mach install
-  local appdir="$pkgdir/usr/lib/$pkgname"
-
-  install -Dvm644 /dev/stdin "$appdir/browser/defaults/preferences/vendor.js" <<END
+
+  local vendorjs="$pkgdir/usr/lib/$pkgname/browser/defaults/preferences/vendor.js"
+  install -Dvm644 /dev/stdin "$vendorjs" <<END
 // Use LANG environment variable to choose locale
 pref("intl.locale.requested", "");
 
@@ -227,19 +225,21 @@
 pref("browser.gnome-search-provider.enabled", true);
 END
 
-  install -Dvm644 /dev/stdin "$appdir/distribution/distribution.ini" <<END
+  local distini="$pkgdir/usr/lib/$pkgname/distribution/distribution.ini"
+  install -Dvm644 /dev/stdin "$distini" <<END
 [Global]
-id=archlinux
+id=artixlinux
 version=1.0
-about=Mozilla Firefox for Arch Linux
+about=Mozilla Firefox for Artix Linux
 
 [Preferences]
-app.distributor=archlinux
+app.distributor=artixlinux
 app.distributor.channel=$pkgname
-app.partner.archlinux=archlinux
-END
-
-  ln -srv "$pkgdir/usr/lib/libonnxruntime.so" -t "$appdir"
+app.partner.artixlinux=artixlinux
+startup.homepage_welcome_url.additional=""
+startup.homepage_override_url=""
+startup.homepage_welcome_url=""
+END
 
   local i theme=official
   for i in 16 22 24 32 48 64 128 256; do
@@ -256,18 +256,21 @@
   install -Dvm644 ../$pkgname-symbolic.svg -t "$pkgdir/usr/share/icons/hicolor/symbolic/apps"
   install -Dvm644 ../$pkgname.desktop -t "$pkgdir/usr/share/applications"
   install -Dvm644 ../org.mozilla.$pkgname.metainfo.xml -t "$pkgdir/usr/share/metainfo"
+  install -Dvm644 "$srcdir/policies.json" "$pkgdir/usr/lib/$pkgname/distribution/policies.json"
 
   install -Dvm755 /dev/stdin "$pkgdir/usr/bin/$pkgname" <<END
 exec /usr/lib/$pkgname/firefox "\$@"
 END
 
   ln -srfv "$pkgdir/usr/bin/$pkgname" "$pkgdir/usr/lib/$pkgname/firefox-bin"
+
+  local sprovider="$pkgdir/usr/share/gnome-shell/search-providers/$pkgname.search-provider.ini"
 
   if [[ -e $appdir/libnss3.so ]]; then
     ln -sfv ../libnssckbi.so -t "$appdir"
   fi
 
-  install -Dvm644 /dev/stdin "$pkgdir/usr/share/gnome-shell/search-providers/$pkgname.search-provider.ini" <<END
+  install -Dvm644 /dev/stdin "$sprovider" <<END
 [Shell Search Provider]
 DesktopId=$pkgname.desktop
 BusName=org.mozilla.${pkgname//-/_}.SearchProvider


############# Stripped diff below #################

--- arch_depends
+++ artix_depends
@@ -9,6 +9,7 @@
 ffmpeg
 fontconfig
 freetype2
+gcc-libs
 gdk-pixbuf2
 glib2
 glibc
@@ -16,9 +17,7 @@
 hicolor-icon-theme
 imake
 jack
-libgcc
 libpulse
-libstdc++
 libx11
 libxcb
 libxcomposite
@@ -36,7 +35,6 @@
 nodejs
 nspr
 nss
-onnxruntime
 pango
 python
 rust

--- Arch PKGBUILD
+++ Artix PKGBUILD
@@ -3,9 +3,9 @@
 cd firefox-$pkgver
 patch -Np1 -i ../0001-Install-under-remoting-name.patch
 patch -Np1 -i ../0002-Bug-2012006-WebRTC-backport-PipeWire-capture-clear-e.patch
-patch -Np1 -i ../0003-Patch-glsl-optimizer-to-build-with-glibc-2.43.patch
-patch -Np1 -i ../0004-Fix-sandbox-to-build-with-glibc-2.43.patch
 echo -n "$_google_api_key" >google-api-key
+patch -Np1 -i ../preferences.patch
+patch -Np1 -i ../preferences2.patch
 cat >../mozconfig <<END
 ac_add_options --enable-application=browser
 mk_add_options MOZ_OBJDIR=${PWD@Q}/obj
@@ -16,17 +16,16 @@
 ac_add_options --enable-rust-simd
 ac_add_options --enable-linker=lld
 ac_add_options --disable-install-strip
+ac_add_options --disable-elf-hack
 ac_add_options --disable-bootstrap
 ac_add_options --with-wasi-sysroot=/usr/share/wasi-sysroot
 ac_add_options --enable-official-branding
 ac_add_options --enable-update-channel=release
-ac_add_options --with-distribution-id=org.archlinux
+ac_add_options --with-distribution-id=org.artixlinux
 ac_add_options --with-unsigned-addon-scopes=app,system
 ac_add_options --allow-addon-sideload
 export MOZILLA_OFFICIAL=1
 export MOZ_APP_REMOTINGNAME=$pkgname
-ac_add_options --with-google-location-service-api-keyfile=${PWD@Q}/google-api-key
-ac_add_options --with-google-safebrowsing-api-keyfile=${PWD@Q}/google-api-key
 ac_add_options --with-system-nspr
 ac_add_options --with-system-nss
 ac_add_options --enable-alsa
@@ -66,7 +65,7 @@
 ./mach clobber objdir
 echo "Building optimized browser..."
 cat >.mozconfig ../mozconfig - <<END
-ac_add_options --enable-lto=cross,full
+ac_add_options --enable-lto=cross
 ac_add_options --enable-profile-use=cross
 ac_add_options --with-pgo-profile-path=${PWD@Q}/merged.profdata
 ac_add_options --with-pgo-jarlog=${PWD@Q}/jarlog
